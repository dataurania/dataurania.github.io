{"version":3,"sources":["pages/EditPage/EditDataVideos/VideoSliceCardList/SliceCard.js","pages/EditPage/EditDataVideos/VideoSliceCardList/UnitVisDraw.js","pages/EditPage/EditDataVideos/VideoSliceCardList/SliceCardFooter.js","pages/EditPage/EditDataVideos/VideoSliceCardList/SliceCardCaption.js","../node_modules/classnames/index.js","../node_modules/@babel/runtime/helpers/esm/typeof.js","axios/config.js","axios/base.js","axios/api.js","../node_modules/@ant-design/icons-svg/es/asn/CloseOutlined.js","../node_modules/@ant-design/icons/es/icons/CloseOutlined.js","model/fact.js","tool/narrative2cards.js"],"names":["getChoice","length","Math","round","random","getFactChartType","shema","fact","supportedChartTypes","getSupportedChartTypes","chart","SliceCard","deleteVideoSlice","index","props","isPlayVideo","removeCard","deleteBarFromTimeLineBar","deleteFact","clickSliceCard","console","log","nowKey","_","cloneDeep","keys","addIndex","toString","indexOf","push","deleteKey","splice","changeKeys","generateTransitionFacts","Promise","resolve","reject","a","formerFact","cardItems","latterFact","filename","fileName","startFact","type","measure","subspace","groupby","focus","endFact","setState","operateState","OperationType","GENERATING","isUpdateEditing","data","file_name","max_story_length","method","start","end","api","config","url","generateRandomly","response","fail","ADD_FAILED","errorMessage","error","facts","story","tempFacts","factDict","Fact","generatedScript","genFactSentence","state","lang","i","myCards","myBars","schemaFilter","schemaFilterLocal","schema","specData","ChartType","ISOTYPE_BAR_CHART","VERTICAL_BAR_CHART","isValid","datares","dataresLocal","values","specChart","width_height","width","height","style","duration","showSuggestion","size","specFact","breakdown","map","d","specs","insertIndex","insertFactByFact","myCard","spec","time","isGeneratedByAlg","bar","leftbar","rightbar","isDrag","addCards","addBarsToTimeLineBar","GENERATED","this","videoIndex","vis","uuid","uuidv4","narrativespec2Vis","className","ref","provided","innerRef","draggableProps","dragHandleProps","background","onClick","playVideoSlice","setLeftsiderContent","React","Component","UnitVisDraw","editClickSlice","ActionType","SET_EDIT_SLICE","nextProps","nextState","pre","narrative_spec","next","is","Immutable","fromJS","SliceCardFooter","num","backgroundColor","SliceCardCaption","myActions","actions","caption","text","hasOwn","hasOwnProperty","classNames","classes","arguments","arg","argType","Array","isArray","inner","apply","Object","prototype","key","call","join","module","exports","default","_typeof","obj","Symbol","iterator","constructor","applicationUrl","urlPrefix","generationUrlPrefix","activitiesPrefix","uploadDataPrefix","question2gifPrefix","accountIp","share","publicPrefix","loginadmintest","loginRedirectUrl","logoutRedirectUrl","authenUrl","accessToken","userImage","checkToken","logout","logoutAuthSystem","users","activitiesApi","uploadData","uploadGraphData","fetch","factScoring","generateGraphRandomly","filteredGenerate","question2gif","composeUrl","qs","result","stringify","requestWithoutCredentials","param","reslove","axios","then","status","catch","formData","generate","filters","shareStory","jsonstring","fetchStory","id","uid","body","req","CloseOutlined","AntdIcon","_objectSpread","icon","CloseOutlinedSvg","displayName","parameter","score","information","significance","script","generatedSubtitle","genSubtitle","aggregated","aggregatedFact","compoundType","compoundChart","JUXTAPOSITION","narrative_spec2cards","idx_titleaction","step_actions","item","add","eachaction","slice","delay","step_spec"],"mappings":"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","file":"static/js/60.874cffd4.chunk.js","sourcesContent":["import React from 'react';\r\nimport { CloseOutlined } from '@ant-design/icons';\r\nimport { narrativespec2Vis } from '@/tool/narrative2cards';\r\nimport { fact2unitVis } from '@/tool/fact2unitVis';\r\n\r\nimport uuidv4 from 'uuid/v4';\r\nimport ActionType from '@/action/type';\r\nimport UnitVisDraw from './UnitVisDraw';\r\nimport ChartType from '../../../../constant/ChartType';\r\nimport SliceCardFooter from './SliceCardFooter';\r\nimport SliceCardCaption from './SliceCardCaption'\r\nimport * as api from '@/axios/api';\r\nimport OperationType from '@/constant/OperationType';\r\nimport config from '@/axios/config';\r\nimport Fact from '@/model/fact';\r\nimport { genFactSentence } from '@/sentencer/index';\r\nimport { isValid, customizeFact } from '@/view/FactEditor/helper';\r\nimport getSupportedChartTypes from '@/tool/getSupportedChartTypes';\r\nimport _ from 'lodash';\r\n\r\n\r\nexport const getChoice = (length) => {\r\n    let choice = Math.round(Math.random() * (length - 1));\r\n    return choice;\r\n}\r\n\r\nexport const getFactChartType = (shema, fact, choice = 0) => {\r\n    let supportedChartTypes = getSupportedChartTypes(fact, shema);\r\n    if (supportedChartTypes.length === 0) return null;\r\n    return supportedChartTypes[getChoice(supportedChartTypes.length)].chart;\r\n}\r\n\r\nexport default class SliceCard extends React.Component {\r\n\r\n\r\n    deleteVideoSlice = (index) => {\r\n        if(this.props.isPlayVideo)\r\n        {\r\n            null\r\n        }\r\n        else\r\n        {\r\n        this.props.removeCard(index)\r\n        this.props.deleteBarFromTimeLineBar(index)\r\n        this.props.deleteFact(index)\r\n        }\r\n    }\r\n\r\n    // 点击卡片展开operator\r\n    clickSliceCard = (index) => {\r\n        console.log('click slice card', index);\r\n        let nowKey = _.cloneDeep(this.props.keys)\r\n        let addIndex = index.toString()\r\n        if(nowKey.indexOf(addIndex)==-1)\r\n            nowKey.push(addIndex)\r\n        else\r\n            {\r\n                let deleteKey = nowKey.indexOf(addIndex)\r\n                nowKey.splice(deleteKey,1)\r\n            }\r\n        this.props.changeKeys(nowKey)\r\n    }\r\n\r\n    generateTransitionFacts = (index) => {\r\n        new Promise(async (resolve, reject) => {\r\n            console.log(\"generateTransitionFacts\"+index)\r\n            let formerFact = this.props.cardItems[index]\r\n            let latterFact = this.props.cardItems[index+1]\r\n\r\n            let filename = this.props.fileName\r\n            // 问题5，这里有start 和 end 的fact\r\n            let startFact = {\r\n                type:formerFact.fact.type,\r\n                measure:formerFact.fact.measure,\r\n                subspace:formerFact.fact.subspace,\r\n                groupby:formerFact.fact.groupby,\r\n                focus:formerFact.fact.focus,\r\n            }\r\n            let endFact = {\r\n                type:latterFact.fact.type,\r\n                measure:latterFact.fact.measure,\r\n                subspace:latterFact.fact.subspace,\r\n                groupby:latterFact.fact.groupby,\r\n                focus:latterFact.fact.focus,\r\n            }\r\n            \r\n            this.setState({\r\n                operateState: OperationType.GENERATING\r\n            });\r\n            this.props.isUpdateEditing(true);\r\n\r\n            let data = {\r\n                file_name:filename,\r\n                max_story_length:4,\r\n                method:\"guided\",\r\n                start:startFact,\r\n                end:endFact,\r\n            }\r\n            // 这里请求了api\r\n            const response = await api.generate(config.url.generateRandomly,data)\r\n\r\n            if (response.data.fail) {\r\n                console.log('fail')\r\n                this.setState({\r\n                    operateState: OperationType.ADD_FAILED,\r\n                    errorMessage: response.data.fail\r\n                })\r\n                reject()\r\n                //record_activity(activitiesCode.editTopic, 0, { filename: fileName, filters: filters });\r\n            }\r\n            if (response.data.error) {\r\n                console.log('error')\r\n                this.setState({\r\n                    operateState: OperationType.ADD_FAILED,\r\n                    errorMessage: response.data.error\r\n                })\r\n                reject()\r\n                //record_activity(activitiesCode.editTopic, 0, { filename: fileName, filters: filters });\r\n            }\r\n            const facts = response.data.story.facts;\r\n            let tempFacts = [];\r\n            for (let factDict of facts){    \r\n                let fact = new Fact(\r\n                    factDict['type'],\r\n                    factDict['measure'],\r\n                    factDict['subspace'],\r\n                    factDict['groupby'],\r\n                    factDict['focus'],\r\n                    factDict['parameter'],\r\n                    \"\", // chart\r\n                    factDict['score'],\r\n                    factDict['information'],\r\n                    factDict['significance']\r\n                )\r\n                fact.generatedScript = genFactSentence(fact, this.state.lang)\r\n                tempFacts.push(fact);\r\n            }\r\n            console.log(tempFacts.length)\r\n\r\n            var i = 0\r\n            var myCards = []\r\n            var myBars =[]\r\n\r\n            for(let fact of tempFacts){\r\n                if(tempFacts.length==1||tempFacts.length==2)\r\n                {\r\n                    break\r\n                }\r\n                if(i==0||i==tempFacts.length-1)\r\n                {\r\n                    i++\r\n                    continue\r\n                }\r\n                \r\n                let schemaFilter = _.cloneDeep(this.props.schemaFilterLocal);\r\n                let schema=this.props.schema\r\n                let specData\r\n                schemaFilter ? specData = { \"schema\": schemaFilter, } : specData = { \"schema\": schema };\r\n\r\n                if (!fact.chart || fact.chart === \"\") {\r\n                    fact.chart = getFactChartType(specData.schema, fact); //针对生成页面的chart\r\n                }\r\n            \r\n                let chart = fact.chart;\r\n            \r\n                if (chart === ChartType.ISOTYPE_BAR_CHART) {\r\n                    fact.chart = ChartType.VERTICAL_BAR_CHART;\r\n                }\r\n                // 不会返回一个Fact对象 而是返回一个{}\r\n                // fact = customizeFact(fact);\r\n                if (!fact.chart || !isValid(fact)) {\r\n                    console.log(\"no valid\", fact)\r\n                    return null;\r\n                }\r\n\r\n                let datares = _.cloneDeep(this.props.dataresLocal);\r\n\r\n                specData = {\r\n                    ...specData,\r\n                    values: datares,\r\n                }\r\n\r\n                let width_height = { \"width\": 135, \"height\": 86 };\r\n                let size = null;\r\n                let specChart;\r\n                if (width_height) {\r\n                    specChart = {\r\n                        width: width_height.width,\r\n                        height: width_height.height,\r\n                        type: \"unitvis\",\r\n                        style: \"business\",\r\n                        duration: 0,\r\n                        showSuggestion: true, //显示图表Unsupported\r\n                    }\r\n                } else {\r\n                    specChart = {\r\n                        size: size,\r\n                        type: \"unitvis\",\r\n                        style: \"business\",\r\n                        duration: 0,\r\n                        showSuggestion: true, //显示图表Unsupported\r\n                    }\r\n                }\r\n                let specFact = {\r\n                    ...fact,\r\n                    breakdown: fact.groupby.map(d => {\r\n                        return {\r\n                            \"field\": d\r\n                        }\r\n                    }),\r\n                    index:i\r\n                }\r\n\r\n                let specNew = {\r\n                    data: specData,\r\n                    fact: specFact,\r\n                    chart: specChart,\r\n                }\r\n                let specs = specNew\r\n                let time = 6000;\r\n                let insertIndex = index + i\r\n                //添加到facts中\r\n                this.props.insertFactByFact(fact,insertIndex)\r\n                // 添加卡片到下方keyframes中\r\n                //this.props.addCard(fact,specs,time,true, insertIndex);\r\n                let myCard = {\r\n                    fact:fact,\r\n                    spec:specs,\r\n                    time:time,\r\n                    isGeneratedByAlg:true}\r\n                myCards.push(myCard)\r\n                // 添加对应的time控制的bar\r\n                let bar = { leftbar: 140, rightbar: 18,isDrag:false }\r\n                myBars.push(bar)\r\n                //this.props.addBarToTimeLineBar(bar,insertIndex)\r\n                i++;\r\n            }\r\n            \r\n            //需要一次性加入 否则会有卡片units重叠现象\r\n            this.props.addCards(myCards,index+1)\r\n            this.props.addBarsToTimeLineBar(myBars,index+1)\r\n            \r\n            this.setState({\r\n                operateState: OperationType.GENERATED\r\n            })\r\n            this.props.isUpdateEditing(false)\r\n            resolve(response)\r\n\r\n\r\n        })\r\n    }\r\n\r\n\r\n\r\n    render() {\r\n    \r\n        const { videoIndex, index } = this.props\r\n        let datares = _.cloneDeep(this.props.dataresLocal);\r\n        let schemaFilter = _.cloneDeep(this.props.schemaFilterLocal);\r\n        let schema = this.props.schema\r\n        let specData\r\n        schemaFilter ? specData = { \"schema\": schemaFilter, } : specData = { \"schema\": schema };\r\n        let uuid = uuidv4();\r\n        let vis;\r\n\r\n        if (this.props.spec !== 'empty') {\r\n            vis = narrativespec2Vis(this.props.spec, uuid);\r\n        } else {\r\n            vis = null;\r\n        }\r\n        console.log('herererre')\r\n        return (\r\n            <div\r\n                className='video-slice-card'\r\n                ref={this.props.provided.innerRef}\r\n                {...this.props.provided.draggableProps}\r\n                {...this.props.provided.dragHandleProps}>\r\n                <div\r\n                    className='complete-card'\r\n                    // style={videoIndex === index ? this.props.cardItems[index].isGeneratedByAlg?{border:\"3px solid #E4F2FB\",boxShadow: \"0 0 0 3px #ffb861, 0 0 0 2px #FFE1A4\"}:{border:\"3px solid #FFE1A4\",boxShadow: \"0 0 0 3px #ffb861, 0 0 0 2px #FFE1A4\"}: this.props.cardItems[index].isGeneratedByAlg?{border:\"3px solid #E4F2FB\"}:{border:\"3px solid #FFE1A4\"}}>\r\n                    // style={{border:\"3px solid #E4F2FB\"}}>         \r\n                    style={{background: '#f4f4f4'}}\r\n                    onClick={() => this.clickSliceCard(index)}>           \r\n                    <div className='above-card'>\r\n                        <div className='fact-description'></div>\r\n                        <div className='delete-card-btn' \r\n                        /* onClick={() => this.deleteVideoSlice(index)} */\r\n                        >\r\n                            <CloseOutlined />\r\n                        </div>\r\n                    </div> \r\n                    \r\n\r\n                    <UnitVisDraw\r\n                        index={index}\r\n                        videoIndex={videoIndex}\r\n                        vis={vis}\r\n                        playVideoSlice={this.props.playVideoSlice}\r\n                        setLeftsiderContent={this.props.setLeftsiderContent}\r\n                        {...this.props}\r\n                    />\r\n\r\n                    <SliceCardCaption\r\n                        spec = {this.props.spec}\r\n                        videoIndex={videoIndex} \r\n                        index={index}\r\n                        {...this.props}/>\r\n\r\n                    {/* <SliceCardFooter\r\n                        videoIndex={videoIndex} \r\n                        index={index}\r\n                        {...this.props}/> */}\r\n                </div>\r\n                {/* {\r\n                this.props.cardItems.length-1 == index ?\r\n                <div className=\"transition-button\" style={{opacity:'0'}}>\r\n                <div className=\"transition-icon\"></div>\r\n                </div>\r\n                :\r\n                ((this.props.cardItems[index].isGeneratedByAlg||this.props.cardItems[index+1].isGeneratedByAlg)?\r\n                <div className=\"transition-button\">\r\n                    <div className=\"cannot-transition-icon\"></div>\r\n                </div>\r\n                :\r\n                <div className=\"transition-button\" onClick={() => this.generateTransitionFacts(index)}>\r\n                    <div className=\"transition-icon\"></div>\r\n                </div>\r\n                )} */}\r\n\r\n                {/* <div className=\"transition-button\" style={{opacity:'0'}}>\r\n                <div className=\"transition-icon\"></div>\r\n                </div> */}\r\n            </div>\r\n        )\r\n    }\r\n}","import React from 'react';\r\nimport ActionType from '@/action/type';\r\nimport { is } from 'immutable'\r\nimport Immutable from 'immutable'\r\n\r\nexport default class UnitVisDraw extends React.Component {\r\n\r\n    editClickSlice = (index) => {\r\n        /* if(this.props.isPlayVideo)\r\n        {\r\n            null\r\n        }\r\n        else\r\n        {\r\n            null\r\n        } */\r\n        // 这里todo\r\n        //改变videoIndex+视频中显示的内容\r\n        // if(this.props.cardItems[index].spec == 'empty')\r\n        // {\r\n        //     var videoChart = document.querySelector('[id=\"video-chart\"]');\r\n        //     videoChart.style.display = 'none';\r\n        //     var caption = document.querySelector('[id=\"caption\"]');\r\n        //     caption.style.display = 'none';\r\n        // }\r\n        // else\r\n        // {\r\n        //     var videoChart = document.querySelector('[id=\"video-chart\"]');\r\n        //     videoChart.style.display = 'block';\r\n        //     var caption = document.querySelector('[id=\"caption\"]');\r\n        //     caption.style.display = 'block';\r\n        // }\r\n        // this.props.playVideoSlice(index)\r\n        // //改变指针的位置\r\n        // let needleNow = 0;\r\n        // for (let x = 0; x<index ;x++){\r\n        //     needleNow += 47.3 * this.props.cardItems[x].time / 6000 /this.props.sceneScale+ 7.3\r\n        // }\r\n        // this.props.setPosition(needleNow);\r\n        // //点击卡片让卡片成为正在编辑的卡片\r\n        // this.props.changeCurrentEditing(true,this.props.facts[index])\r\n        // this.props.changeNowVideoTime((needleNow-7.3*index)/47.3*6000*this.props.sceneScale)\r\n        \r\n        //改变左侧栏中显示的内容\r\n        this.props.setLeftsiderContent(ActionType.SET_EDIT_SLICE)\r\n        \r\n    }\r\n\r\n    shouldComponentUpdate(nextProps, nextState) {\r\n        console.log(\"~~~~~~~~~~\",this.props)\r\n        const pre = this.props.narrative_spec\r\n        const next = nextProps.narrative_spec\r\n        //进行深层对比，实现更精确的渲染\r\n        if (!is(Immutable.fromJS(pre), Immutable.fromJS(next))\r\n            ){\r\n            // console.log(this.props.index,'渲染！');\r\n            //如果当前的videoIndex对应的vis重新渲染改变了，那么currentSpec应该再重新取一下\r\n            /* if(index===videoIndex){\r\n                playVideoSlice(index)\r\n            }\r\n            console.log(\"fresh : \"+index) */\r\n            return true;\r\n        }\r\n        else \r\n        {\r\n            return false;\r\n        }\r\n    } \r\n\r\n    render() {\r\n        const { vis, index } = this.props\r\n        return (\r\n            <div className='below-card' onClick={() => this.editClickSlice(index)}>\r\n                {vis}\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\n\r\n","import React from 'react';\r\nimport { is } from 'immutable'\r\nimport Immutable from 'immutable'\r\n\r\nexport default class SliceCardFooter extends React.Component {\r\n    \r\n    render() {\r\n        const {index,videoIndex}=this.props\r\n        let num=index + 1 < 10 ? (\"0\" + (index + 1)) : (\"\" + (index + 1))\r\n        return (\r\n            <div className='footer-card'>\r\n                <div className='footer-num' style={{backgroundColor:\"#E4F2FB\"}}>\r\n                    {num}\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n}","import React from 'react';\nimport { is } from 'immutable'\nimport Immutable from 'immutable'\n\nexport default class SliceCardCaption extends React.Component {\n    \n    render() {\n        const {index,videoIndex,spec}=this.props\n        let myActions = this.props.spec.actions\n        let caption =myActions[myActions.length-1].style.text\n        return (\n            <div className='footer-caption'>\n                <div className='footer-text' style={{}}>\n                    {caption}\n                </div>\n            </div>\n        )\n    }\n\n}","/*!\n  Copyright (c) 2018 Jed Watson.\n  Licensed under the MIT License (MIT), see\n  http://jedwatson.github.io/classnames\n*/\n/* global define */\n\n(function () {\n\t'use strict';\n\n\tvar hasOwn = {}.hasOwnProperty;\n\n\tfunction classNames() {\n\t\tvar classes = [];\n\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tvar arg = arguments[i];\n\t\t\tif (!arg) continue;\n\n\t\t\tvar argType = typeof arg;\n\n\t\t\tif (argType === 'string' || argType === 'number') {\n\t\t\t\tclasses.push(arg);\n\t\t\t} else if (Array.isArray(arg)) {\n\t\t\t\tif (arg.length) {\n\t\t\t\t\tvar inner = classNames.apply(null, arg);\n\t\t\t\t\tif (inner) {\n\t\t\t\t\t\tclasses.push(inner);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (argType === 'object') {\n\t\t\t\tif (arg.toString === Object.prototype.toString) {\n\t\t\t\t\tfor (var key in arg) {\n\t\t\t\t\t\tif (hasOwn.call(arg, key) && arg[key]) {\n\t\t\t\t\t\t\tclasses.push(key);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tclasses.push(arg.toString());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn classes.join(' ');\n\t}\n\n\tif (typeof module !== 'undefined' && module.exports) {\n\t\tclassNames.default = classNames;\n\t\tmodule.exports = classNames;\n\t} else if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {\n\t\t// register as 'classnames', consistent with npm package name\n\t\tdefine('classnames', [], function () {\n\t\t\treturn classNames;\n\t\t});\n\t} else {\n\t\twindow.classNames = classNames;\n\t}\n}());\n","export default function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (obj) {\n    return typeof obj;\n  } : function (obj) {\n    return obj && \"function\" == typeof Symbol && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n  }, _typeof(obj);\n}","//let calliopeService = 'service.datacalliope.com';\nlet calliopeService = 'calliope-service.idvxlab.com';\n//let calliopeLiteService = 'calliope-service.idvxlab.com:8004';\n// let calliopeLiteService = 'service.datacalliope.com:8002';\n\n// let calliopeLiteService = 'calliope-service.idvxlab.com:8002';\nlet calliopeLiteService = 'urania-api.idvxlab.com:8006';\n// let applicationUrl='https://datacalliope.com';\nlet applicationUrl = 'http://calliope-dev.idvxlab.com';\n\nlet urlPrefix = process.env.NODE_ENV === 'production' ? `https://${calliopeService}:8002/api/v1` : 'http://localhost:7001/api/v1';\n// let uploadDataPrefix = process.env.NODE_ENV === 'production' ? `https://${calliopeLiteService}` : 'http://localhost:6028';//todo  7001\nlet generationUrlPrefix = process.env.NODE_ENV === 'production' ? `https://${calliopeLiteService}` : 'http://localhost:6010';//todo  7001\n\n// let question2gifPrefix = process.env.NODE_ENV === 'production' ? `https://${calliopeLiteService}` : 'http://localhost:6030';//todo  7001\n\n\nlet activitiesPrefix = process.env.NODE_ENV === 'production' ? `https://${calliopeService}:8002/log/v1` : 'http://localhost:7002/log/v1';//\nlet publicPrefix = process.env.NODE_ENV === 'production' ? applicationUrl : 'http://localhost:3000';\n//let client_id = '033338f2-02a8-44d4-8d54-5173b4a864f9';\n\nlet uploadDataPrefix = `https://${calliopeLiteService}`;\nlet question2gifPrefix =`https://${calliopeLiteService}` ;\n// let urlPrefix = `https://${calliopeService}:8002/api/v1` ;\n// let uploadDataPrefix  = `https://${calliopeLiteService}`;//todo  7001\n// let generationUrlPrefix = `https://${calliopeLiteService}`;//todo  7001\n// let activitiesPrefix = `https://${calliopeService}:8002/log/v1`;//\n// let publicPrefix = applicationUrl ;\nlet client_id = '6dcd0f8b-6990-4d69-9018-29b3351aa6ff';\nlet accountIp = `https://account.datacalliope.com`\nlet logoutRedirectUrlIp = `https://service.datacalliope.com:8001`\n\nconst config = {\n    url: {\n        share: `${uploadDataPrefix}/share`,\n        applicationUrl: applicationUrl,\n        //share\n        publicPrefix: publicPrefix,\n        //login\n        loginadmintest: `${urlPrefix}/loginadmintest`,\n        loginRedirectUrl: `${accountIp}/#/login?response_type=code&client_id=${client_id}&grant_type=authorization_code&redirect_uri=${applicationUrl}`,\n        logoutRedirectUrl: `${applicationUrl}/#/logout`,\n        authenUrl: accountIp,\n        accessToken: `${urlPrefix}/accesstoken`,\n        userImage: `${logoutRedirectUrlIp}/img`,\n        checkToken: `${urlPrefix}/checktoken`,\n        //logout\n        logout: `${urlPrefix}/logout`,\n        logoutAuthSystem: `${logoutRedirectUrlIp}/logout`,\n        //activities\n        users: `${urlPrefix}/users`,\n        activitiesApi: `${activitiesPrefix}/users`,\n        //upload\n        uploadDataPrefix: uploadDataPrefix,\n        uploadData: `${uploadDataPrefix}/upload`,\n        uploadGraphData: `${uploadDataPrefix}/uploadGraph`,\n        \n        fetch: `${uploadDataPrefix}/data/share`,\n        //story generation\n        factScoring: `${generationUrlPrefix}/fact`,\n        generateRandomly: `${generationUrlPrefix}/generate`,\n        generateGraphRandomly: `${generationUrlPrefix}/generateGraphRandomly`,\n\n        //data filter\n        filteredGenerate:`${generationUrlPrefix}/filteredgenerate`,\n\n        // data gif\n        question2gif:`${question2gifPrefix}/edit_decompose`\n    }\n}\nexport default config","import axios from 'axios';\nimport { stringify } from 'query-string';\n// import config from '@/axios/config';\n\nconst composeUrl = function (url, qs) {\n    let result = '';\n    // if (url[0] !== '/') {\n    //   result += '/';\n    // }\n    result += url;\n    if (typeof qs === 'object' && Object.keys(qs).length !== 0) {\n        result += `?${stringify(qs)}`;\n    }\n    return result;\n};\n\nexport const request = ({ url, method, param, data }) => {\n    return new Promise((reslove, reject) => {\n        axios({\n            method: method,\n            url: composeUrl(url, param),\n            data: data,\n            withCredentials: true,\n            // headers: { 'token': Cookies.get('userInfo') ? JSON.parse(Cookies.get('userInfo')).token : null },\n        }).then((response) => {\n            if (response.status >= 400) {\n                reject();\n            } else if (response.status === 200 || response.status === 201 || response.status === 204) {\n                reslove(response.data);\n            } else {\n                reject();\n            }\n        }).catch(error => {\n            if (error.response) {\n                if (error.response.status === 401) {\n                    //reject('401');\n                    reject()\n                    //退出登陆\n                    // axios({\n                    //     method: \"post\",\n                    //     url: `${config.url.logout}`,\n                    //     data: {},\n                    //     withCredentials: true\n                    // }).then((response) => {\n                    //     if (response.status === 200) {\n                    //         window.location.href = config.url.loginRedirectUrl //login first\n                    //     }\n                    // }).catch(\n                    // )\n                }\n            }\n            reject();\n        })\n    })\n};\n\nexport const requestWithoutCredentials = ({ url, method, param, data }) => {\n    return new Promise((reslove, reject) => {\n        axios({\n            method: method,\n            url: composeUrl(url, param),\n            data: data\n        }).then((response) => {\n            if (response.status >= 400) {\n                reject();\n            } else if (response.status === 200 || response.status === 201 || response.status === 204) {\n                reslove(response.data);\n            } else {\n                reject();\n            }\n        }).catch(error => {\n            reject();\n            //  message.error('error message');\n        })\n    })\n};\n\n","import * as req from './base';\nimport config from '@/axios/config';\nimport axios from 'axios';\n\n/**\n * 用户认证 相关接口\n * @param \n */\nexport async function checkToken() {\n    const data = await req.request({\n        url: `${config.url.checkToken}`,\n        method: 'post',\n        param: {},\n        data: {}\n    });\n    return data;\n}\n\nexport async function loginadmintest() {\n    const data = await req.request({\n        url: `${config.url.loginadmintest}`,\n        method: 'post',\n        param: {},\n        data: {}\n    });\n    return data;\n}\n\nexport async function accessToken(body) {\n    const data = await req.request({\n        url: `${config.url.accessToken}`,\n        method: 'post',\n        param: {},\n        data: body\n    });\n    return data;\n}\nexport async function logout() {\n    const data = await req.request({\n        url: `${config.url.logout}`,\n        method: 'post',\n        param: {},\n        data: {}\n    });\n    return data;\n}\n\n\nexport async function uploadData(formData) {\n    return new Promise((reslove, reject) => {\n        axios({\n            method: \"post\",\n            url: `${config.url.uploadData}`,\n            config: {\n                \"headers\": {\n                    'Content-Type': 'multipart/form-data' //application/json; charset=utf-8\n                },\n            },\n            data: formData\n        }).then((response) => {\n            if (response.status >= 400) {\n                reject();\n            } else if (response.status === 200 || response.status === 201 || response.status === 204) {\n                reslove(response.data);\n            } else {\n                reject();\n            }\n        }).catch(error => {\n            reject();\n            //  message.error('error message');\n        })\n    })\n}\n\n\nexport function filteredgenerate(url, data) {\n    return axios({\n        method: \"post\",\n        url: url,\n        config: {\n            \"headers\": {\n                'Content-Type': 'application/json; charset=utf-8'\n            },\n        },\n        data: data\n    })\n}\n\nexport function generate(url, data) {\n    return axios({\n        method: \"post\",\n        url: url,\n        config: {\n            \"headers\": {\n                'Content-Type': 'application/json; charset=utf-8'\n            },\n        },\n        data: data\n    })\n}\n\nexport function question2gif(url, data) {\n    return axios({\n        method: \"post\",\n        url: url,\n        config: {\n            \"headers\": {\n                'Content-Type': 'application/json; charset=utf-8'\n            },\n        },\n        data: data\n    })\n}\n\n\nexport function factScoring(filename, fact,filters, method) {\n    return axios({\n        \"method\": \"POST\",\n        \"url\": config.url.factScoring,\n        \"headers\": {\n            \"Content-Type\": \"application/json; charset=utf-8\"\n        },\n        \"data\": {\n            \"file_name\": filename,\n            \"fact\": fact,\n            \"filters\":filters,\n            \"method\": method,\n        }\n    })\n}\n\nexport async function shareStory(jsonstring) {\n    return new Promise((reslove, reject) => {\n        axios({\n            method: \"post\",\n            url: `${config.url.share}`,\n            config: {\n                \"headers\": {\n                    'Content-Type': 'application/json; charset=utf-8'\n                },\n            },\n            data: {\n                \"share_json\": jsonstring\n            }\n        }).then((response) => {\n            if (response.status >= 400) {\n                reject();\n            } else if (response.status === 200 || response.status === 201 || response.status === 204) {\n                reslove(response.data);\n            } else {\n                reject();\n            }\n        }).catch(error => {\n            reject();\n            //  message.error('error message');\n        })\n    })\n}\n\nexport async function fetchStory(id) {\n    return axios({\n        method: \"get\",\n        \"url\": `${config.url.fetch}/${id}.json`,\n        config: {\n            \"headers\": {\n                'Content-Type': 'application/json; charset=utf-8'\n            },\n        }\n    })\n}\n/*****\n *技术栈：\n ssr(后端渲染)，koa(koa-views)：模板渲染，渲染出要生成pdf的页面)\n node.js 生成pdf插件 puppeteer：将渲染的页面生成PDF\n koa-send：将生成的PDF返回给前端页面下载 \n * \n data是后端用于渲染页面的数据\n */\nexport function generatePDF(data) {\n    return axios({\n        method: 'post',\n        url: `/generatePDF`,\n        param: {},\n        data: data\n    })\n}\n\n/**\n * 数据|故事|评论 操作行为记录 API\n * @param \n */\n\nexport async function activitiesApi(uid, body) {\n    const data = await req.requestWithoutCredentials({\n        url: `${config.url.activitiesApi}/lite/activities`,\n        method: 'post',\n        param: {},\n        data: body\n    });\n    return data;\n}\n","// This icon file is generated automatically.\nvar CloseOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M563.8 512l262.5-312.9c4.4-5.2.7-13.1-6.1-13.1h-79.8c-4.7 0-9.2 2.1-12.3 5.7L511.6 449.8 295.1 191.7c-3-3.6-7.5-5.7-12.3-5.7H203c-6.8 0-10.5 7.9-6.1 13.1L459.4 512 196.9 824.9A7.95 7.95 0 00203 838h79.8c4.7 0 9.2-2.1 12.3-5.7l216.5-258.1 216.5 258.1c3 3.6 7.5 5.7 12.3 5.7h79.8c6.8 0 10.5-7.9 6.1-13.1L563.8 512z\" } }] }, \"name\": \"close\", \"theme\": \"outlined\" };\nexport default CloseOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport CloseOutlinedSvg from \"@ant-design/icons-svg/es/asn/CloseOutlined\";\nimport AntdIcon from '../components/AntdIcon';\n\nvar CloseOutlined = function CloseOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: CloseOutlinedSvg\n  }));\n};\n\nCloseOutlined.displayName = 'CloseOutlined';\nexport default /*#__PURE__*/React.forwardRef(CloseOutlined);","import {genFactSentence,genSubtitle} from '../sentencer/index';\nimport ChartType from '../constant/ChartType';\nexport default class Fact {\n    constructor(type, measure = [], subspace = [], groupby = [], focus = [], parameter = [], chart = \"\",  score = 0, information = 0, significance = 0) {\n        this.type = type;\n        this.measure = measure;\n        this.subspace = subspace;\n        this.groupby = groupby;\n        this.focus = focus;\n        this.parameter = parameter;\n        this.score = score;\n        this.information = information;\n        this.significance = significance;\n        this.chart = chart;\n        this.generatedScript = genFactSentence(this);\n        this.generatedSubtitle = genSubtitle(this)\n        //animation duration\n        this.duration = 3000;\n        // Compound Fact\n        this.aggregated = false;\n        this.aggregatedFact = null;\n        this.compoundType = '';\n        this.compoundChart = ChartType.JUXTAPOSITION;\n    }\n    script = () => this.generatedScript;\n}","import Chart from '@/Chart';\nimport React from 'react';\n\n\n\nexport const narrative_spec2cards = function(narrative_spec){\n    let spec = {\n        \"chart\" : narrative_spec.chart,\n        \"data\": narrative_spec.data,\n        \"actions\": []\n    }\n    \n    let actions = []\n    let idx_titleaction = []\n    let step_actions = []\n    if(narrative_spec.actions){\n        actions = _.cloneDeep(narrative_spec.actions)\n        actions.map((item, index) => {\n            if(item.add === \"title\" && item.style.duration !== -1)\n            idx_titleaction.push(index)\n        })\n        // duration delay = 0\n        idx_titleaction.map((d) => {\n            let eachaction = actions.slice(0,d+1)\n            eachaction.map((item) => {\n                if(item.style){\n                    item.style.delay = 0\n                    item.style.duration = 0\n                }\n\n            })\n            // remove extra title\n            eachaction.map((item, index) => {\n                if (item.add === \"title\" && index !== eachaction.length-1){\n                    eachaction.splice(index,1)\n                }\n            })\n            let step_spec = _.cloneDeep(spec)\n            step_spec.actions = eachaction\n            step_actions.push(step_spec)\n        })\n\n    }\n    return step_actions\n}\n\nexport const narrativespec2Vis = function(spec, uuid) {\n\n    return <Chart spec = {spec} uuid = { uuid }/>\n}"],"sourceRoot":""}