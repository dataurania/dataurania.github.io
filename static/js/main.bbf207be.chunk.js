(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[79],{1:function(e,t,a){"use strict";t.a={VALUE:"value",TREND:"trend",CATEGORIZATION:"categorization",DIFFERENCE:"difference",PROPORTION:"proportion",DISTRIBUTION:"distribution",RANK:"rank",ASSOCIATION:"association",EXTREME:"extreme",OUTLIER:"outlier"}},16:function(e,t,a){"use strict";t.a={SUM:"sum",MAX:"max",MIN:"min",AVG:"avg",COUNT:"count"}},168:function(e,t,a){e.exports=a(284)},259:function(e){e.exports=JSON.parse('{"addendum":"addenda","aircraft":"aircraft","alga":"algae","alumna":"alumnae","alumnus":"alumni","amoeba":"amoebae","analysis":"analyses","antenna":"antennae","antithesis":"antitheses","apex":"apices","appendix":"appendices","automaton":"automata","axis":"axes","bacillus":"bacilli","bacterium":"bacteria","barracks":"barracks","basis":"bases","beau":"beaux","bison":"bison","buffalo":"buffalo","bureau":"bureaus","cactus":"cacti","calf":"calves","carp":"carp","census":"censuses","chassis":"chassis","cherub":"cherubim","child":"children","ch\xe2teau":"ch\xe2teaus","cod":"cod","codex":"codices","concerto":"concerti","corpus":"corpora","crisis":"crises","criterion":"criteria","curriculum":"curricula","datum":"data","deer":"deer","diagnosis":"diagnoses","die":"dice","dwarf":"dwarfs","echo":"echoes","elf":"elves","elk":"elk","ellipsis":"ellipses","embargo":"embargoes","emphasis":"emphases","erratum":"errata","faux pas":"faux pas","fez":"fezes","firmware":"firmware","fish":"fish","focus":"foci","foot":"feet","formula":"formulae","fungus":"fungi","gallows":"gallows","genus":"genera","goose":"geese","graffito":"graffiti","grouse":"grouse","half":"halves","hero":"heroes","hoof":"hooves","hovercraft":"hovercraft","hypothesis":"hypotheses","index":"indices","kakapo":"kakapo","knife":"knives","larva":"larvae","leaf":"leaves","libretto":"libretti","life":"lives","loaf":"loaves","locus":"loci","louse":"lice","man":"men","matrix":"matrices","means":"means","medium":"media","media":"media","memorandum":"memoranda","millennium":"millennia","minutia":"minutiae","moose":"moose","mouse":"mice","nebula":"nebulae","nemesis":"nemeses","neurosis":"neuroses","news":"news","nucleus":"nuclei","oasis":"oases","offspring":"offspring","opus":"opera","ovum":"ova","ox":"oxen","paralysis":"paralyses","parenthesis":"parentheses","person":"people","phenomenon":"phenomena","phylum":"phyla","pike":"pike","polyhedron":"polyhedra","potato":"potatoes","prognosis":"prognoses","quiz":"quizzes","radius":"radii","referendum":"referenda","salmon":"salmon","scarf":"scarves","self":"selves","series":"series","sheep":"sheep","shelf":"shelves","shrimp":"shrimp","spacecraft":"spacecraft","species":"species","spectrum":"spectra","squid":"squid","stimulus":"stimuli","stratum":"strata","swine":"swine","syllabus":"syllabi","symposium":"symposia","synopsis":"synopses","synthesis":"syntheses","tableau":"tableaus","that":"those","thesis":"theses","thief":"thieves","this":"these","tomato":"tomatoes","tooth":"teeth","trout":"trout","tuna":"tuna","vertebra":"vertebrae","vertex":"vertices","veto":"vetoes","vita":"vitae","vortex":"vortices","watercraft":"watercraft","wharf":"wharves","wife":"wives","wolf":"wolves","woman":"women"}')},262:function(e,t,a){},266:function(e,t,a){var r={"./EditPage/DataShow":[54,9,0,1,2,3,17],"./EditPage/DataShow/":[54,9,0,1,2,3,17],"./EditPage/DataShow/DataShowView":[149,9,0,1,2,3,35],"./EditPage/DataShow/DataShowView.js":[149,9,0,1,2,3,35],"./EditPage/DataShow/DataShowView.less":[289,7,83],"./EditPage/DataShow/index":[54,9,0,1,2,3,17],"./EditPage/DataShow/index.js":[54,9,0,1,2,3,17],"./EditPage/EditDashboard":[63,9,5,8,23],"./EditPage/EditDashboard/":[63,9,5,8,23],"./EditPage/EditDashboard/EditPage":[161,9,65],"./EditPage/EditDashboard/EditPage.js":[161,9,65],"./EditPage/EditDashboard/EditPage.less":[297,7,84],"./EditPage/EditDashboard/index":[63,9,5,8,23],"./EditPage/EditDashboard/index.js":[63,9,5,8,23],"./EditPage/EditDataComics":[64,9,5,8,24],"./EditPage/EditDataComics/":[64,9,5,8,24],"./EditPage/EditDataComics/EditPage":[162,9,66],"./EditPage/EditDataComics/EditPage.js":[162,9,66],"./EditPage/EditDataComics/EditPage.less":[298,7,85],"./EditPage/EditDataComics/index":[64,9,5,8,24],"./EditPage/EditDataComics/index.js":[64,9,5,8,24],"./EditPage/EditDataVideos":[65,9,0,1,2,3,11],"./EditPage/EditDataVideos/":[65,9,0,1,2,3,11],"./EditPage/EditDataVideos/DataShow":[55,9,0,1,2,3,18],"./EditPage/EditDataVideos/DataShow/":[55,9,0,1,2,3,18],"./EditPage/EditDataVideos/DataShow/DataShowView":[150,9,0,1,2,3,36],"./EditPage/EditDataVideos/DataShow/DataShowView.js":[150,9,0,1,2,3,36],"./EditPage/EditDataVideos/DataShow/DataShowView.less":[290,7,86],"./EditPage/EditDataVideos/DataShow/index":[55,9,0,1,2,3,18],"./EditPage/EditDataVideos/DataShow/index.js":[55,9,0,1,2,3,18],"./EditPage/EditDataVideos/EditPage":[164,9,0,1,2,3,27],"./EditPage/EditDataVideos/EditPage.js":[164,9,0,1,2,3,27],"./EditPage/EditDataVideos/EditPage.less":[299,7,87],"./EditPage/EditDataVideos/Fact/Association":[128,9,0,1,2,3,40],"./EditPage/EditDataVideos/Fact/Association.js":[128,9,0,1,2,3,40],"./EditPage/EditDataVideos/Fact/Categorization":[129,9,0,1,2,3,41],"./EditPage/EditDataVideos/Fact/Categorization.js":[129,9,0,1,2,3,41],"./EditPage/EditDataVideos/Fact/Difference":[130,9,0,1,2,3,42],"./EditPage/EditDataVideos/Fact/Difference.js":[130,9,0,1,2,3,42],"./EditPage/EditDataVideos/Fact/Distribution":[131,9,0,1,2,3,43],"./EditPage/EditDataVideos/Fact/Distribution.js":[131,9,0,1,2,3,43],"./EditPage/EditDataVideos/Fact/Extreme":[132,9,0,1,2,3,39],"./EditPage/EditDataVideos/Fact/Extreme.js":[132,9,0,1,2,3,39],"./EditPage/EditDataVideos/Fact/GodFact":[167,9,0,1,2,3,44],"./EditPage/EditDataVideos/Fact/GodFact.js":[167,9,0,1,2,3,44],"./EditPage/EditDataVideos/Fact/Outlier":[133,9,0,1,2,3,45],"./EditPage/EditDataVideos/Fact/Outlier.js":[133,9,0,1,2,3,45],"./EditPage/EditDataVideos/Fact/Proportion":[134,9,0,1,2,3,46],"./EditPage/EditDataVideos/Fact/Proportion.js":[134,9,0,1,2,3,46],"./EditPage/EditDataVideos/Fact/Rank":[135,9,0,1,2,3,47],"./EditPage/EditDataVideos/Fact/Rank.js":[135,9,0,1,2,3,47],"./EditPage/EditDataVideos/Fact/Trend":[136,9,0,1,2,3,48],"./EditPage/EditDataVideos/Fact/Trend.js":[136,9,0,1,2,3,48],"./EditPage/EditDataVideos/Fact/Value":[137,9,0,1,2,3,49],"./EditPage/EditDataVideos/Fact/Value.js":[137,9,0,1,2,3,49],"./EditPage/EditDataVideos/Fact/helper":[124,9,70],"./EditPage/EditDataVideos/Fact/helper.js":[124,9,70],"./EditPage/EditDataVideos/Fact/leftFactChartEditor.less":[303,7,88],"./EditPage/EditDataVideos/LeftSidebar":[58,9,0,1,2,3,14],"./EditPage/EditDataVideos/LeftSidebar/":[58,9,0,1,2,3,14],"./EditPage/EditDataVideos/LeftSidebar/DataFact":[145,9,0,4,9,57,59],"./EditPage/EditDataVideos/LeftSidebar/DataFact.js":[145,9,0,4,9,57,59],"./EditPage/EditDataVideos/LeftSidebar/DataFilter":[144,9,0,1,2,3,38],"./EditPage/EditDataVideos/LeftSidebar/DataFilter.js":[144,9,0,1,2,3,38],"./EditPage/EditDataVideos/LeftSidebar/EditSlice":[146,9,0,1,2,3,33],"./EditPage/EditDataVideos/LeftSidebar/EditSlice.js":[146,9,0,1,2,3,33],"./EditPage/EditDataVideos/LeftSidebar/LeftSidebar":[152,9,0,1,2,3,29],"./EditPage/EditDataVideos/LeftSidebar/LeftSidebar.js":[152,9,0,1,2,3,29],"./EditPage/EditDataVideos/LeftSidebar/LeftSidebar.less":[293,7,89],"./EditPage/EditDataVideos/LeftSidebar/OperatorSequence":[148,9,0,1,2,3,31],"./EditPage/EditDataVideos/LeftSidebar/OperatorSequence.js":[148,9,0,1,2,3,31],"./EditPage/EditDataVideos/LeftSidebar/SingleOperator":[138,9,0,1,2,3,37],"./EditPage/EditDataVideos/LeftSidebar/SingleOperator.js":[138,9,0,1,2,3,37],"./EditPage/EditDataVideos/LeftSidebar/index":[58,9,0,1,2,3,14],"./EditPage/EditDataVideos/LeftSidebar/index.js":[58,9,0,1,2,3,14],"./EditPage/EditDataVideos/TalkBottomView":[59,9,0,1,2,3,22],"./EditPage/EditDataVideos/TalkBottomView/":[59,9,0,1,2,3,22],"./EditPage/EditDataVideos/TalkBottomView/TalkBottom":[125,9,0,1,2,3,52],"./EditPage/EditDataVideos/TalkBottomView/TalkBottom.js":[125,9,0,1,2,3,52],"./EditPage/EditDataVideos/TalkBottomView/TalkBottom.less":[286,7,90],"./EditPage/EditDataVideos/TalkBottomView/index":[59,9,0,1,2,3,22],"./EditPage/EditDataVideos/TalkBottomView/index.js":[59,9,0,1,2,3,22],"./EditPage/EditDataVideos/TimeLine":[53,9,5,7,10,25],"./EditPage/EditDataVideos/TimeLine/":[53,9,5,7,10,25],"./EditPage/EditDataVideos/TimeLine/Needle":[120,9,71],"./EditPage/EditDataVideos/TimeLine/Needle.js":[120,9,71],"./EditPage/EditDataVideos/TimeLine/PerSeekBar":[118,9,68],"./EditPage/EditDataVideos/TimeLine/PerSeekBar.js":[118,9,68],"./EditPage/EditDataVideos/TimeLine/TimeLine":[139,9,5,7,10,78],"./EditPage/EditDataVideos/TimeLine/TimeLine.js":[139,9,5,7,10,78],"./EditPage/EditDataVideos/TimeLine/TimeLine.less":[288,7,91],"./EditPage/EditDataVideos/TimeLine/TimeSeekBar":[126,9,5,67],"./EditPage/EditDataVideos/TimeLine/TimeSeekBar.js":[126,9,5,67],"./EditPage/EditDataVideos/TimeLine/TimelineRuler":[119,9,7,64],"./EditPage/EditDataVideos/TimeLine/TimelineRuler.css":[287,7,82],"./EditPage/EditDataVideos/TimeLine/TimelineRuler.js":[119,9,7,64],"./EditPage/EditDataVideos/TimeLine/index":[53,9,5,7,10,25],"./EditPage/EditDataVideos/TimeLine/index.js":[53,9,5,7,10,25],"./EditPage/EditDataVideos/VideoShow":[56,9,0,1,2,3,19],"./EditPage/EditDataVideos/VideoShow/":[56,9,0,1,2,3,19],"./EditPage/EditDataVideos/VideoShow/TimeDisplay":[141,9,69],"./EditPage/EditDataVideos/VideoShow/TimeDisplay.js":[141,9,69],"./EditPage/EditDataVideos/VideoShow/VideoDisplay":[142,9,0,1,4,56,63],"./EditPage/EditDataVideos/VideoShow/VideoDisplay.js":[142,9,0,1,4,56,63],"./EditPage/EditDataVideos/VideoShow/VideoShow":[155,9,0,1,2,3,34],"./EditPage/EditDataVideos/VideoShow/VideoShow.js":[155,9,0,1,2,3,34],"./EditPage/EditDataVideos/VideoShow/VideoShow.less":[291,7,92],"./EditPage/EditDataVideos/VideoShow/index":[56,9,0,1,2,3,19],"./EditPage/EditDataVideos/VideoShow/index.js":[56,9,0,1,2,3,19],"./EditPage/EditDataVideos/VideoSliceCardList":[57,9,0,1,2,4,21],"./EditPage/EditDataVideos/VideoSliceCardList/":[57,9,0,1,2,4,21],"./EditPage/EditDataVideos/VideoSliceCardList/DropView":[143,9,0,1,2,4,55],"./EditPage/EditDataVideos/VideoSliceCardList/DropView.js":[143,9,0,1,2,4,55],"./EditPage/EditDataVideos/VideoSliceCardList/FactCard":[127,9,4,9,62],"./EditPage/EditDataVideos/VideoSliceCardList/FactCard.js":[127,9,4,9,62],"./EditPage/EditDataVideos/VideoSliceCardList/SliceCard":[117,9,1,4,26,60],"./EditPage/EditDataVideos/VideoSliceCardList/SliceCard.js":[117,9,1,4,26,60],"./EditPage/EditDataVideos/VideoSliceCardList/SliceCardCaption":[123,9,72],"./EditPage/EditDataVideos/VideoSliceCardList/SliceCardCaption.js":[123,9,72],"./EditPage/EditDataVideos/VideoSliceCardList/SliceCardFooter":[122,9,73],"./EditPage/EditDataVideos/VideoSliceCardList/SliceCardFooter.js":[122,9,73],"./EditPage/EditDataVideos/VideoSliceCardList/UnitVisDraw":[121,9,26,74],"./EditPage/EditDataVideos/VideoSliceCardList/UnitVisDraw.js":[121,9,26,74],"./EditPage/EditDataVideos/VideoSliceCardList/VideoSliceCardList":[151,9,0,1,2,4,54],"./EditPage/EditDataVideos/VideoSliceCardList/VideoSliceCardList.js":[151,9,0,1,2,4,54],"./EditPage/EditDataVideos/VideoSliceCardList/VideoSliceCardList.less":[292,7,93],"./EditPage/EditDataVideos/VideoSliceCardList/index":[57,9,0,1,2,4,21],"./EditPage/EditDataVideos/VideoSliceCardList/index.js":[57,9,0,1,2,4,21],"./EditPage/EditDataVideos/icon/bg.png":[304,7,101],"./EditPage/EditDataVideos/icon/calliope_undraw.png":[305,7,102],"./EditPage/EditDataVideos/icon/categorical.png":[306,7,103],"./EditPage/EditDataVideos/icon/cursor-drag.ico":[307,7,100],"./EditPage/EditDataVideos/icon/database_black.png":[308,7,104],"./EditPage/EditDataVideos/icon/database_yellow.png":[309,7,105],"./EditPage/EditDataVideos/icon/edit_black.png":[310,7,106],"./EditPage/EditDataVideos/icon/edit_yellow.png":[311,7,107],"./EditPage/EditDataVideos/icon/error.png":[312,7,108],"./EditPage/EditDataVideos/icon/exit.png":[313,7,109],"./EditPage/EditDataVideos/icon/export_white.png":[314,7,110],"./EditPage/EditDataVideos/icon/fullscreen.png":[315,7,111],"./EditPage/EditDataVideos/icon/geo.png":[316,7,112],"./EditPage/EditDataVideos/icon/geographical.png":[317,7,113],"./EditPage/EditDataVideos/icon/icon-cannot-generate.png":[318,7,114],"./EditPage/EditDataVideos/icon/icon-generate.png":[319,7,115],"./EditPage/EditDataVideos/icon/icon-unfold.png":[320,7,116],"./EditPage/EditDataVideos/icon/icon_database_yellow.png":[321,7,117],"./EditPage/EditDataVideos/icon/icon_edit_yellow.png":[322,7,118],"./EditPage/EditDataVideos/icon/icon_input_yellow.png":[323,7,119],"./EditPage/EditDataVideos/icon/icon_voice_yellow.png":[324,7,120],"./EditPage/EditDataVideos/icon/identification.png":[325,7,121],"./EditPage/EditDataVideos/icon/input_black.png":[326,7,122],"./EditPage/EditDataVideos/icon/input_yellow.png":[327,7,123],"./EditPage/EditDataVideos/icon/next.png":[328,7,124],"./EditPage/EditDataVideos/icon/num.png":[329,7,125],"./EditPage/EditDataVideos/icon/numerical.png":[330,7,126],"./EditPage/EditDataVideos/icon/temporal.png":[331,7,127],"./EditPage/EditDataVideos/icon/toUpload.png":[332,7,128],"./EditPage/EditDataVideos/icon/toVis.png":[333,7,129],"./EditPage/EditDataVideos/icon/upload.png":[334,7,130],"./EditPage/EditDataVideos/icon/vis.png":[335,7,131],"./EditPage/EditDataVideos/icon/vis_black.png":[336,7,132],"./EditPage/EditDataVideos/icon/voice.png":[337,7,133],"./EditPage/EditDataVideos/icon/voiceGif.gif":[338,7,134],"./EditPage/EditDataVideos/icon/voice_black.png":[339,7,135],"./EditPage/EditDataVideos/icon/voice_parsing.png":[340,7,136],"./EditPage/EditDataVideos/icon/voice_yellow.png":[341,7,137],"./EditPage/EditDataVideos/index":[65,9,0,1,2,3,11],"./EditPage/EditDataVideos/index.js":[65,9,0,1,2,3,11],"./EditPage/EditFactsheet":[66,9,0,1,2,3,12],"./EditPage/EditFactsheet/":[66,9,0,1,2,3,12],"./EditPage/EditFactsheet/EditPage":[156,9,0,1,2,3,6],"./EditPage/EditFactsheet/EditPage.js":[156,9,0,1,2,3,6],"./EditPage/EditFactsheet/EditPage.less":[301,7,94],"./EditPage/EditFactsheet/index":[66,9,0,1,2,3,12],"./EditPage/EditFactsheet/index.js":[66,9,0,1,2,3,12],"./EditPage/EditView":[60,9,0,1,2,3,16],"./EditPage/EditView/":[60,9,0,1,2,3,16],"./EditPage/EditView/DropView":[147,9,9,75],"./EditPage/EditView/DropView.js":[147,9,9,75],"./EditPage/EditView/EditView":[153,9,0,1,2,3,30],"./EditPage/EditView/EditView.js":[153,9,0,1,2,3,30],"./EditPage/EditView/index":[60,9,0,1,2,3,16],"./EditPage/EditView/index.js":[60,9,0,1,2,3,16],"./EditPage/EditView/index.less":[294,7,95],"./EditPage/FactListView":[62,9,0,1,2,3,6],"./EditPage/FactListView/":[62,9,0,1,2,3,6],"./EditPage/FactListView/BarBrush":[115,9,76],"./EditPage/FactListView/BarBrush.js":[115,9,76],"./EditPage/FactListView/FactCard":[157,9,0,2,3,4,50],"./EditPage/FactListView/FactCard.js":[157,9,0,2,3,4,50],"./EditPage/FactListView/FactList":[160,9,0,1,2,3,6],"./EditPage/FactListView/FactList.js":[160,9,0,1,2,3,6],"./EditPage/FactListView/NumericalFilter":[116,9,0,2,3,51,61],"./EditPage/FactListView/NumericalFilter.js":[116,9,0,2,3,51,61],"./EditPage/FactListView/index":[62,9,0,1,2,3,6],"./EditPage/FactListView/index.js":[62,9,0,1,2,3,6],"./EditPage/FactListView/index.less":[300,7,96],"./EditPage/FactListView/schemaTest":[158,9,77],"./EditPage/FactListView/schemaTest.js":[158,9,77],"./H5page":[67,9,0,1,2,3,20],"./H5page/":[67,9,0,1,2,3,20],"./H5page/H5page":[163,9,0,1,2,3,53],"./H5page/H5page.js":[163,9,0,1,2,3,53],"./H5page/index":[67,9,0,1,2,3,20],"./H5page/index.js":[67,9,0,1,2,3,20],"./Homepage":[68,9,0,1,2,3,13],"./Homepage/":[68,9,0,1,2,3,13],"./Homepage/Content/ContentView":[159,9,0,1,58],"./Homepage/Content/ContentView.js":[159,9,0,1,58],"./Homepage/Content/ContentView.less":[296,7,97],"./Homepage/Homepage":[165,9,0,1,2,3,28],"./Homepage/Homepage.js":[165,9,0,1,2,3,28],"./Homepage/Homepage.less":[302,7,98],"./Homepage/PannelView":[61,9,0,1,2,3,15],"./Homepage/PannelView/":[61,9,0,1,2,3,15],"./Homepage/PannelView/PannelView":[154,9,0,1,2,3,32],"./Homepage/PannelView/PannelView.js":[154,9,0,1,2,3,32],"./Homepage/PannelView/PannelView.less":[295,7,99],"./Homepage/PannelView/index":[61,9,0,1,2,3,15],"./Homepage/PannelView/index.js":[61,9,0,1,2,3,15],"./Homepage/index":[68,9,0,1,2,3,13],"./Homepage/index.js":[68,9,0,1,2,3,13]};function i(e){if(!a.o(r,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],i=t[0];return Promise.all(t.slice(2).map(a.e)).then((function(){return a.t(i,t[1])}))}i.keys=function(){return Object.keys(r)},i.id=266,e.exports=i},267:function(e,t,a){},268:function(e,t,a){},27:function(e,t,a){"use strict";a.d(t,"b",(function(){return s})),a.d(t,"a",(function(){return c}));var r=a(1),i=a(28),n=a(45),o=a(0),s=function(e){var t=!1;switch(e.type){case r.a.ASSOCIATION:2===e.measure.length&&e.groupby.length&&(t=!0);break;case r.a.CATEGORIZATION:e.groupby.length&&(t=!0);break;case r.a.DIFFERENCE:e.measure.length&&e.groupby.length&&e.focus.length>=2&&(t=!0);break;case r.a.DISTRIBUTION:e.measure.length&&e.groupby.length&&(t=!0);break;case r.a.EXTREME:case r.a.OUTLIER:case r.a.PROPORTION:e.measure.length&&e.groupby.length&&e.focus.length&&(t=!0);break;case r.a.RANK:case r.a.TREND:e.measure.length&&e.groupby.length&&(t=!0);break;case r.a.VALUE:e.measure.length&&(t=!0)}return t},c=function(e,t,a){var o=Object.assign({},e);switch(e.type){case r.a.ASSOCIATION:if(o.focus=[],t&&a){var s=Object(i.a)(e.type,e.chart,t);0===o.groupby.length&&s.length>0&&(o.groupby=[s[0].field]);var c=t.filter((function(e){return"numerical"===e.type}));0===o.measure.length&&c.length>0&&(o.measure=[{field:c[0].field,aggregate:"count"}]),1===o.measure.length&&o.measure.push({field:"COUNT",aggregate:"count"})}break;case r.a.CATEGORIZATION:if(o.measure=[],o.focus=[],t&&a){var l=Object(i.a)(e.type,e.chart,t);0===o.groupby.length&&l.length>0&&(o.groupby=[l[0].field])}break;case r.a.DIFFERENCE:if(t&&a){var f=Object(i.a)(e.type,e.chart,t),p=d(a,e.groupby);0===o.groupby.length&&f.length>0&&(o.groupby=[f[0].field]),0===o.measure.length&&(o.measure=[{field:"COUNT",aggregate:"count"}]),o.focus.length||(o.focus=[{field:o.groupby[0],value:p[0]},{field:o.groupby[0],value:p[1]}])}break;case r.a.DISTRIBUTION:if(o.focus=[],t&&a){var h=Object(i.a)(e.type,e.chart,t);0===o.groupby.length&&h.length>0&&(o.groupby=[h[0].field]),0===o.measure.length&&(o.measure=[{field:"COUNT",aggregate:"count"}])}break;case r.a.EXTREME:if(t&&a){var g=Object(i.a)(e.type,e.chart,t);if(0===o.groupby.length&&g.length>0&&(o.groupby=[g[0].field]),0===o.measure.length&&(o.measure=[{field:"COUNT",aggregate:"count"}]),o.measure.length&&o.groupby.length){var y={y:{}};y.y.field=o.measure[0].field,y.y.aggregation=o.measure[0].aggregate,y.x={},y.x.field=o.groupby[0];var m=Object(n.a)(a,o.subspace),E=u(m,y),v=o.measure[0].field,b=E.reduce((function(e,t){return e[v]>t[v]?e:t}));o.focus.length||(o.focus=[{field:o.groupby[0],value:b[o.groupby[0]],extremeFocus:"max",extremeValue:b[o.measure[0].field]}])}}break;case r.a.OUTLIER:if(t&&a){var T=Object(i.a)(e.type,e.chart,t);if(0===o.groupby.length&&T.length>0&&(o.groupby=[T[0].field]),0===o.measure.length&&(o.measure=[{field:"COUNT",aggregate:"count"}]),o.measure.length&&o.groupby.length){var A={y:{}};A.y.field=o.measure[0].field,A.y.aggregation=o.measure[0].aggregate,A.x={},A.x.field=o.groupby[0];var _=Object(n.a)(a,o.subspace),O=u(_,A),C=O.sort((function(e,t){return t[A.y.field]-e[A.y.field]})).map((function(e){return e[A.x.field]})),I=O.sort((function(e,t){return t[A.y.field]-e[A.y.field]})).map((function(e){return e[A.y.field]})),R=I.length,D=parseInt(.25*(R-1)),x=parseInt(.75*(R-1)),k=.25*(R-1)-D,L=.75*(R-1)-x,w=I[D]+(I[D+1]-I[D])*k,P=I[x]+(I[x+1]-I[x])*L,N=P-1.5*(w-P),S=w+1.5*(w-P),F=[];I.forEach((function(e,t){(e>S||e<N)&&F.push(t)})),!o.focus.length&&F.length&&(o.focus=[{field:e.groupby[0],value:C[F[0]]}])}}break;case r.a.PROPORTION:if(t&&a){var V=Object(i.a)(e.type,e.chart,t);if(0===o.groupby.length&&V.length>0&&(o.groupby=[V[0].field]),0===o.measure.length&&(o.measure=[{field:"COUNT",aggregate:"count"}]),o.measure.length&&o.groupby.length){var j={y:{}};j.y.field=o.measure[0].field,j.y.aggregation=o.measure[0].aggregate,j.x={},j.x.field=o.groupby[0];var M=Object(n.a)(a,o.subspace),G=u(M,j),U=o.measure[0].field,B=G.reduce((function(e,t){return e[U]>t[U]?e:t}));o.focus.length||(o.focus=[{field:o.groupby[0],value:B[o.groupby[0]]}])}}break;case r.a.RANK:if(o.focus=[],t&&a){var H=Object(i.a)(o.type,o.chart,t);0===o.groupby.length&&H.length>0&&(o.groupby=[H[0].field]),0===o.measure.length&&(o.measure=[{field:"COUNT",aggregate:"count"}])}break;case r.a.TREND:if(o.focus=[],t&&a){var z=t.filter((function(e){return"temporal"===e.type})),W=z.map((function(e){return e.field}));0===z.length?o.groupby=[]:0!==o.groupby.length&&-1!==W.indexOf(o.groupby[0])||(o.groupby=[z[0].field]),0===o.measure.length&&(o.measure=[{field:"COUNT",aggregate:"count"}])}break;case r.a.VALUE:o.groupby=[],o.focus=[],t&&a&&0===o.measure.length&&(o.measure=[{field:"COUNT",aggregate:"count"}])}return o},l=function(e,t){return o.nest().key((function(e){return e[t.x.field]})).entries(e).map((function(e,a){var r=o.scan(e.values,(function(e,a){if(e[t.y.field]&&a[t.y.field])return a[t.y.field]-e[t.y.field]}));return r>=0?e.values[r]:e.values[0]}))},u=function(e,t){var a;switch(t.y.aggregation){case"sum":a=function(e,t){var a=o.nest().key((function(e){return e[t.x.field]})).entries(e),r=new Array(a.length).fill(0);return a.map((function(e,a){e.values.forEach((function(e){r[a]+=e[t.y.field]}));var i=Object.assign({},e.values[0]);return i[t.y.field]=r[a],i}))}(e,t);break;case"avg":a=function(e,t){var a=o.nest().key((function(e){return e[t.x.field]})).entries(e),r=new Array(a.length).fill(0);return a.map((function(e,a){e.values.forEach((function(e){r[a]+=e[t.y.field]}));var i=Object.assign({},e.values[0]);return i[t.y.field]=r[a]/e.values.length,i}))}(e,t);break;case"max":a=l(e,t);break;case"min":a=function(e,t){return o.nest().key((function(e){return e[t.x.field]})).entries(e).map((function(e){var a=o.scan(e.values,(function(e,a){if(e[t.y.field]&&a[t.y.field])return e[t.y.field]-a[t.y.field]}));return a>=0?e.values[a]:e.values[0]}))}(e,t);break;case"count":a=function(e,t){var a=o.nest().key((function(e){return e[t.x.field]})).entries(e),r=new Array(a.length).fill(0);return a.map((function(e,t){e.values.forEach((function(){r[t]+=1}));var a=Object.assign({},e.values[0]);return a.COUNT=r[t],a}))}(e,t);break;default:a=l(e,t)}return a},d=function(e,t){return t?Array.from(new Set(e.map((function(e){return e[t]})))):[]}},271:function(e,t){},28:function(e,t,a){"use strict";var r=a(48);t.a=function(e,t,a){var i=r.a.filter((function(t){return t.fact===e}));if(t&&(i=i.filter((function(e){return e.chart===t}))),0===i.length)return[];var n=new Set;i.forEach((function(e){e.breakdownType.forEach((function(e){n.add(e)}))}));var o=Array.from(n);return a.filter((function(e){return-1!==o.indexOf(e.type)}))}},281:function(e){e.exports=JSON.parse('{"1":"Easy to use","2":"Privacy security","3":"Perform on all devices","4":"Great quality","5":"Automated generation","6":"Access from anywhere","11":"Drag and drop your data file in the CSV format to the toolbox above to begin. Data files will be analyzed and shown in the animation.","21":"Your security is our priority. All our file transfers are secured with an advanced level of SSL encryption. Additionally, we destroy all files automatically from our servers.","31":"You do not need to register or install a software. Urania works perfectly on all devices and popular browsers: Chrome, Safari, Edge and Firefox.","41":"The system employs the most advanced AI technology to ensure the best quality of automated animation generation.","51":"You can convert your CSV data file directly into animation by simply input a data query in nature language.","61":"You can access the free Urania anywhere, with an internet connection. Urania operates fully in the cloud.","Calliope":"Calliope","Calliope\xb7Sheets":"Urania","slogan":"Powering the future with data!","UploadDescription":"Upload your data","About":"About","INSIGHTFUL":"INSIGHTFUL","EFFICIENT":"EFFICIENT","EXPRESSIVE":"EXPRESSIVE","About us":"About us","Contact us":"Contact us","WeiChat":"WeiChat","Tiktok":"Tiktok","Click to upload":"Click to upload","Upload":"Upload","or drag a csv file here":"or drag a csv file here (no more than 5MB) ","logIn":"log in","logOut":"log out","ToFactsheet":"to factsheet","ToDashboard":"to dashboard","ToDataComics":"to comics","ToDataVideos":"to video","ToH5":"to H5","Coverting":"Generating","Success":"Success","Howtoconvert":"How to create visual narratives:","step1":"1. Upload your data file to Calliope\xb7Sheets. ","step2":"2. Calliope\xb7Sheets will instantly analyze your data and show the results in a chosen visual narrative form.","step3":"3. Download or share the generation results as a PDF file or H5 page.","Coming soon":"Coming soon...","convertedTxt":"Based on your data file a visual factsheet has been generated !","convertedTxtH5":"Based on your data file a visual H5 page has been generated !","Visit":"Visit ","VisitCalliope":"to edit your factsheet","Download":"Download","Open H5":"Open","Regnerate":"Regnerate","nameEditor":"please input name","Datafacts":"Data facts","Edit":"Edit","Rate":"Rate","RateError":"you have rated before!","Uploading file":"Uploading file","upload failed":"Please check your csv file","larger than 5MB":"Calliope\xb7Sheets system will only process CSV files less than 5MB.","downloading":"Downloading","adding":"Adding new fact","Morefacts":"More facts","ChartEditor":"Chart Editor","Save":"Save","Cancel":"Cancel","type":"type","measure":"measure","subspace":"subspace","groupby":"groupby","group by":"group by","focus":"focus","value":"value","trend":"trend","categorization":"categorization","difference":"difference","proportion":"proportion","distribution":"distribution","rank":"rank","association":"association","extreme":"extreme","outlier":"outlier","visualization":"vis","field":"field","breakdown":"breakdown","publish":"Publish","Data":"Data","Design":"Design","Topic Filter":"Topic Filter","Data Fact":"Data Fact","Selected":"Selected ","Update":"Update","Topic Label":"Topic Label","Chart Configuration":"Chart Configuration","Caption":"Caption","Back":"Back","OK":"OK","values":"values","Generating...":"Generating...","Regenerate":"Regenerate","Data Scope":"Data Scope","All":"All ","Animated Charts":"Animation","Animation Time":"Animation Time","Display Settings":"Display Settings","Loop":"Loop","Play Type":"Play Type","Play in Sequence":"In Sequence","Play Together":"Together","Topic":"Topic","Filter":"Filter","Fact":"Fact","Export":"Export","Add Operator":"Add Operator"}')},282:function(e){e.exports=JSON.parse('{"1":"\u4fbf\u6377\u5316\u7684\u4f7f\u7528","2":"\u4e0d\u7528\u62c5\u5fc3\u5b89\u5168\u95ee\u9898","3":"\u9002\u7528\u6240\u6709\u8bbe\u5907","4":"\u9ad8\u8d28\u91cf","5":"\u81ea\u52a8\u751f\u6210","6":"\u968f\u65f6\u968f\u5730\u4f7f\u7528","11":"\u5c06\u60a8\u7684CSV\u683c\u5f0f\u4e0b\u7684\u6570\u636e\u6587\u4ef6\u62d6\u653e\u81f3\u4e0a\u8fb9\u7684\u6587\u4ef6\u63a5\u6536\u6846\u5185\uff0c\u7cfb\u7edf\u5c06\u81ea\u52a8\u4e3a\u60a8\u751f\u6210\u6570\u636e\u52a8\u753b\u5185\u5bb9\u3002","21":"\u786e\u4fdd\u6587\u6863\u5b89\u5168\u662f\u6211\u4eec\u7684\u9996\u8981\u4efb\u52a1\u3002\u6211\u4eec\u7684\u6240\u6709\u6587\u4ef6\u8f6c\u6362\u5668\u5747\u4f7f\u7528\u9ad8\u7ea7SSL\u52a0\u5bc6\u6280\u672f\u3002\u6b64\u5916\uff0c\u6211\u4eec\u4e5f\u4f1a\u81ea\u52a8\u4ece\u670d\u52a1\u5668\u9500\u6bc1\u6240\u6709\u6587\u4ef6\u3002","31":"\u65e0\u9700\u6ce8\u518c\u6216\u5b89\u88c5\u8f6f\u4ef6\u3002\u5728\u7ebfPDF\u8f6c\u6362\u5668\u53ef\u5b8c\u7f8e\u9002\u7528\u4e8e\u6240\u6709\u8bbe\u5907\u4ee5\u53caEdge\u3001Firefox\u3001Chrome \u548c Safari \u7b49\u73b0\u4ee3\u6d4f\u89c8\u5668\u3002","41":"\u4eb2\u81ea\u4f53\u9a8c\u4e00\u4e0b\u5427\uff01\u7cfb\u7edf\u5df2\u91c7\u7528\u5148\u8fdb\u7684\u4eba\u5de5\u667a\u80fd\u6280\u672f\u4ee5\u786e\u4fdd\u6570\u636e\u52a8\u753b\u7684\u751f\u6210\u8d28\u91cf\u3002","51":"\u901a\u8fc7 Urania \u60a8\u53ea\u9700\u7528\u4f7f\u7528\u81ea\u7136\u8bed\u8a00\u8f93\u5165\u95ee\u9898\uff0c\u5373\u53ef\u5c06 CSV \u6570\u636e\u6587\u4ef6\u76f4\u63a5\u8f6c\u6362\u4e3a\u6570\u636e\u52a8\u753b\u3002","61":"\u53ea\u8981\u6709\u7f51\u7edc\u8fde\u63a5\uff0c\u60a8\u5c31\u53ef\u4ee5\u5728\u4efb\u4f55\u5730\u65b9\u4f7f\u7528\u514d\u8d39\u7684\u6570\u636e\u52a8\u753b\u751f\u6210\u5de5\u5177\u3002Urania \u5b8c\u5168\u5728\u4e91\u7aef\u8fd0\u4f5c\u3002","Calliope":"Calliope","Calliope\xb7Sheets":"Urania","slogan":"\u7528\u6570\u636e\u63cf\u7ed8\u672a\u6765!","UploadDescription":"\u4e0a\u4f20\u6570\u636e\u6587\u4ef6","About":"\u5173\u4e8e","INSIGHTFUL":"\u6d1e\u5bdf","EFFICIENT":"\u9ad8\u6548","EXPRESSIVE":"\u8868\u73b0","About us":"\u5173\u4e8e\u6211\u4eec","Contact us":"\u8054\u7cfb\u6211\u4eec","WeiChat":"\u5fae\u4fe1","Tiktok":"\u6296\u97f3","Click to upload":"\u70b9\u51fb\u4e0a\u4f20","Upload":"\u4e0a\u4f20\u6587\u4ef6","or drag a csv file here":"\u6216\u8005\u62d6\u62fd\u6587\u4ef6\u4e0a\u4f20(\u5c0f\u4e8e5MB)","logIn":"\u767b\u9646","logOut":"\u9000\u51fa","ToFactsheet":"\u751f\u6210\u4e8b\u5b9e\u8868\u5355","ToDashboard":"\u751f\u6210\u53ef\u89c6\u5316\u5927\u5c4f","ToDataComics":"\u751f\u6210\u6570\u636e\u6f2b\u753b","ToDataVideos":"\u751f\u6210\u6570\u636e\u89c6\u9891","ToH5":"\u751f\u6210H5\u9875\u9762","Coverting":"\u751f\u6210\u4e2d","Success":"\u751f\u6210\u6210\u529f","Howtoconvert":"\u5982\u4f55\u5c06\u6570\u636e\u6587\u4ef6\u8f6c\u6362\u4e3a\u5176\u4ed6\u53ef\u89c6\u5316\u56fe\u8868\u5185\u5bb9:","step1":"1.\u5c06\u60a8\u7684CSV\u683c\u5f0f\u4e0b\u7684\u6570\u636e\u6587\u4ef6\u4e0a\u4f20\u81f3 Calliope\xb7Sheets\u3002","step2":"2.\u7cfb\u7edf\u5c06\u81ea\u52a8\u4e3a\u60a8\u62bd\u53d6\u6570\u636e\u5185\u6db5\u5e76\u751f\u6210\u76f8\u5e94\u7684\u53ef\u89c6\u5316\u5185\u5bb9\u5448\u73b0\u3002","step3":"3.\u5c06\u751f\u6210\u7ed3\u679c\u4e0b\u8f7d\u5230\u60a8\u7684\u8bbe\u5907\u6216\u5728\u7f51\u7edc\u4e2d\u4e0e\u4ed6\u4eba\u5171\u4eab\u3002","Coming soon":"\u529f\u80fd\u6b63\u5728\u5f00\u53d1\u4e2d...","convertedTxt":"\u57fa\u4e8e\u60a8\u7684\u6570\u636e\u6587\u4ef6\uff0c\u5df2\u7ecf\u751f\u6210\u4e86\u4e00\u4e2a\u53ef\u89c6\u5316\u7684\u4e8b\u5b9e\u8868\u5355!","convertedTxtH5":"\u57fa\u4e8e\u60a8\u7684\u6570\u636e\u6587\u4ef6\uff0c\u5df2\u7ecf\u751f\u6210\u4e86\u4e00\u4e2a\u53ef\u89c6\u5316\u7684H5\u9875\u9762!","Visit":"\u4f7f\u7528","VisitCalliope":"\u7f16\u8f91\u4f60\u7684\u6570\u636e\u4e8b\u5b9e\u62a5\u8868","Download":"\u4e0b\u8f7d","Regnerate":"\u91cd\u65b0\u751f\u6210","Open H5":"\u6253\u5f00","nameEditor":"\u8bf7\u8f93\u5165\u6545\u4e8b\u540d\u79f0","Datafacts":"\u6570\u636e\u4e8b\u5b9e","Edit":"\u7f16\u8f91","Rate":"\u8bc4\u5206","RateError":"\u60a8\u5df2\u7ecf\u6253\u8fc7\u5206\u6570\u4e86\uff01","Uploading file":"\u6587\u4ef6\u4e0a\u4f20\u4e2d","upload failed":"\u6587\u4ef6\u4e0a\u4f20\u5931\u8d25","larger than 5MB":"\u7528\u4e8e\u529f\u80fd\u5c55\u793a\u7684 Calliope\xb7Sheets \u7cfb\u7edf\u4ec5\u7528\u4e8e\u5904\u7406\u5c0f\u4e8e5MB\u7684CSV\u6587\u4ef6\u3002","downloading":"\u6b63\u5728\u4e0b\u8f7d","adding":"\u6b63\u5728\u6dfb\u52a0\u65b0\u6570\u636e\u4e8b\u5b9e","Morefacts":"\u66f4\u591a\u4e8b\u5b9e","ChartEditor":"\u56fe\u8868\u7f16\u8f91\u5668","Save":"\u4fdd\u5b58","Cancel":"\u53d6\u6d88","type":"\u7c7b\u578b","measure":"\u6d4b\u5ea6","subspace":"\u5b50\u7a7a\u95f4","groupby":"\u5206\u7ec4","group by":"\u5206\u7ec4","focus":"\u7126\u70b9","value":"\u6570\u503c","trend":"\u8d8b\u52bf","categorization":"\u5206\u7c7b","difference":"\u5dee\u5f02","proportion":"\u5360\u6bd4","distribution":"\u5206\u5e03","rank":"\u6392\u540d","association":"\u76f8\u5173","extreme":"\u6781\u503c","outlier":"\u5f02\u5e38","visualization":"\u53ef\u89c6\u5316","field":"\u5b57\u6bb5","breakdown":"\u5206\u7ec4","publish":"\u53d1\u5e03","Data":"\u6570\u636e","Design":"\u8bbe\u8ba1","Topic Filter":"\u4e3b\u9898\u9009\u62e9","Data Fact":"\u66f4\u591a\u6570\u636e\u4e8b\u5b9e","Update":"\u66f4\u65b0","Topic Label":"\u8bdd\u9898\u6807\u7b7e","Chart Configuration":"\u56fe\u8868\u914d\u7f6e","Caption":"\u8bf4\u660e","Back":"\u8fd4\u56de","OK":"\u786e\u5b9a","values":"\u53d6\u503c","Generating...":"\u751f\u6210\u4e2d...","Regenerate":"\u91cd\u65b0\u751f\u6210","Data Scope":"\u6570\u636e\u8303\u56f4","All":"\u6240\u6709\u7684","Selected":"\u5df2\u9009\u62e9\u7684","Animated Charts":"\u52a8\u753b","Animation Time":"\u52a8\u753b\u65f6\u957f","Display Settings":"\u52a8\u753b\u8bbe\u7f6e","Loop":"\u5faa\u73af","Play Type":"\u64ad\u653e\u65b9\u5f0f","Play in Sequence":"\u987a\u5e8f\u64ad\u653e","Play Together":"\u540c\u6b65\u64ad\u653e","Topic":"\u4e3b\u9898","Filter":"\u9009\u62e9","Fact":"\u4e8b\u5b9e","Export":"\u5bfc\u51fa","Add Operator":"\u6dfb\u52a0\u5206\u6790\u6b65\u9aa4"}')},284:function(e,t,a){"use strict";a.r(t),a.d(t,"AutoAni",(function(){return ae}));var r=a(2),i=a.n(r),n=a(42),o=a.n(n),s=a(43),c=a(34),l=a(108),u=a(14),d=a(33),f=a(89),p=a(7),h=a(52),g=a(12),y=a.n(g),m=a(0),E=localStorage.getItem("uuid")?JSON.parse(sessionStorage.getItem("uuid")):null,v=a(91),b=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"single",a=e;if("single"===t)return a;if("plural"===t){if(-1===a.indexOf(" of "))return v(a,2);var r=a.split(" "),i=r.indexOf("of")-1;if(i>-1){var n=v(r[i],2);return a.replace(r[i],n)}}},T={fileName:".csv",real_filename:".csv",title:"",subtitle:"",data:[],schema:[],method:"sig",facts:[],unusedFacts:[],relations:[],hoverFactIndex:-1,selectedFactIndex:0,maxStoryLength:6,timeLimit:2e3,information:40,resultCoverage:1,chartDiversity:0,aggregationLevel:0,rewardWeight:{logicality:.33,diversity:.33,integrity:.33},generateProgress:0,visData:{},uuid:E,historyStory:"",isExportPdf:!0,generateUrl:"",filters:[],filtersTitle:"",datares:[],schemaFilter:[],filtersChangeFlag:!1,editstate:!1,editingCurrentFact:null,filtersLocal:[],filtersTitleLocal:"",dataresLocal:[],schemaFilterLocal:[],leftPaneWidth:"21%",rightPaneWidth:"21%",animationFlag:!1,animationType:"\u987a\u5e8f\u64ad\u653e"},A=a(46),_=a.n(A),O=a(83),C=a(86),I=_.a.get("userInfo")&&JSON.parse(_.a.get("userInfo"))?JSON.parse(_.a.get("userInfo")):{username:"",uid:-1},R={isLogin:-1!==I.uid,userInfo:I,operateState:O.a.BEFORE_UPLOAD,convertType:C.a.FACTSHEET,currentLocale:"",isClosePannel:!1},D=a(90),x={cardItems:[],videoIndex:0,currentSpec:{},nowVideoTime:0,allVideoTime:0,isPlayVideo:!1,leftContent:p.a.SET_DEFAULT,barWidthList:[],dragDirection:"null",isMouseDown:!1,isDrag:!1,currentX:0,leftOffsetWidth:0,rightOffsetWidth:0,currentBarIndex:-1,scenePosition:0,sceneScale:1,dragCursor:!1,question:"",narrative_spec:"",isGenerating:!1,temp_spec:"",operatorType:!1,animationType:!1,keys:[]},k=Object(c.c)({story:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:T,a=arguments.length>1?arguments[1]:void 0,r=Object.assign({},t);switch(a.type){case p.a.INIT_RELATION:return r.relations=a.storyRelations,r.resultCoverage=0,r;case p.a.INIT_FACT:return r.facts=a.storyFacts,r.resultCoverage=0,r;case p.a.SELECT_FACT:return r.selectedFactIndex=a.index,r;case p.a.ADD_FACT:return e=r.unusedFacts.slice(),r.unusedFacts=e.concat(a.facts),r;case p.a.UPDATE_FACT:r.selectedFactIndex=a.index;var i=y.a.cloneDeep(a.fact);return(e=r.facts.slice())[a.index]=i,r.facts=e,r.relations=Array(r.facts.length).fill("none"),r;case p.a.INSERT_FACT:e=r.facts.slice();var n=r.unusedFacts.slice(),o=n.splice(a.index,1)[0];return e.splice(a.insert,0,o),r.facts=e,r.unusedFacts=n,r.relations=Array(e.length).fill("none"),r;case p.a.INSERT_FACT_BY_FACT:e=r.facts.slice();var s=a.fact;return e.splice(a.insert,0,s),r.facts=e,r.relations=Array(e.length).fill("none"),r;case p.a.CHANGE_FACT:var c=r.facts[a.origin],l=r.facts[a.target];return(e=r.facts.slice())[a.origin]=l,e[a.target]=c,r.facts=e,r;case p.a.DELETE_FACT:return(e=r.facts.slice()).splice(a.index,1),e.length,r.facts=e,r.selectedFactIndex=e.length-1,r.relations=Array(r.facts.length).fill("none"),r;case p.a.DELETE_UNUSEDFACT:return(e=r.unusedFacts.slice()).splice(a.index,1),r.unusedFacts=e,r;case p.a.ORDER_FACTS:var g=(e=r.facts.slice()).splice(a.sourceIndex,1),E=Object(d.a)(g,1),v=E[0];return e.splice(a.sourceIndex<a.destinationIndex?a.destinationIndex-1:a.destinationIndex,0,v),r.facts=e,r.selectedFactIndex=a.destinationIndex,r.relations=Array(r.facts.length).fill("none"),r;case p.a.SET_HOVER_INDEX:return r.hoverFactIndex=a.index,r;case p.a.CHANGE_METHOD:return r.method=a.method,r;case p.a.SET_STORY_PARAMETER:return r.maxStoryLength=a.maxStoryLength,r.information=a.information,r.chartDiversity=a.chartDiversity,a.chartDiversity!==t.chartDiversity&&(e=r.facts.slice(),e=Object(f.b)(e,t.schema,a.chartDiversity),r.facts=e),r.timeLimit=a.timeLimit,r;case p.a.SET_AGGREGATION_LEVEL:return r.aggregationLevel=a.level,r;case p.a.SET_REWARD_WEIGHT:var A=Object.assign({},r.rewardWeight);return A.logicality=a.logicality,A.diversity=a.diversity,A.integrity=a.integrity,r.rewardWeight=A,r;case p.a.GENERATE_STORY:return r.facts=a.facts,r.relations=a.relations,r.resultCoverage=a.coverage,r.selectedFactIndex=a.facts.length-1,r;case p.a.UPDATE_PROGRESS:return r.generateProgress=Number(100*((a.totalLength-a.currentLength)/a.totalLength).toFixed(2)),r;case p.a.EXPORT_PDF:return r.isExportPdf=a.isExportPdf,r;case p.a.CHANGE_TITLE:return r.title=a.title,r;case p.a.CHANGE_SUBTITLE:return r.subtitle=a.subtitle,r;case p.a.CHANGE_CURRENT_EDITING:return r.editstate=a.editstate,r.editingCurrentFact=a.editingCurrentFact,r;case p.a.UPLOAD_DATA:return r.fileName=a.fileName,r.real_filename=a.real_filename,r.title=Object(h.c)(a.real_filename),r.facts=[],r.relations=[],r.schema=a.schema,r.data=a.data,r.filters=a.schema.filter((function(e){return"text"!==e.type&&"ID"!==e.type})).map((function(e){return"numerical"===e.type?{field:e.field,type:"equal",value:e.values.map((function(e){return e.replace(",","")})),value1:[Math.min.apply(Math,Object(u.a)(e.values.map((function(e){return e.replace(",","")})))),Math.max.apply(Math,Object(u.a)(e.values.map((function(e){return e.replace(",","")}))))]}:"temporal"===e.type?{field:e.field,type:"equal",value:e.values,value2:[0,100],value3:[0,e.values.length-1]}:{field:e.field,type:"equal",value:e.values}})),r.filtersTitle=a.schema.filter((function(e){return"text"!==e.type&&"ID"!==e.type&&("categorical"===e.type||"temporal"===e.type||"geographical"===e.type)})).map((function(e){return"categorical"===e.type||"geographical"===e.type?{field:e.field,type:e.type,title:"All "+b(e.field,"plural")}:"temporal"===e.type?{field:e.field,type:"temporal",title:e.values[0]+"-"+e.values[e.values.length-1]}:void 0})),r.datares=a.data,r.schemaFilter=a.schema,r.filtersLocal=a.schema.filter((function(e){return"text"!==e.type&&"ID"!==e.type})).map((function(e){return"numerical"===e.type?{field:e.field,type:"equal",value:e.values.map((function(e){return e.replace(",","")})),value1:[Math.min.apply(Math,Object(u.a)(e.values.map((function(e){return e.replace(",","")})))),Math.max.apply(Math,Object(u.a)(e.values.map((function(e){return e.replace(",","")}))))]}:"temporal"===e.type?{field:e.field,type:"equal",value:e.values,value2:[0,100],value3:[0,e.values.length-1]}:{field:e.field,type:"equal",value:e.values}})),r.filtersTitleLocal=a.schema.filter((function(e){return"text"!==e.type&&"ID"!==e.type&&("categorical"===e.type||"temporal"===e.type||"geographical"===e.type)})).map((function(e){return"categorical"===e.type||"geographical"===e.type?{field:e.field,type:e.type,title:"All "+b(e.field,"plural")}:"temporal"===e.type?{field:e.field,type:"temporal",title:e.values[0]+"-"+e.values[e.values.length-1]}:void 0})),r.dataresLocal=a.data,r.schemaFilterLocal=a.schema,r;case p.a.CONNECT_DATA:return r.fileName=a.fileName,r.real_filename=a.real_filename,r.title=Object(h.c)(a.real_filename),r.facts=[],r.relations=[],r.schema=a.schema,r.data=a.data,r.resultCoverage=0,r.filters=a.schema.filter((function(e){return"text"!==e.type&&"ID"!==e.type})).map((function(e){return"numerical"===e.type?{field:e.field,type:"equal",value:e.values.map((function(e){return e.replace(",","")})),value1:[Math.min.apply(Math,Object(u.a)(e.values.map((function(e){return e.replace(",","")})))),Math.max.apply(Math,Object(u.a)(e.values.map((function(e){return e.replace(",","")}))))]}:"temporal"===e.type?{field:e.field,type:"equal",value:e.values,value2:[0,100],value3:[0,e.values.length-1]}:{field:e.field,type:"equal",value:e.values}})),r.filtersTitle=a.schema.filter((function(e){return"text"!==e.type&&"ID"!==e.type&&("categorical"===e.type||"temporal"===e.type||"geographical"===e.type)})).map((function(e){return"categorical"===e.type||"geographical"===e.type?{field:e.field,type:e.type,title:"All "+b(e.field,"plural")}:"temporal"===e.type?{field:e.field,type:"temporal",title:e.values[0]+"-"+e.values[e.values.length-1]}:void 0})),r.datares=a.data,r.schemaFilter=a.schema,r.filtersLocal=a.schema.filter((function(e){return"text"!==e.type&&"ID"!==e.type})).map((function(e){return"numerical"===e.type?{field:e.field,type:"equal",value:e.values.map((function(e){return e.replace(",","")})),value1:[Math.min.apply(Math,Object(u.a)(e.values.map((function(e){return e.replace(",","")})))),Math.max.apply(Math,Object(u.a)(e.values.map((function(e){return e.replace(",","")}))))]}:"temporal"===e.type?{field:e.field,type:"equal",value:e.values,value2:[0,100],value3:[0,e.values.length-1]}:{field:e.field,type:"equal",value:e.values}})),r.filtersTitleLocal=a.schema.filter((function(e){return"text"!==e.type&&"ID"!==e.type&&("categorical"===e.type||"temporal"===e.type||"geographical"===e.type)})).map((function(e){return"categorical"===e.type||"geographical"===e.type?{field:e.field,type:e.type,title:"All "+b(e.field,"plural")}:"temporal"===e.type?{field:e.field,type:"temporal",title:e.values[0]+"-"+e.values[e.values.length-1]}:void 0})),r.dataresLocal=a.data,r.schemaFilterLocal=a.schema,r;case p.a.UPDATE_COMMENT_STORY_INFO:return r.facts=a.facts,r.relations=a.relations,r.schema=a.schema,r.data=a.data,r.title=a.title||"",r.subtitle=a.subtitle||"",r.fileName=a.fileName||"",r.real_filename=a.real_filename||"",r.storyParameter=a.storyParameter,r.aggregationLevel=a.aggregationLevel,r.resultCoverage=a.resultCoverage,r.historyStory={historyfacts:r.facts,historyTitle:r.title,historySubtitle:r.subtitle,historStoryParameter:r.storyParameter,historyAggregationLevel:r.aggregationLevel,historyResultCoverage:r.resultCoverage},r.filters=a.schema.filter((function(e){return"text"!==e.type&&"ID"!==e.type})).map((function(e){return"numerical"===e.type?{field:e.field,type:"equal",value:e.values.map((function(e){return e.replace(",","")})),value1:[Math.min.apply(Math,Object(u.a)(e.values.map((function(e){return e.replace(",","")})))),Math.max.apply(Math,Object(u.a)(e.values.map((function(e){return e.replace(",","")}))))]}:"temporal"===e.type?{field:e.field,type:"equal",value:e.values,value2:[0,100],value3:[0,e.values.length-1]}:{field:e.field,type:"equal",value:e.values}})),r.filtersTitle=a.schema.filter((function(e){return"text"!==e.type&&"ID"!==e.type&&("categorical"===e.type||"temporal"===e.type||"geographical"===e.type)})).map((function(e){return"categorical"===e.type||"geographical"===e.type?{field:e.field,type:e.type,title:"All "+b(e.field,"plural")}:"temporal"===e.type?{field:e.field,type:"temporal",title:e.values[0]+"-"+e.values[e.values.length-1]}:void 0})),r.datares=a.data,r.schemaFilter=a.schema,r.filtersLocal=a.schema.filter((function(e){return"text"!==e.type&&"ID"!==e.type})).map((function(e){return"numerical"===e.type?{field:e.field,type:"equal",value:e.values.map((function(e){return e.replace(",","")})),value1:[Math.min.apply(Math,Object(u.a)(e.values.map((function(e){return e.replace(",","")})))),Math.max.apply(Math,Object(u.a)(e.values.map((function(e){return e.replace(",","")}))))]}:"temporal"===e.type?{field:e.field,type:"equal",value:e.values,value2:[0,100],value3:[0,e.values.length-1]}:{field:e.field,type:"equal",value:e.values}})),r.filtersTitleLocal=a.schema.filter((function(e){return"text"!==e.type&&"ID"!==e.type&&("categorical"===e.type||"temporal"===e.type||"geographical"===e.type)})).map((function(e){return"categorical"===e.type||"geographical"===e.type?{field:e.field,type:e.type,title:"All "+b(e.field,"plural")}:"temporal"===e.type?{field:e.field,type:"temporal",title:e.values[0]+"-"+e.values[e.values.length-1]}:void 0})),r.dataresLocal=a.data,r.schemaFilterLocal=a.schema,r;case p.a.VISUALIZE_DATA:return r.visData=a.visData,r;case p.a.UPDATE_UUID:return localStorage.setItem("uuid",JSON.stringify(a.uuid)),r.uuid=a.uuid,r;case p.a.UPDATE_DATA_URL:return r.generateUrl=a.generateUrl,r;case p.a.CHANGE_TO_ANIMATION:return r.animationFlag=a.animationFlag,r;case p.a.UPDATE_PANNEL_WIDTH:return r.leftPaneWidth=a.leftPaneWidth,r.rightPaneWidth=a.rightPaneWidth,r;case p.a.UPDATE_FILTERS:var _=y.a.cloneDeep(r.schema).filter((function(e){return"text"!==e.type&&"ID"!==e.type})),O=y.a.cloneDeep(r.data),C=[],I=a.filters;I.map((function(e,t){C=[];var a=e.field;e.value.map((function(e){var r,i;"numerical"===_[t].type?(r=C).push.apply(r,Object(u.a)(O.filter((function(t){return t[a]==parseFloat(e)})))):(i=C).push.apply(i,Object(u.a)(O.filter((function(t){return t[a]==e}))))})),O=C}));for(var R=y.a.cloneDeep(r.schema),D=[],x=0;x<I.length;x++)D.push(I[x].field);for(var k=0;k<R.length;k++)if("ID"!==R[k].type&&"text"!==R[k].type){var L=R[k].field,w=D.indexOf(L);R[k].values=y.a.cloneDeep(I[w].value),"numerical"===R[k].type&&(R[k].mean=m.mean(I[w].value),R[k].median=m.median(I[w].value),R[k].std=m.deviation(I[w].value),R[k].var=m.variance(I[w].value))}return r.filters=a.filters,r.datares=C,r.schemaFilter=R,r;case p.a.UPDATE_FILTERS_TITLE:return r.filtersTitle=a.filtersTitle,r;case p.a.UPDATE_DATARES:return r.datares=a.dateres,r;case p.a.UPDATE_SCHEMA_FILTER:return r.schemaFilter=a.schemaFilter,r;case p.a.UPDATE_FILTERS_CHANGE_FLAG:return r.filtersChangeFlag=a.filtersChangeFlag,r;case p.a.UPDATE_FILTERS_LOCAL:return r.filtersLocal=a.filtersLocal,r.schemaFilterLocal=a.schemaFilterLocal,r.dataresLocal=a.dataresLocal,r.filtersTitleLocal=a.filtersTitleLocal,r}return r},user:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:R,t=arguments.length>1?arguments[1]:void 0,a=Object.assign({},e);switch(t.type){case p.a.UPDATE_USER_INFO:return a.userInfo=t.userInfo,-1===t.userInfo.uid?a.isLogin=!1:a.isLogin=!0,a;case p.a.UPDATE_USER_OPERATION:return a.operateState=t.operateState,a;case p.a.UPDATE_CONVERT_TYPE:return a.convertType=t.convertType,a;case p.a.CLOSE_PANNEL:return a.isClosePannel=t.isClose,a;case p.a.UPDATE_LOCALE:return a.currentLocale=t.currentLocale,a}return a},video:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=arguments.length>1?arguments[1]:void 0,a=Object.assign({},e);switch(t.type){case p.a.INIT_VIDOE_CARD:var r=[],i={};return t.facts.map((function(e,a){var n,o;n=t.schemaFilter?{schema:t.schemaFilter}:{schema:t.schema},o="empty"!==e?Object(D.a)(t.filename,n,e,t.datares,null,{width:477,height:268},!0):"empty",0===a&&(i={fact:e,spec:o,time:6e3,isGeneratedByAlg:!1}),r=[].concat(Object(u.a)(r),[{fact:e,spec:o,time:6e3,isGeneratedByAlg:!1}])})),a.cardItems=r,a.currentSpec=i.spec,a;case p.a.REPLAY_VIDEO_SLICE:return a.videoIndex=0,a.currentSpec=a.cardItems[0].spec,a;case p.a.PLAY_VIDEO_SLICE:return a.videoIndex=t.index,a.currentSpec=a.cardItems[t.index].spec,a;case p.a.PLAY_VIDEO_CONTINUE:return a.isPlayVideo=!0,a;case p.a.ADD_NOW_VIDEO_TIME:return a.nowVideoTime=a.nowVideoTime+5,a;case p.a.CHANGE_NOW_VIDEO_TIME:return a.nowVideoTime=t.time,a;case p.a.CHANGE_ALL_VIDEO_TIME:return a.allVideoTime=t.time,a;case p.a.STOP_PLAY_VIDEO_CONTINUE:return a.isPlayVideo=!1,a;case p.a.ADD_EMPTY_CARD:return a.cardItems=[].concat(Object(u.a)(a.cardItems),[{fact:"empty",spec:"empty",time:6e3,isGeneratedByAlg:!1}]),a.barWidthList=[].concat(Object(u.a)(a.barWidthList),[{leftbar:140,rightbar:18,isDrag:!1}]),a.allVideoTime=a.allVideoTime+6e3,a;case p.a.REMOVE_CARD:return a.cardItems.length>0&&(a.allVideoTime=a.allVideoTime-a.cardItems[t.index].time,a.cardItems=a.cardItems.filter((function(e,a){return a!==t.index}))),a;case p.a.ADD_CARD:var n=y.a.cloneDeep(t.fact),o=t.insert,s=y.a.cloneDeep(a.cardItems),c={fact:n,spec:t.specs,time:t.time,isGeneratedByAlg:t.isGeneratedByAlg};return s.splice(o,0,c),a.cardItems=s,console.log(a),a;case p.a.ADD_CARDS:for(var l=y.a.cloneDeep(t.cards),d=t.insert,f=y.a.cloneDeep(a.cardItems),h=0;h<l.length;h++)f.splice(d+h,0,l[h]);return a.cardItems=f,a;case p.a.CHANGE_CARD:var g=y.a.cloneDeep(a.cardItems),m=t.origin,E=t.target;return m>E?(g.splice(E,0,g[m]),g.splice(m+1,1)):(g.splice(E+1,0,g[m]),g.splice(m,1)),a.cardItems=g,console.log(a),a;case p.a.EXCHANGE_CARD:var v=y.a.cloneDeep(a.cardItems),b=t.index,T=t.card;return v.splice(b,1,T),a.cardItems=v,console.log(a),a;case p.a.CHANGE_CARD_FLAG:return(g=y.a.cloneDeep(a.cardItems))[t.index].isGeneratedByAlg=t.flag,a.cardItems=g,a;case p.a.SET_LEFTSIDER_CONTENT:return a.leftContent=t.content,a;case p.a.INIT_TIME_LINE_BAR_WDITH:for(var A=[],_=0;_<t.length;_++)A=[].concat(Object(u.a)(A),[{leftbar:140,rightbar:18,isDrag:!1}]);return a.barWidthList=A,a;case p.a.ADD_BAR_TO_TIME_LINE_BAR:var O=t.bar;O={leftbar:140,rightbar:18,isDrag:!1};var C=t.index,I=y.a.cloneDeep(a.barWidthList);return I.splice(C,0,O),a.barWidthList=I,a.allVideoTime=a.allVideoTime+6e3,a;case p.a.ADD_BARS_TO_TIME_LINE_BAR:for(var R=t.bars,k=t.index,L=y.a.cloneDeep(a.barWidthList),w=0;w<R.length;w++)L.splice(k+w,0,R[w]);return a.barWidthList=L,a.allVideoTime=a.allVideoTime+6e3*R.length,a;case p.a.DELETE_BAR_FROM_TIME_LINE_BAR:var P=t.index,N=y.a.cloneDeep(a.barWidthList);return N.splice(P,1),a.barWidthList=N,a;case p.a.CHANGE_TIME_LINE_BAR:var S=y.a.cloneDeep(a.barWidthList),F=t.origin,V=t.target;return F>V?(S.splice(V,0,S[F]),S.splice(F+1,1)):(S.splice(V+1,0,S[F]),S.splice(F,1)),a.barWidthList=S,a;case p.a.SET_LEFT_BAR_WIDTH:var j=y.a.cloneDeep(a.barWidthList);j[t.index].leftbar=t.width,a.barWidthList=j;var M=y.a.cloneDeep(a.cardItems),G=M[t.index].time;return M[t.index].time=Math.floor(42.8571429*t.width),a.cardItems=M,a.allVideoTime=a.allVideoTime+(M[t.index].time-G),a;case p.a.SET_RIGHT_BAR_WIDTH:var U=y.a.cloneDeep(a.barWidthList);return U[t.index].rightbar=t.width,a.barWidthList=U,a;case p.a.SET_DRAG_DIRECTION:return a.dragDirection=t.direction,a;case p.a.SET_MOUSE_DOWN_STATE:return a.isMouseDown=t.mouseDown,a;case p.a.SET_DRAG_STATE:var B=y.a.cloneDeep(a.barWidthList);return B[t.index].isDrag=t.drag,a.barWidthList=B,a;case p.a.SET_CURRENT_X:return a.currentX=t.clientx,a;case p.a.SET_LEFT_OFFSET_WIDTH:return a.leftOffsetWidth=t.offset,a;case p.a.SET_RIGHT_OFFSET_WIDTH:return a.rightOffsetWidth=t.offset,a;case p.a.SET_CURRENT_BAR_INDEX:return a.currentBarIndex=t.index,a;case p.a.SET_POSITION:return a.scenePosition=t.position,a;case p.a.SET_SCENE_SCALE:return a.sceneScale=t.scale,a;case p.a.SET_DRAG_CURSOR:return a.dragCursor=t.cursor,a;case p.a.QUESTION_2_GIF:return a.question=t.question,a.narrative_spec=t.narrative_spec,a;case p.a.ISGENERATINGGIF:return a.isGenerating=t.isGenerating,a.narrative_spec="",a;case p.a.CHANGE_TEMP_SPEC:return a.temp_spec=t.temp_spec,a;case p.a.OPERATOR_CHANGE:return a.operatorType=t.operatorType,a;case p.a.ANIMATION_CHANGE:return a.animationType=t.animationType,a;case p.a.CHANGE_KEYS:return a.keys=t.keys,a;case p.a.CHANGE_OPERATOR:var H=y.a.cloneDeep(a.narrative_spec.operators),z=t.origin,W=t.target;return z>W?(H.splice(W,0,H[z]),H.splice(z+1,1)):(H.splice(W+1,0,H[z]),H.splice(z,1)),a.narrative_spec.operators=H,console.log(a),a}return a}}),L=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||c.d,w=[l.a];var P=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(c.e)(k,e,L(c.a.apply(void 0,w)))}(),N=(a(262),a(263),a(112)),S=a(4),F=a(5),V=a(9),j=a(8),M=a(88),G=function(e){Object(V.a)(a,e);var t=Object(j.a)(a);function a(){return Object(S.a)(this,a),t.apply(this,arguments)}return Object(F.a)(a,[{key:"render",value:function(){var e=this.props,t=e.isLoading,a=e.error;return t?i.a.createElement("div",null,"Loading..."):a?i.a.createElement("div",null,"Sorry, there was a problem loading the page."):null}}]),a}(r.Component),U=a(109),B=a.n(U),H=function(e){return B()({loader:function(){return a(266)("./".concat(e))},loading:G})},z=(a(267),a(268),a(80)),W=a.n(z),X=a(17),q=a(111),Y=["MyComponent"];a(279),a(280);var K={"en-US":a(281),"zh-CN":a(282)},Z=function(e){Object(V.a)(a,e);var t=Object(j.a)(a);function a(){var e;Object(S.a)(this,a);for(var r=arguments.length,i=new Array(r),n=0;n<r;n++)i[n]=arguments[n];return(e=t.call.apply(t,[this].concat(i))).state={initDone:!1,currentLocale:""},e.initDefaultLang=function(){var t=(navigator.language||navigator.userLanguage).substr(0,2);t="zh"===t?"zh-CN":"en-US",e.state.currentLocale!==t&&e.loadLocales(t)},e}return Object(F.a)(a,[{key:"loadLocales",value:function(e){var t=this;W.a.init({currentLocale:e,locales:K}).then((function(){t.props.updateLocale(e),t.setState({initDone:!0,currentLocale:e})}))}},{key:"componentDidMount",value:function(){this.initDefaultLang()}},{key:"render",value:function(){var e=this,t=this.state,a=t.initDone,r=t.currentLocale,n=function(t){var n=t.MyComponent,o=Object(N.a)(t,Y);return i.a.createElement(X.a,Object.assign({},o,{render:function(t){return i.a.createElement(n,Object.assign({intl:W.a,initDone:a,currentLocale:r,onChangeLocaleListener:function(t){return e.loadLocales(t)}},t))}}))};return i.a.createElement(q.a,null,i.a.createElement(X.c,null,i.a.createElement(n,{exact:!0,path:"/",MyComponent:H("Homepage/index")}),i.a.createElement(n,{exact:!0,path:"/edit/datavideos",MyComponent:H("EditPage/EditDataVideos/index")})))}}]),a}(i.a.Component),J=Object(s.b)((function(e){return{}}),(function(e){return{updateLocale:function(t){return e(M.c(t))}}}))(Z);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Q=a(10),$=a(47),ee=a.n($),te=a(79),ae=function(){function e(){if(Object(S.a)(this,e),e.instance)return e.instance;this._container=document.createElement("div"),this._paragraph=document.createElement("p"),this._spec={},this._timeouts=[],this.autovis=new ee.a,e.instance=this}return Object(F.a)(e,[{key:"container",value:function(e){if(!e)return this._container;this._container=e}},{key:"paragraph",value:function(e){if(!e)return this._paragraph;this._paragraph=e}},{key:"load",value:function(e){this._spec=e}},{key:"play",value:function(){var e=this,t=0,a=new te.Fade;a.container(this.container()),a.duration(500);var r,i=this._spec,n=i.data,o=i.specs,s=Object(Q.a)(o);try{var c=function(){var i=r.value;i.data=n;var o=JSON.parse(JSON.stringify(i));e._timeouts.push(setTimeout(function(){this.autovis.container(this.container()),this.autovis.paragraph(this.paragraph()),this.autovis.load(o),this.autovis.shouldShowCaption(!0),this.autovis.generate()}.bind(e),t)),t+=4e3,t+=1500,e._timeouts.push(setTimeout((function(){a.animateTransition()}),t)),t+=500};for(s.s();!(r=s.n()).done;)c()}catch(l){s.e(l)}finally{s.f()}}},{key:"stop",value:function(){for(var e=0;e<this._timeouts.length;e++)clearTimeout(this._timeouts[e])}}]),e}();o.a.render(i.a.createElement(s.a,{store:P},i.a.createElement(J,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},3:function(e,t,a){"use strict";t.a={JUXTAPOSITION:"juxtaposition",AREA_CHART:"Area Chart",VERTICAL_BAR_CHART:"Vertical Bar Chart",VERTICAL_DIFFERENCE_BAR_CHART:"Vertical Difference Bar Chart",VERTICAL_DIFFERENCE_ARROW_CHART:"Vertical Difference Arrow Chart",HORIZONTAL_BAR_CHART:"Horizontal Bar Chart",PROGRESS_BAR_CHART:"Progress Bar Chart",STACKED_BAR_CHART:"Stacked Bar Chart",ISOTYPE_BAR_CHART:"Isotype Bar Chart",PROPORTION_ISOTYPE_CHART:"Proportion Isotype Chart",COLOR_FILLING_MAP:"Color Filling Map",BUBBLE_CHART:"Bubble Chart",TEXT_CHART:"Text Chart",LINE_CHART:"Line Chart",STACKED_LINE_CHART:"Stacked Line Chart",RING_CHART:"Ring Chart",HALF_RING_CHART:"Half Ring Chart",PIE_CHART:"Pie Chart",SCATTER_PLOT:"Scatter Plot",TREE_MAP:"Treemap",BUBBLE_MAP:"Bubblemap"}},32:function(e,t,a){"use strict";var r=a(1),i=a(3),n=a(6),o=[{fact:r.a.ASSOCIATION,chart:i.a.SCATTER_PLOT,breakdownType:[n.a.CATEGORICAL,n.a.TEMPORAL]},{fact:r.a.OUTLIER,chart:i.a.VERTICAL_BAR_CHART,breakdownType:[n.a.CATEGORICAL,n.a.CATEGORICAL]},{fact:r.a.OUTLIER,chart:i.a.AREA_CHART,breakdownType:[n.a.TEMPORAL]},{fact:r.a.OUTLIER,chart:i.a.LINE_CHART,breakdownType:[n.a.TEMPORAL]},{fact:r.a.OUTLIER,chart:i.a.COLOR_FILLING_MAP,breakdownType:[n.a.GEOGRAPHICAL]},{fact:r.a.EXTREME,chart:i.a.VERTICAL_BAR_CHART,breakdownType:[n.a.CATEGORICAL,n.a.CATEGORICAL]},{fact:r.a.EXTREME,chart:i.a.TEXT_CHART,breakdownType:[n.a.CATEGORICAL]},{fact:r.a.EXTREME,chart:i.a.LINE_CHART,breakdownType:[n.a.TEMPORAL]},{fact:r.a.EXTREME,chart:i.a.COLOR_FILLING_MAP,breakdownType:[n.a.GEOGRAPHICAL]},{fact:r.a.PROPORTION,chart:i.a.PROGRESS_BAR_CHART,breakdownType:[n.a.CATEGORICAL]},{fact:r.a.PROPORTION,chart:i.a.RING_CHART,breakdownType:[n.a.CATEGORICAL]},{fact:r.a.PROPORTION,chart:i.a.PIE_CHART,breakdownType:[n.a.CATEGORICAL]},{fact:r.a.PROPORTION,chart:i.a.COLOR_FILLING_MAP,breakdownType:[n.a.GEOGRAPHICAL]},{fact:r.a.PROPORTION,chart:i.a.BUBBLE_MAP,breakdownType:[n.a.GEOGRAPHICAL]},{fact:r.a.RANK,chart:i.a.HORIZONTAL_BAR_CHART,breakdownType:[n.a.CATEGORICAL]},{fact:r.a.RANK,chart:i.a.COLOR_FILLING_MAP,breakdownType:[n.a.GEOGRAPHICAL]},{fact:r.a.RANK,chart:i.a.BUBBLE_MAP,breakdownType:[n.a.GEOGRAPHICAL]},{fact:r.a.DISTRIBUTION,chart:i.a.COLOR_FILLING_MAP,breakdownType:[n.a.GEOGRAPHICAL]},{fact:r.a.DISTRIBUTION,chart:i.a.BUBBLE_MAP,breakdownType:[n.a.GEOGRAPHICAL]},{fact:r.a.DISTRIBUTION,chart:i.a.AREA_CHART,breakdownType:[n.a.TEMPORAL]},{fact:r.a.DISTRIBUTION,chart:i.a.TREE_MAP,breakdownType:[n.a.CATEGORICAL],rang:[6,1e4]},{fact:r.a.DISTRIBUTION,chart:i.a.VERTICAL_BAR_CHART,breakdownType:[n.a.CATEGORICAL],rang:[0,9]},{fact:r.a.DIFFERENCE,chart:i.a.COLOR_FILLING_MAP,breakdownType:[n.a.GEOGRAPHICAL]},{fact:r.a.DIFFERENCE,chart:i.a.VERTICAL_BAR_CHART,breakdownType:[n.a.CATEGORICAL]},{fact:r.a.CATEGORIZATION,chart:i.a.COLOR_FILLING_MAP,breakdownType:[n.a.GEOGRAPHICAL]},{fact:r.a.CATEGORIZATION,chart:i.a.TREE_MAP,breakdownType:[n.a.CATEGORICAL],rang:[6,1e4]},{fact:r.a.CATEGORIZATION,chart:i.a.VERTICAL_BAR_CHART,breakdownType:[n.a.CATEGORICAL],rang:[0,9]},{fact:r.a.CATEGORIZATION,chart:i.a.BUBBLE_CHART,breakdownType:[n.a.CATEGORICAL],rang:[6,9]},{fact:r.a.TREND,chart:i.a.LINE_CHART,breakdownType:[n.a.TEMPORAL]},{fact:r.a.TREND,chart:i.a.AREA_CHART,breakdownType:[n.a.TEMPORAL]},{fact:r.a.VALUE,chart:i.a.TEXT_CHART,breakdownType:[]}],s=a(48);t.a=function e(t,a){var r,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2],c=a.filter((function(e){return e.field===t.groupby[0]}))[0],l=i?s.a:o;return r=l.filter((function(e){return e.fact===t.type})),c&&(r=r.filter((function(e){return-1!==e.breakdownType.indexOf(c.type)})),c.type===n.a.CATEGORICAL&&c.values&&(r=r.filter((function(e){return!e.rang||c.values.length>=e.rang[0]&&c.values.length<=e.rang[1]}))),0!==r.length||i||(r=e(t,a,!0))),r}},44:function(e,t,a){"use strict";a.d(t,"a",(function(){return u}));var r=a(4),i=a(5),n=a(9),o=a(8),s=a(2),c=a.n(s),l=(a(140),a(92)),u=function(e){Object(n.a)(a,e);var t=Object(o.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=this.props.uuid,t=this.props.spec,a=e?"#vischart_".concat(e):"#demo-chart";console.log(Boolean(e)),this.narrativechart=new l.a,this.narrativechart.container(a),this.narrativechart.load(t),this.narrativechart.generate()}},{key:"componentDidUpdate",value:function(){var e=this.props.uuid,t=e?"#vischart_".concat(e):"#demo-chart",a=this.props.spec;this.narrativechart.container(t),this.narrativechart.load(a),this.narrativechart.generate()}},{key:"render",value:function(){var e=640,t=640;if(this.props.spec.chart)switch(this.props.spec.chart.size){case"wide":e=220,t=560;break;case"middle":e=200,t=360;break;case"small":case"unitvis":e=150,t=235}var a=this.props.uuid?this.props.uuid:"demo-chart";return console.log(e),c.a.createElement("div",{id:a?"vischart_".concat(a):"demo-chart",style:{height:e,width:t,margin:"0 auto"}})}}]),a}(s.Component)},45:function(e,t,a){"use strict";var r=a(10);t.a=function(e,t){var a,i=e,n=Object(r.a)(t);try{var o=function(){var e=a.value;i=i.filter((function(t){return t[e.field]===e.value}))};for(n.s();!(a=n.n()).done;)o()}catch(s){n.e(s)}finally{n.f()}return i}},48:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var r=a(1),i=a(3),n=a(6),o=[{fact:r.a.ASSOCIATION,chart:i.a.SCATTER_PLOT,breakdownType:[n.a.CATEGORICAL,n.a.TEMPORAL]},{fact:r.a.OUTLIER,chart:i.a.VERTICAL_BAR_CHART,breakdownType:[n.a.CATEGORICAL,n.a.TEMPORAL]},{fact:r.a.OUTLIER,chart:i.a.AREA_CHART,breakdownType:[n.a.TEMPORAL]},{fact:r.a.OUTLIER,chart:i.a.LINE_CHART,breakdownType:[n.a.TEMPORAL]},{fact:r.a.OUTLIER,chart:i.a.BUBBLE_CHART,breakdownType:[n.a.CATEGORICAL,n.a.TEMPORAL],rang:[6,9]},{fact:r.a.OUTLIER,chart:i.a.COLOR_FILLING_MAP,breakdownType:[n.a.GEOGRAPHICAL]},{fact:r.a.EXTREME,chart:i.a.VERTICAL_BAR_CHART,breakdownType:[n.a.CATEGORICAL,n.a.TEMPORAL]},{fact:r.a.EXTREME,chart:i.a.TEXT_CHART,breakdownType:[n.a.CATEGORICAL,n.a.TEMPORAL]},{fact:r.a.EXTREME,chart:i.a.LINE_CHART,breakdownType:[n.a.TEMPORAL]},{fact:r.a.EXTREME,chart:i.a.COLOR_FILLING_MAP,breakdownType:[n.a.GEOGRAPHICAL]},{fact:r.a.PROPORTION,chart:i.a.PROGRESS_BAR_CHART,breakdownType:[n.a.CATEGORICAL,n.a.TEMPORAL]},{fact:r.a.PROPORTION,chart:i.a.TREE_MAP,breakdownType:[n.a.CATEGORICAL,n.a.TEMPORAL]},{fact:r.a.PROPORTION,chart:i.a.RING_CHART,breakdownType:[n.a.CATEGORICAL,n.a.TEMPORAL]},{fact:r.a.PROPORTION,chart:i.a.PIE_CHART,breakdownType:[n.a.CATEGORICAL,n.a.TEMPORAL]},{fact:r.a.PROPORTION,chart:i.a.COLOR_FILLING_MAP,breakdownType:[n.a.GEOGRAPHICAL]},{fact:r.a.PROPORTION,chart:i.a.BUBBLE_MAP,breakdownType:[n.a.GEOGRAPHICAL]},{fact:r.a.RANK,chart:i.a.HORIZONTAL_BAR_CHART,breakdownType:[n.a.CATEGORICAL,n.a.TEMPORAL]},{fact:r.a.RANK,chart:i.a.COLOR_FILLING_MAP,breakdownType:[n.a.GEOGRAPHICAL]},{fact:r.a.RANK,chart:i.a.BUBBLE_MAP,breakdownType:[n.a.GEOGRAPHICAL]},{fact:r.a.DISTRIBUTION,chart:i.a.COLOR_FILLING_MAP,breakdownType:[n.a.GEOGRAPHICAL]},{fact:r.a.DISTRIBUTION,chart:i.a.BUBBLE_MAP,breakdownType:[n.a.GEOGRAPHICAL]},{fact:r.a.DISTRIBUTION,chart:i.a.BUBBLE_CHART,breakdownType:[n.a.CATEGORICAL,n.a.TEMPORAL]},{fact:r.a.DISTRIBUTION,chart:i.a.AREA_CHART,breakdownType:[n.a.TEMPORAL]},{fact:r.a.DISTRIBUTION,chart:i.a.TREE_MAP,breakdownType:[n.a.CATEGORICAL,n.a.TEMPORAL],rang:[6,1e4]},{fact:r.a.DISTRIBUTION,chart:i.a.VERTICAL_BAR_CHART,breakdownType:[n.a.CATEGORICAL,n.a.TEMPORAL],rang:[0,9]},{fact:r.a.DISTRIBUTION,chart:i.a.HORIZONTAL_BAR_CHART,breakdownType:[n.a.CATEGORICAL,n.a.TEMPORAL]},{fact:r.a.DISTRIBUTION,chart:i.a.PIE_CHART,breakdownType:[n.a.CATEGORICAL,n.a.TEMPORAL]},{fact:r.a.DIFFERENCE,chart:i.a.COLOR_FILLING_MAP,breakdownType:[n.a.GEOGRAPHICAL]},{fact:r.a.DIFFERENCE,chart:i.a.VERTICAL_BAR_CHART,breakdownType:[n.a.CATEGORICAL,n.a.TEMPORAL]},{fact:r.a.DIFFERENCE,chart:i.a.PIE_CHART,breakdownType:[n.a.CATEGORICAL,n.a.TEMPORAL]},{fact:r.a.DIFFERENCE,chart:i.a.HORIZONTAL_BAR_CHART,breakdownType:[n.a.CATEGORICAL,n.a.TEMPORAL]},{fact:r.a.CATEGORIZATION,chart:i.a.COLOR_FILLING_MAP,breakdownType:[n.a.GEOGRAPHICAL]},{fact:r.a.CATEGORIZATION,chart:i.a.TREE_MAP,breakdownType:[n.a.CATEGORICAL],rang:[6,1e4]},{fact:r.a.CATEGORIZATION,chart:i.a.VERTICAL_BAR_CHART,breakdownType:[n.a.CATEGORICAL],rang:[0,9]},{fact:r.a.CATEGORIZATION,chart:i.a.BUBBLE_CHART,breakdownType:[n.a.CATEGORICAL],rang:[6,9]},{fact:r.a.TREND,chart:i.a.LINE_CHART,breakdownType:[n.a.TEMPORAL]},{fact:r.a.TREND,chart:i.a.AREA_CHART,breakdownType:[n.a.TEMPORAL]},{fact:r.a.TREND,chart:i.a.VERTICAL_BAR_CHART,rang:[0,9],breakdownType:[n.a.TEMPORAL,n.a.CATEGORICAL]},{fact:r.a.TREND,chart:i.a.BUBBLE_CHART,rang:[6,9],breakdownType:[n.a.TEMPORAL,n.a.TEMPORAL]},{fact:r.a.VALUE,chart:i.a.TEXT_CHART,breakdownType:[]},{fact:r.a.VALUE,chart:i.a.HORIZONTAL_BAR_CHART,breakdownType:[]},{fact:r.a.VALUE,chart:i.a.VERTICAL_BAR_CHART,breakdownType:[]},{fact:r.a.VALUE,chart:i.a.BUBBLE_MAP,breakdownType:[]},{fact:r.a.VALUE,chart:i.a.COLOR_FILLING_MAP,breakdownType:[]}]},52:function(e,t,a){"use strict";a.d(t,"a",(function(){return j})),a.d(t,"b",(function(){return M})),a.d(t,"c",(function(){return G}));var r=a(1),i=[{id:0,template:"When {{subspace}}, in general, there is a {{positive/negative}} correlation between {{measure1}} and {{measure2}}."},{id:1,template:"When {{subspace}}, in general, {{measure2}} has a {{positive/negative}} relationship with {{measure1}}."},{id:2,template:"When {{subspace}}, in general, {{measure2}} has a {{positive/negative}} relationship with {{measure1}} (Pearson correlation coefficient = {{parameter}})."}],n=[{id:0,template:"When {{subspace}}, there are {{parameter}} categories of {{groupby}}s, including {{no.1}}, {{no.2}}, {{no.3}}."},{id:1,template:"When {{subspace}}, the data are grouped into {{parameter}} {{groupby}}s, including {{no.1}}, {{no.2}}, {{no.3}}."},{id:2,template:"When {{subspace}}, the data include {{parameter}} groups of {{groupby}}s, including {{no.1}}, {{no.2}}, {{no.3}}."}],o=[{id:0,template:"When {{subspace}}, the difference between {{focus1}} and {{focus2}} is {{parameter}} in terms of {{agg}} {{measure}}."},{id:1,template:"When {{subspace}}, {{focus1}} and {{focus2}}'s difference on the {{agg}} {{measure}} is {{parameter}}."},{id:2,template:"When {{subspace}}, {{focus1}} is {{parameter}} {{higher/lower}} than {{focus2}} in terms of {{agg}} {{measure}}."}],s=[{id:0,template:"When {{subspace}}, the distribution of the {{agg}} {{measure}}, by different {{groupby}}s, is as follows."},{id:1,template:"When {{subspace}}, the breakdown of the {{agg}} {{measure}}, by different {{groupby}}s, is as follows."},{id:2,template:"When {{subspace}}, here is the distribution of the {{agg}} {{measure}}, by different {{groupby}}s."}],c=[{id:0,template:"When {{subspace}}, among all {{groupby}}s, {{parameter[0]}} has the {{focus}} {{agg}} {{measure}} value, which is {{parameter[1]}}."},{id:1,template:"When {{subspace}}, {{parameter[0]}} is the {{groupby}} that has the {{focus}} {{agg}} {{measure}} value, which is {{parameter[1]}}."},{id:2,template:"When {{subspace}}, among all {{groupby}}s, {{parameter[0]}} has the {{focus}} {{agg}} {{measure}} value."}],l=[{id:0,template:"When {{subspace}}, the {{agg}} {{measure}} of {{focus}} is an outlier when compared with that of other {{groupby}}s."},{id:1,template:"When {{subspace}}, {{focus}}'s {{agg}} {{measure}} is anomalously different from that of other {{groupby}}s'."},{id:2,template:"When {{subspace}}, the {{agg}} {{measure}} of {{focus}} is anomalously different when compared with that of other {{groupby}}s."}],u=[{id:0,template:"When {{subspace}}, the {{focus}} accounts for {{parameter}} of the {{agg}} {{measure}}."},{id:1,template:"When {{subspace}}, the {{focus}} makes up {{parameter}} of the {{agg}} {{measure}}."},{id:2,template:"When {{subspace}}, the percentage of the {{focus}} in {{agg}} {{measure}} is {{parameter}}."}],d=[{id:0,template:"When {{subspace}}, the top three {{groupby}}s, ordered by their {{agg}} {{measure}}, are {{no.1}}, {{no.2}}, and {{no.3}}."},{id:1,template:"When {{subspace}}, {{no.1}}, {{no.2}}, and {{no.3}} are the three {{groupby}}s that have the highest {{agg}} {{measure}}."},{id:2,template:"When {{subspace}}, {{no.1}}, {{no.2}}, and {{no.3}} are the top three {{groupby}}s in terms of {{agg}} {{measure}}."}],f=[{id:0,template:"When {{subspace}}, the {{agg}} {{measure}}  is {{parameter}} over time in general."},{id:1,template:"When {{subspace}}, the {{agg}} {{measure}}  has a/an {{parameter}} trend."},{id:2,template:"When {{subspace}}, the {{agg}} {{measure}}  is {{parameter}} over the {{groupby}}s in general."}],p=[{id:0,template:"When {{subspace}}, the {{agg}} {{measure}} is {{parameter}}."},{id:1,template:"When {{subspace}}, the value of the {{agg}} {{measure}} is {{parameter}}."},{id:2,template:"When {{subspace}}, the {{agg}} value of {{measure}} is {{parameter}}."}],h=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,a=[];switch(e){case r.a.ASSOCIATION:a=i;break;case r.a.CATEGORIZATION:a=n;break;case r.a.DIFFERENCE:a=o;break;case r.a.DISTRIBUTION:a=s;break;case r.a.EXTREME:a=c;break;case r.a.OUTLIER:a=l;break;case r.a.PROPORTION:a=u;break;case r.a.RANK:a=d;break;case r.a.TREND:a=f;break;case r.a.VALUE:a=p}-1===t&&(t=Math.floor(10*Math.random())%3);var h="";try{h=a[t].template}catch(g){console.error(g),console.log("wrong id:"+t)}return h},g=[{id:0,template:"\u5f53{{subspace}}\u65f6\uff0c\u603b\u4f53\u770b\uff0c {{measure1}} \u548c {{measure2}} \u4e4b\u95f4\u5b58\u5728 {{\u6b63/\u8d1f}} \u76f8\u5173\u5173\u7cfb."},{id:1,template:"\u5f53{{subspace}}\u65f6\uff0c\u603b\u4f53\u770b\uff0c {{measure1}} \u548c {{measure2}} \u5448 {{\u6b63/\u8d1f}} \u76f8\u5173."},{id:2,template:"\u5f53{{subspace}}\u65f6\uff0c\u603b\u4f53\u770b\uff0c {{measure1}} \u548c {{measure2}} \u5448 {{\u6b63/\u8d1f}} \u76f8\u5173\uff08\u76ae\u5c14\u68ee\u76f8\u5173\u7cfb\u6570={{parameter}}\uff09."}],y=[{id:0,template:"\u5f53{{subspace}}\u65f6\uff0c {{groupby}} \u5305\u542b\u4e86 {{parameter}} \u4e2a\u7c7b\u522b: {{no.1}}\u3001{{no.2}}\u3001{{no.3}}"},{id:1,template:"\u5f53{{subspace}}\u65f6\uff0c\u6570\u636e\u4e2d\u7684 {{groupby}}s \u53ef\u4ee5\u88ab\u5f52\u4e3a {{parameter}} \u7c7b\uff0c\u5305\u62ec {{no.1}}\u3001{{no.2}}\u3001{{no.3}}"},{id:2,template:"\u5f53{{subspace}}\u65f6\uff0c\u6570\u636e\u4e2d\u5305\u542b {{parameter}} \u79cd {{groupby}}s\uff0c\u5206\u522b\u662f {{no.1}}\u3001{{no.2}}\u3001{{no.3}}."}],m=[{id:0,template:"\u5f53{{subspace}}\u65f6\uff0c\u82e5\u6211\u4eec\u6bd4\u8f83 {{focus1}} \u548c {{focus2}} \u5728 {{agg}} {{measure}} \u4e0a\u7684\u5dee\u5f02\uff0c\u5b83\u4eec\u76f8\u5dee {{parameter}}."},{id:1,template:"\u5f53{{subspace}}\u65f6\uff0c {{focus1} }\u548c {{focus2}} \u5728 {{agg}} {{measure}} \u4e0a\u7684\u5dee\u503c\u4e3a {{parameter}}."},{id:2,template:"\u5f53{{subspace}}\u65f6\uff0c\u5982\u679c\u6bd4\u8f83 {{agg}} {{measure}}\uff0c {{focus1}} \u6bd4 {{focus2}}\u8981 {{\u9ad8/\u4f4e}} {{parameter}}."}],E=[{id:0,template:"\u5f53{{subspace}}\u65f6\uff0c {{agg}} {{measure}} \u5728\u4e0d\u540c {{groupby}}s \u4e0a\u7684\u6570\u636e\u5206\u5e03\u5982\u56fe\u6240\u793a."},{id:1,template:"\u5f53{{subspace}}\u65f6\uff0c\u5c06 {{agg}} {{measure}} \u6839\u636e\u4e0d\u540c\u7684 {{groupby}}s \u8fdb\u884c\u5212\u5206\uff0c\u7ed3\u679c\u5982\u56fe\u6240\u793a."},{id:2,template:"\u5f53{{subspace}}\u65f6\uff0c\u4e0d\u540c {{groupby}}s \u7684 {{agg}} {{measure}} \u5982\u56fe\u6240\u793a."}],v=[{id:0,template:"\u5f53{{subspace}}\u65f6\uff0c {{parameter[0]}} \u7684 {{agg}} {{measure}} \u7b49\u4e8e {{parameter[1]}}\uff0c\u5728\u6240\u6709\u7684 {{groupby}}s \u4e2d\u662f {{focus}}."},{id:1,template:"\u5f53{{subspace}}\u65f6\uff0c {{agg}} {{measure}} \u7684 {{focus}} \u7b49\u4e8e {{parameter[1]}}\uff0c\u5176 {{groupby}} \u7b49\u4e8e {{parameter[0]}}."},{id:2,template:"\u5f53{{subspace}}\u65f6\uff0c {{parameter[0]}} \u7684 {{agg}} {{measure}} \u53d6 {{focus}}\uff0c\u7b49\u4e8e {{parameter[1]}}"}],b=[{id:0,template:"\u5f53{{subspace}}\u65f6\uff0c\u4e0e\u5176\u4ed6 {{groupby}}s \u76f8\u6bd4\uff0c {{focus}} \u7684 {{agg}} {{measure}} \u662f\u4e00\u4e2a\u5f02\u5e38\u503c."},{id:1,template:"\u5f53{{subspace}}\u65f6\uff0c {{focus}} \u7684 {{agg}} {{measure}} \u548c\u5176\u4ed6 {{groupby}}s \u76f8\u6bd4\u6709\u663e\u8457\u5dee\u5f02."},{id:2,template:"\u5f53{{subspace}}\u65f6\uff0c\u76f8\u6bd4\u5176\u4ed6 {{groupby}}s\uff0c {{focus}} \u7684 {{agg}} {{measure}} \u5b58\u5728\u660e\u663e\u5dee\u5f02"}],T=[{id:0,template:"\u5f53{{subspace}}\u65f6\uff0c {{focus}} \u7684 {{agg}} {{measure}} \u5360\u5168\u90e8 {{agg}} {{measure}} \u7684 {{parameter}}."},{id:1,template:"\u5f53{{subspace}}\u65f6\uff0c {{focus}} \u5360 {{agg}} {{measure}} \u7684 {{parameter}}."},{id:2,template:"\u5f53{{subspace}}\u65f6\uff0c {{focus}} \u5728 {{agg}} {{measure}} \u4e2d\u7684\u5360\u6bd4\u4e3a {{parameter}}."}],A=[{id:0,template:"\u5f53{{subspace}}\u65f6\uff0c\u6839\u636e {{agg}} {{measure}} \u5bf9 {{groupby}}s \u8fdb\u884c\u6392\u540d\uff0c\u6392\u540d\u524d\u4e09\u7684\u662f {{no.1}}\u3001{{no.2}}\u3001{{no.3}}."},{id:1,template:"\u5f53{{subspace}}\u65f6\uff0c {{no.1}}\u3001 {{no.2}}\u548c{{no.3}}\u662f {{agg}} {{measure}}\u53d6\u503c\u6700\u9ad8\u7684\u4e09\u4e2a {{groupby}}s."},{id:2,template:"\u5f53{{subspace}}\u65f6\uff0c {{no.1}}\u3001 {{no.2}}\u548c{{no.3}}\u5728 {{agg}} {{measure}}\u7684\u53d6\u503c\u4e0a\u6392\u540d\u524d\u4e09"}],_=[{id:0,template:"\u5f53{{subspace}}\u65f6\uff0c\u603b\u4f53\u6765\u770b\uff0c {{agg}} {{measure}} \u5728\u968f\u65f6\u95f4 {{parameter}}."},{id:1,template:"\u5f53{{subspace}}\u65f6\uff0c {{agg}} {{measure}} \u603b\u4f53\u5448 {{parameter}} \u8d8b\u52bf."},{id:2,template:"\u5f53{{subspace}}\u65f6\uff0c\u603b\u4f53\u6765\u770b\uff0c {{agg}} {{measure}} \u5728\u968f {{groupby}} {{parameter}}."}],O=[{id:0,template:"\u5f53{{subspace}}\u65f6\uff0c {{agg}} {{measure}} \u7684\u503c\u7b49\u4e8e {{parameter}}."},{id:1,template:"\u5f53{{subspace}}\u65f6\uff0c {{measure}} \u7684 {{agg}}\u503c\u662f {{parameter}}."},{id:2,template:"\u5f53{{subspace}}\u65f6\uff0c {{agg}} {{measure}} \u7684\u503c\u662f {{parameter}}."}],C=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,a=[];switch(e){case r.a.ASSOCIATION:a=g;break;case r.a.CATEGORIZATION:a=y;break;case r.a.DIFFERENCE:a=m;break;case r.a.DISTRIBUTION:a=E;break;case r.a.EXTREME:a=v;break;case r.a.OUTLIER:a=b;break;case r.a.PROPORTION:a=T;break;case r.a.RANK:a=A;break;case r.a.TREND:a=_;break;case r.a.VALUE:a=O}-1===t&&(t=Math.floor(10*Math.random())%3);var i="";try{i=a[t].template}catch(n){console.error(n),console.log("wrong id:"+t)}return i},I=a(27),R=a(16),D=a(12),x=a.n(D),k=a(91),L=function(e){switch(e){case R.a.SUM:return"total";case R.a.MAX:return"maximum";case R.a.MIN:return"minimum";case R.a.AVG:return"average";case R.a.COUNT:return"count";case R.a.NONE:default:return""}},w=function(e){switch(e){case R.a.SUM:return"\u603b";case R.a.MAX:return"\u6700\u5927";case R.a.MIN:return"\u6700\u5c0f";case R.a.AVG:return"\u5e73\u5747";case R.a.COUNT:return"\u6570\u91cf";case R.a.NONE:default:return""}},P=function(e){return"count"===e.aggregate?"":e.field.toLowerCase()},N=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"single",a=e[0];if("single"===t)return a.toLowerCase();if("plural"===t){if(-1===a.indexOf(" of "))return k(a,2).toLowerCase();var r=a.split(" "),i=r.indexOf("of")-1;if(i>-1){var n=k(r[i],2);return a.replace(r[i],n)}}},S=function(e){var t=0,a="",r="";(e=(e||0).toString()).indexOf(".")>0?(t=e.indexOf("."),a=e.substr(t),r=e.substring(0,t)):r=e;for(var i=[],n=0,o=(r=r.split("")).length-1;o>=0;o--)n++,i.unshift(r[o]),n%3||0===o||i.unshift(",");return i.join("")+a||""},F=function(e,t){var a="";return e.subspace.length?(e.subspace.map((function(e,t){return a+="".concat(0===t?" ":" and ","the ").concat(e.field," is ").concat(e.value)})),t=t.replace("{{subspace}}",a)):t=(t=(t=(t=(t=(t=(t=(t=t.replace(", when {{subspace}}","")).replace(" when {{subspace}}","")).replace(" in case of {{subspace}}","")).replace(" given {{subspace}}","")).replace("When {{subspace}}, ","")).replace("Given {{subspace}}, ","")).replace("In case of {{subspace}}, ","")).replace(/^\S/,(function(e){return e.toUpperCase()})),t},V=function(e,t){var a="";return e.subspace.length?(e.subspace.map((function(e,t){return a+=" ".concat(0===t?" ":" \u548c "," ").concat(e.field," \u662f ").concat(e.value," ")})),t=t.replace("{{subspace}}",a)):t=(t=(t=(t=(t=t.replace("\u5728{{subspace}}\u4e2d\uff0c","")).replace(" \u5728{{subspace}}\u4e2d","")).replace("\uff0c\u5f53{{subspace}}\u65f6","")).replace("\u5f53{{subspace}}\u65f6\uff0c","")).replace("\u5f53{{subspace}}\u65f6",""),t},j=function(e,t){if("en-US"===t){if(!Object(I.b)(e))return"";var a=x.a.cloneDeep(e),i=h(a.type),n=R.a.NONE;switch(a.measure.length>0&&(n=a.measure[0].aggregate),a.type){case r.a.ASSOCIATION:i=(i=(i=(i=i.replace("{{measure1}}",P(a.measure[0]))).replace("{{measure2}}",P(a.measure[1]))).replace("{{agg1}}",L(a.measure[0].aggregate))).replace("{{agg2}}",L(a.measure[1].aggregate)),i=F(a,i),""!==a.parameter&&(i=(i=Number.parseFloat(a.parameter)>0?i.replace("{{positive/negative}}","positive"):i.replace("{{positive/negative}}","negative")).replace("{{parameter}}",S(Number.parseFloat(a.parameter).toFixed(3))));break;case r.a.CATEGORIZATION:if(i=i.replace("{{groupby}}s",N(a.groupby,"plural")),i=F(a,i),a.parameter.length){i=i.replace("{{parameter}}",S(a.parameter.length));var o="";a.parameter.forEach((function(e,t){o+="".concat(0===t?"":","," ").concat(e)})),i=i.replace("{{no.1}}, {{no.2}}, {{no.3}}",o)}if(a.focus.length)if(i.indexOf(". {{focus}}")>-1){var s=a.focus[0].value.slice(0,1).toUpperCase()+a.focus[0].value.slice(1);i=i.replace("{{focus}}",s)}else i=i.replace("{{focus}}",a.focus[0].value);else i=(i=(i=i.replace(", and {{focus}} needs to pay attention","")).replace(", among which {{focus}} needs to pay attention","")).replace(". {{focus}} needs to pay attention","");break;case r.a.DIFFERENCE:i=(i=i.replace("{{measure}}",P(a.measure[0]))).replace("{{agg}}",L(n)),a.focus.length>=2&&(i=(i=i.replace("{{focus1}}",a.focus[0].value)).replace("{{focus2}}",a.focus[1].value)),i=F(a,i),""!==a.parameter&&(i=(i=a.parameter>0?i.replace("{{higher/lower}}","higher"):i.replace("{{higher/lower}}","lower")).replace("{{parameter}}",S(a.parameter)));break;case r.a.DISTRIBUTION:i=(i=(i=(i=i.replace("{{measure}}",P(a.measure[0]))).replace("{{agg}}",L(n))).replace("{{groupby}}s",N(a.groupby,"plural"))).replace("{{groupby}}",N(a.groupby)),i=F(a,i),i=a.focus.length?i.replace("{{focus}}",a.focus[0].value):i.replace(" and {{focus}} needs to pay attention","");break;case r.a.EXTREME:i=(i=(i=(i=i.replace("{{measure}}",P(a.measure[0]))).replace("{{agg}}",L(n))).replace("{{groupby}}s",N(a.groupby,"plural"))).replace("{{groupby}}",N(a.groupby)),i=F(a,i),a.focus.length&&(void 0!==a.focus[0].extremeFocus&&void 0!==a.focus[0].extremeValue?i=(i=(i="min"===a.focus[0].extremeFocus?i.replace("{{focus}}","minimum"):i.replace("{{focus}}","maximum")).replace("{{parameter[0]}}",a.focus[0].value)).replace("{{parameter[1]}}",S(Math.round(100*a.parameter[1])/100)):a.parameter.length&&(i=(i=(i="min"===a.parameter[0]?i.replace("{{focus}}","minimum"):i.replace("{{focus}}","maximum")).replace("{{parameter[0]}}",a.focus[0].value)).replace("{{parameter[1]}}",S(a.parameter[1]))));break;case r.a.OUTLIER:i=(i=(i=(i=i.replace("{{measure}}",P(a.measure[0]))).replace("{{measure}}",P(a.measure[0]))).replace("{{groupby}}s",N(a.groupby,"plural"))).replace("{{agg}}",L(n)),i=F(a,i),a.focus.length&&(i=i.replace("{{focus}}",a.focus[0].value));break;case r.a.PROPORTION:i=(i=(i=(i=i.replace("{{measure}}",P(a.measure[0]))).replace("{{agg}}",L(n))).replace("{{measure}}",P(a.measure[0]))).replace("{{agg}}",L(n)),i=F(a,i),a.focus.length&&(i=i.replace("{{focus}}",a.focus[0].value)),a.parameter&&(i=i.replace("{{parameter}}",a.parameter));break;case r.a.RANK:i=(i=(i=(i=i.replace("{{measure}}",P(a.measure[0]))).replace("{{agg}}",L(n))).replace("{{groupby}}s",N(a.groupby,"plural"))).replace("{{groupby}}s",N(a.groupby,"plural")),i=F(a,i),a.parameter.length>=3?(i=(i=(i=i.replace("{{parameter}}",S(a.parameter.length))).replace("{{no.1}}"," ".concat(a.parameter[0]))).replace("{{no.2}}",a.parameter[1]),3===a.parameter.length||a.parameter.length>3?i=i.replace("{{no.3}}",a.parameter[2]):2===a.parameter.length&&(i=i.replace(", {{no.3}}",""))):i="";break;case r.a.TREND:i=(i=(i=i.replace("{{measure}}",P(a.measure[0]))).replace("{{agg}}",L(n))).replace("{{groupby}}s",N(a.groupby,"plural")),i=F(a,i),a.parameter&&(i=i.replace("{{parameter}}"," ".concat(a.parameter," ")),i="increasing"===a.parameter?i.replace("a/an","an"):i.replace("a/an","a")),i=a.focus.length?i.replace("{{focus}}",a.focus[0].value):i.replace(" and the value of {{focus}} needs to pay attention","");break;case r.a.VALUE:i=(i=i.replace("{{measure}}",P(a.measure[0]))).replace("{{agg}}",L(n)),i=F(a,i),a.focus.length&&(i=i.replace("{{focus}}",a.focus[0].value)),""!==a.parameter&&(i=i.replace("{{parameter}}",S(a.parameter)))}return i=i.slice(0,1).toUpperCase()+i.slice(1)}if(!Object(I.b)(e))return"";var c=x.a.cloneDeep(e),l=C(c.type),u=R.a.NONE;switch(c.measure.length>0&&(u=c.measure[0].aggregate),c.type){case r.a.ASSOCIATION:l=(l=(l=(l=l.replace("{{measure1}}",P(c.measure[0]))).replace("{{measure2}}",P(c.measure[1]))).replace("{{agg1}}",w(c.measure[0].aggregate))).replace("{{agg2}}",w(c.measure[1].aggregate)),l=V(c,l),""!==c.parameter&&(l=(l=Number.parseFloat(c.parameter)>0?l.replace("{{\u6b63/\u8d1f}}","\u6b63"):l.replace("{{\u6b63/\u8d1f}}","\u8d1f")).replace("{{parameter}}",S(Number.parseFloat(c.parameter).toFixed(3))));break;case r.a.CATEGORIZATION:if(l=(l=l.replace("{{groupby}}s",N(c.groupby,"plural"))).replace("{{groupby}}",N(c.groupby)),l=V(c,l),Array.isArray(c.parameter)){if(c.parameter.length){l=l.replace("{{parameter}}"," ".concat(S(c.parameter.length)," "));var d="";c.parameter.forEach((function(e,t){d+="".concat(0===t?"":","," ").concat(e)})),l=l.replace("{{no.1}}\u3001{{no.2}}\u3001{{no.3}}"," ".concat(d))}}else l="";if(c.focus.length)if(l.indexOf(". {{focus}}")>-1){var f=c.focus[0].value.slice(0,1).toUpperCase()+c.focus[0].value.slice(1);l=l.replace("{{focus}}",f)}else l=l.replace("{{focus}}",c.focus[0].value);else l=l.replace("\uff0c\u5176\u4e2d{{focus}}\u9700\u8981\u5f15\u8d77\u6ce8\u610f","");break;case r.a.DIFFERENCE:l=(l=(l=l.replace("{{measure}}",P(c.measure[0]))).replace("{{agg}}",w(u))).replace("{{groupby}}s",N(c.groupby,"plural")),c.focus.length>=2&&(l=(l=l.replace("{{focus1}}",c.focus[0].value)).replace("{{focus2}}",c.focus[1].value)),l=V(c,l),""!==c.parameter&&(l=(l=c.parameter>0?l.replace("{{\u9ad8/\u4f4e}}","\u9ad8"):l.replace("{{\u9ad8/\u4f4e}}","\u4f4e")).replace("{{parameter}}",S(c.parameter)));break;case r.a.DISTRIBUTION:l=(l=(l=(l=l.replace("{{measure}}",P(c.measure[0]))).replace("{{measure}}",P(c.measure[0]))).replace("{{agg}}",w(u))).replace("{{groupby}}s",N(c.groupby,"plural")),l=V(c,l),l=c.focus.length?l.replace("{{focus}}",c.focus[0].value):l.replace("\uff0c\u5176\u4e2d{{focus}}\u9700\u8981\u5f15\u8d77\u6ce8\u610f","");break;case r.a.EXTREME:l=(l=(l=(l=l.replace("{{measure}}",P(c.measure[0]))).replace("{{agg}}",w(u))).replace("{{groupby}}s",N(c.groupby,"plural"))).replace("{{groupby}}",N(c.groupby)),l=V(c,l),c.focus.length&&(void 0!==c.focus[0].extremeFocus&&void 0!==c.focus[0].extremeValue?l=(l=(l="min"===c.focus[0].extremeFocus?l.replace("{{focus}}","\u6700\u5c0f"):l.replace("{{focus}}","\u6700\u5927")).replace("{{parameter[0]}}",c.focus[0].value)).replace("{{parameter[1]}}",S(Math.round(100*c.parameter[1])/100)):c.parameter.length&&(l=(l=(l="min"===c.parameter[0]?l.replace("{{focus}}","\u6700\u5c0f"):l.replace("{{focus}}","\u6700\u5927")).replace("{{parameter[0]}}",c.focus[0].value)).replace("{{parameter[1]}}",S(c.parameter[1]))));break;case r.a.OUTLIER:l=(l=(l=(l=(l=l.replace("{{measure}}",P(c.measure[0]))).replace("{{measure}}",P(c.measure[0]))).replace("{{groupby}}s",N(c.groupby,"plural"))).replace("{{groupby}}s",N(c.groupby,"plural"))).replace("{{agg}}",w(u)),l=V(c,l),c.focus.length&&(l=l.replace("{{focus}}",c.focus[0].value));break;case r.a.PROPORTION:l=(l=(l=(l=l.replace("{{measure}}",P(c.measure[0]))).replace("{{agg}}",w(u))).replace("{{measure}}",P(c.measure[0]))).replace("{{agg}}",w(u)),l=V(c,l),c.focus.length&&(l=l.replace("{{focus}}",c.focus[0].value)),c.parameter&&(l=l.replace("{{parameter}}",c.parameter));break;case r.a.RANK:l=(l=(l=l.replace("{{measure}}",P(c.measure[0]))).replace("{{agg}}",w(u))).replace("{{groupby}}s",N(c.groupby,"plural")),l=V(c,l),c.parameter.length>=3?(l=(l=l.replace("{{no.1}}",c.parameter[0])).replace("{{no.2}}",c.parameter[1]),3===c.parameter.length||c.parameter.length>3?l=l.replace("{{no.3}}",c.parameter[2]):2===c.parameter.length&&(l=l.replace("\u3001{{no.3}}",""))):l="";break;case r.a.TREND:l=(l=(l=l.replace("{{measure}}",P(c.measure[0]))).replace("{{agg}}",w(u))).replace("{{groupby}}",N(c.groupby)),l=V(c,l),c.parameter&&(l="increasing"===c.parameter?l.replace("{{parameter}}","\u589e\u957f"):l.replace("{{parameter}}","\u4e0b\u964d")),l=c.focus.length?l.replace("{{focus}}",c.focus[0].value):l.replace("\uff0c\u5176\u4e2d{{focus}}\u9700\u8981\u5f15\u8d77\u6ce8\u610f","");break;case r.a.VALUE:l=(l=l.replace("{{measure}}",P(c.measure[0]))).replace("{{agg}}",w(u)),l=V(c,l),""!==c.parameter&&(l=l.replace("{{parameter}}",S(c.parameter)))}return l=l.slice(0,1).toUpperCase()+l.slice(1)},M=function(e,t){if("en-US"===t){var a;if(!Object(I.b)(e))return"";switch(a="The "+e.type,e.type){case r.a.ASSOCIATION:a+=" of "+e.measure[0].field+" and "+e.measure[1].field;break;case r.a.CATEGORIZATION:a=e.groupby[0];break;case r.a.DIFFERENCE:a+=" between "+e.focus[0].value+" and "+e.focus[1].value;break;case r.a.DISTRIBUTION:case r.a.EXTREME:case r.a.OUTLIER:a+=" of "+e.measure[0].field;break;case r.a.PROPORTION:a+=" of "+e.focus[0].value;break;case r.a.RANK:case r.a.TREND:a+=" of "+e.measure[0].field;break;case r.a.VALUE:a="The "+L(e.measure[0].aggregate)+" "+e.measure[0].field}if(e.subspace.length){var i="";e.subspace.map((function(e,t){return i+=" in ".concat(e.value)})),a+=i}return a}var n="";if(!Object(I.b)(e))return"";if(e.subspace.length){var o="";e.subspace.map((function(e,t){return o+=" ".concat(e.value)})),n+="\u5728 "+o+"\u4e2d\uff0c"}switch(e.type){case r.a.ASSOCIATION:n+=e.measure[0].field+" \u548c "+e.measure[1].field+"\u7684\u76f8\u5173\u6027";break;case r.a.CATEGORIZATION:n+=e.groupby[0]+"\u7684\u5206\u7c7b\u60c5\u51b5";break;case r.a.DIFFERENCE:n+=e.focus[0].value+" \u548c "+e.focus[1].value+"\u7684\u5dee\u5f02";break;case r.a.DISTRIBUTION:n+=e.measure[0].field+"\u7684\u5206\u5e03";break;case r.a.EXTREME:n+=e.measure[0].field+"\u7684\u6781\u503c";break;case r.a.OUTLIER:n+=e.measure[0].field+"\u7684\u5f02\u5e38\u503c";break;case r.a.PROPORTION:n+=e.focus[0].value+"\u7684\u5360\u6bd4";break;case r.a.RANK:n+=e.measure[0].field+"\u7684\u6392\u540d";break;case r.a.TREND:n+=e.measure[0].field+"\u7684\u8d8b\u52bf";break;case r.a.VALUE:switch(L(e.measure[0].aggregate)){case R.a.SUM:n+=e.measure[0].field+"\u7684\u603b\u503c";break;case R.a.MAX:n+=e.measure[0].field+"\u7684\u6700\u5927\u503c";break;case R.a.MIN:n+=e.measure[0].field+"\u7684\u6700\u5c0f\u503c";break;case R.a.AVG:n+=e.measure[0].field+"\u7684\u5e73\u5747\u503c";break;case R.a.COUNT:n+=e.measure[0].field+"\u7684\u6570\u91cf";break;case R.a.NONE:default:n+=e.measure[0].field+"\u7684\u503c"}}return n},G=function(e){var t;switch(e){case"CarSales.csv":t="Car Sales";break;case"nCoV2020.csv":t="COVID-19";break;case"deadstartup.csv":t="Startup Failures";break;default:if(e.indexOf(".")>0){var a=e.indexOf(".");t=e.substring(0,a)}else t=e}return t}},6:function(e,t,a){"use strict";t.a={NUMERICAL:"numerical",CATEGORICAL:"categorical",TEMPORAL:"temporal",GEOGRAPHICAL:"geographical"}},7:function(e,t,a){"use strict";t.a={UPLOAD_DATA:"UPLOAD_DATA",CONNECT_DATA:"CONNECT_DATA",CHANGE_DATA:"CHANGE_DATA",VISUALIZE_DATA:"VISUALIZE_DATA",UPDATE_DATA_URL:"UPDATE_DATA_URL",ADD_FACT:"ADD_FACT",INSERT_FACT:"INSERT_FACT",INSERT_FACT_BY_FACT:"INSERT_FACT_BY_FACT",UPDATE_FACT:"UPDATE_FACT",CHANGE_FACT:"CHANGE_FACT",DELETE_FACT:"DELETE_FACT",DELETE_UNUSEDFACT:"DELETE_UNUSEDFACT",ORDER_FACTS:"ORDER_FACTS",SET_HOVER_INDEX:"SET_HOVER_INDEX",UPDATE_FILTERS:"UPDATE_FILTERS",UPDATE_FILTERS_TITLE:"UPDATE_FILTERS_TITLE",UPDATE_DATARES:"UPDATE_DATARES",UPDATE_SCHEMA_FILTER:"UPDATE_SCHEMA_FILTER",UPDATE_FILTERS_CHANGE_FLAG:"UPDATE_FILTERS_CHANGE_FLAG",CHANGE_CURRENT_EDITING:"CHANGE_CURRENT_EDITING",UPDATE_FILTERS_LOCAL:"UPDATE_FILTERS_LOCAL",UPDATE_PANNEL_WIDTH:"UPDATE_PANNEL_WIDTH",INIT_FACT:"INIT_FACT",INIT_RELATION:"INIT_RELATION",SELECT_FACT:"SELECT_FACT",CHANGE_METHOD:"CHANGE_METHOD",SET_STORY_PARAMETER:"SET_STORY_PARAMETER",SET_AGGREGATION_LEVEL:"SET_AGGREGATION_LEVEL",SET_REWARD_WEIGHT:"SET_REWARD_WEIGHT",GENERATE_STORY:"GENERATE_STORY",CHANGE_TITLE:"CHANGE_TITLE",CHANGE_SUBTITLE:"CHANGE_SUBTITLE",UPDATE_STORY_CARD_NUMBER:"UPDATE_STORY_CARD_NUMBER",UPDATE_COMMENT_STORY_INFO:"UPDATE_COMMENT_STORY_INFO",UPDATE_UUID:"UPDATE_UUID",UPDATE_PROGRESS:"UPDATE_PROGRESS",EXPORT_PDF:"EXPORT_PDF",CHANGE_TO_ANIMATION:"CHANGE_TO_ANIMATION",UPDATE_USER_INFO:"UPDATE_USER_INFO",UPDATE_USER_OPERATION:"UPDATE_USER_OPERATION",UPDATE_CONVERT_TYPE:"UPDATE_CONVERT_TYPE",UPDATE_LOCALE:"UPDATE_LOCALE",CLOSE_PANNEL:"CLOSE_PANNEL",INIT_VIDOE_CARD:"INIT_VIDOE_CARD",ADD_EMPTY_CARD:"ADD_EMPTY_CARD",REMOVE_CARD:"REMOVE_CARD",CHANGE_CARD:"CHANGE_CARD",EXCHANGE_CARD:"EXCHANGE_CARD",CHANGE_CARD_FLAG:"CHANGE_CARD_FLAG",ADD_CARD:"ADD_CARD",ADD_CARDS:"ADD_CARDS",REPLAY_VIDEO_SLICE:"REPLAY_VIDEO_SLICE",PLAY_VIDEO_SLICE:"PLAY_VIDEO_SLICE",PLAY_VIDEO_CONTINUE:"PLAY_VIDEO_CONTINUE",STOP_PLAY_VIDEO_CONTINUE:"STOP_PLAY_VIDEO_CONTINUE",ADD_NOW_VIDEO_TIME:"ADD_NOW_VIDEO_TIME",CHANGE_NOW_VIDEO_TIME:"CHANGE_NOW_VIDEO_TIME",CHANGE_ALL_VIDEO_TIME:"CHANGE_ALL_VIDEO_TIME",SET_DATA_FILTER:"SET_DATA_FILTER",SET_DATA_FACT:"SET_DATA_FACT",SET_EDIT_SLICE:"SET_EDIT_SLICE",SET_DEFAULT:"SET_DEFAULT",SET_LEFTSIDER_CONTENT:"SET_LEFTSIDER_CONTENT",INIT_TIME_LINE_BAR_WDITH:"INIT_TIME_LINE_BAR_WDITH",ADD_BAR_TO_TIME_LINE_BAR:"ADD_BAR_TO_TIME_LINE_BAR",ADD_BARS_TO_TIME_LINE_BAR:"ADD_BARS_TO_TIME_LINE_BAR",DELETE_BAR_FROM_TIME_LINE_BAR:"DELETE_BAR_FROM_TIME_LINE_BAR",CHANGE_TIME_LINE_BAR:"CHANGE_TIME_LINE_BAR",SET_LEFT_BAR_WIDTH:"SET_LEFT_BAR_WIDTH",SET_RIGHT_BAR_WIDTH:"SET_RIGHT_BAR_WIDTH",SET_DRAG_DIRECTION:"SET_DRAG_DIRECTION",SET_MOUSE_DOWN_STATE:"SET_MOUSE_DOWN_STATE",SET_DRAG_STATE:"SET_DRAG_STATE",SET_CURRENT_X:"SET_CURRENT_X",SET_LEFT_OFFSET_WIDTH:"SET_LEFT_OFFSET_WIDTH",SET_RIGHT_OFFSET_WIDTH:"SET_RIGHT_OFFSET_WIDTH",SET_CURRENT_BAR_INDEX:"SET_CURRENT_BAR_INDEX",SET_DRAG_CURSOR:"SET_DRAG_CURSOR",SET_POSITION:"SET_POSITION",SET_SCENE_SCALE:"SET_SCENE_SCALE",QUESTION_2_GIF:"QUESTION_2_GIF",ISGENERATINGGIF:"ISGENERATINGGIF",CHANGE_TEMP_SPEC:"CHANGE_TEMP_SPEC",OPERATOR_CHANGE:"OPERATOR_CHANGE",ANIMATION_CHANGE:"ANIMATION_CHANGE",CHANGE_KEYS:"CHANGE_KEYS",CHANGE_OPERATOR:"CHANGE_OPERATOR"}},83:function(e,t,a){"use strict";t.a={BEFORE_UPLOAD:0,UPLOADIND:1,UPLOADED:2,GENERATING:3,GENERATED:4,FAILED:5,FILE_LARGE:6,ADDING:7,ADD_FAILED:8,ADDED:9,PUBLISHED:10}},86:function(e,t,a){"use strict";t.a={FACTSHEET:"Factsheet",DASHBOARD:"Dashboard",DATACOMICS:"DataComics",DATAVIDEOS:"DataVideos",H5:"H5"}},88:function(e,t,a){"use strict";a.d(t,"e",(function(){return i})),a.d(t,"d",(function(){return n})),a.d(t,"b",(function(){return o})),a.d(t,"c",(function(){return s})),a.d(t,"a",(function(){return c}));var r=a(7),i=function(e){return{type:r.a.UPDATE_USER_INFO,userInfo:e}},n=function(e){return{type:r.a.UPDATE_USER_OPERATION,operateState:e}},o=function(e){return{type:r.a.UPDATE_CONVERT_TYPE,convertType:e}},s=function(e){return{type:r.a.UPDATE_LOCALE,currentLocale:e}},c=function(e){return{type:r.a.CLOSE_PANNEL,isClose:e}}},89:function(e,t,a){"use strict";a.d(t,"b",(function(){return f})),a.d(t,"c",(function(){return h})),a.d(t,"a",(function(){return y}));var r=a(20),i=a(2),n=a.n(i),o=a(3),s=a(32),c=a(44),l=a(27),u=a(12),d=a.n(u),f=function(e,t){for(var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=0;r<e.length;r++){var i=Object(s.a)(t,e[r]),n=parseInt((i.length+1)*a),o=i.slice(0,n+1);e[r].chart=o[Math.floor(Math.random()*o.length)].chart}return e},p=function(e){return Math.round(Math.random()*(e-1))},h=function(e,t){var a=Object(s.a)(t,e);return 0===a.length?null:a[p(a.length)].chart},g=function(e){var t=e;switch(e){case o.a.AREA_CHART:t="areachart";break;case o.a.BUBBLE_CHART:t="bubblechart";break;case o.a.COLOR_FILLING_MAP:t="filledmap";break;case o.a.BUBBLE_MAP:t="bubblemap";break;case o.a.HALF_RING_CHART:t="donutchart";break;case o.a.HORIZONTAL_BAR_CHART:t="horizentalbarchart";break;case o.a.VERTICAL_BAR_CHART:case o.a.STACKED_BAR_CHART:case o.a.VERTICAL_DIFFERENCE_BAR_CHART:case o.a.ISOTYPE_BAR_CHART:case o.a.VERTICAL_DIFFERENCE_ARROW_CHART:t="verticalbarchart";break;case o.a.LINE_CHART:case o.a.STACKED_LINE_CHART:t="linechart";break;case o.a.PROPORTION_ISOTYPE_CHART:case o.a.PIE_CHART:t="piechart";break;case o.a.PROGRESS_BAR_CHART:t="progresschart";break;case o.a.RING_CHART:t="donutchart";break;case o.a.SCATTER_PLOT:t="scatterplot";break;case o.a.TEXT_CHART:t="textchart";break;case o.a.TREE_MAP:t="treemap"}return t},y=function(e,t,a,i,s){a.chart&&""!==a.chart||(a.chart=h(e.schema,a));var u=a.chart;if(u===o.a.ISOTYPE_BAR_CHART&&(a.chart=o.a.VERTICAL_BAR_CHART),!(a=Object(l.a)(a)).chart||!Object(l.b)(a))return console.log("no valid",a),null;var f=Object(r.a)(Object(r.a)({},a),{},{breakdown:a.groupby.map((function(e){return{field:e}}))}),p={size:s,type:g(u),style:"business",duration:0,showSuggestion:!0},y={data:e=Object(r.a)(Object(r.a)({},e),{},{values:i}),fact:f,chart:p};return n.a.createElement(c.a,{spec:d.a.cloneDeep(y),uuid:t})}},90:function(e,t,a){"use strict";a.d(t,"a",(function(){return h})),a.d(t,"b",(function(){return g}));var r=a(20),i=a(2),n=a.n(i),o=a(3),s=a(32),c=a(44),l=a(27),u=a(12),d=a.n(u),f=function(e){return Math.round(Math.random()*(e-1))},p=function(e,t){var a=Object(s.a)(t,e);return 0===a.length?null:a[f(a.length)].chart},h=function(e,t,a,i,n,s){a.chart&&""!==a.chart||(a.chart=p(t.schema,a));var c=a.chart;c===o.a.ISOTYPE_BAR_CHART&&(a.chart=o.a.VERTICAL_BAR_CHART);var u,d={type:(a=Object(l.a)(a)).type,subspace:a.subspace,measure:a.measure.map((function(e){return{field:e.field,aggregate:e.aggregate}})),breakdown:a.groupby.map((function(e){return{field:e}})),focus:a.focus};u=s?{width:s.width,height:s.height,type:"unitvis",style:"business",duration:0}:{size:n,type:"unitvis",style:"business",duration:0};var f={data:t=Object(r.a)(Object(r.a)({},t),{},{values:i}),fact:d,chart:u};return f},g=function(e,t,a,i,s,u){a.chart&&""!==a.chart||(a.chart=p(e.schema,a));var f=a.chart;if(f===o.a.ISOTYPE_BAR_CHART&&(a.chart=o.a.VERTICAL_BAR_CHART),!(a=Object(l.a)(a)).chart||!Object(l.b)(a))return console.log("no valid",a),null;var h,g=Object(r.a)(Object(r.a)({},a),{},{type:a.type,breakdown:a.groupby.map((function(e){return{field:e}}))});h=u?{width:u.width,height:u.height,type:"unitvis",style:"business",duration:0,showSuggestion:!0}:{size:s,type:"unitvis",style:"business",duration:0,showSuggestion:!0};var y={data:e=Object(r.a)(Object(r.a)({},e),{},{values:i}),fact:g,chart:h};return n.a.createElement(c.a,{spec:d.a.cloneDeep(y),uuid:t})}},92:function(e,t,a){"use strict";a.d(t,"a",(function(){return Qe}));var r=a(4),i=a(5),n=a(0),o=function(){function e(){Object(r.a)(this,e),this._data=[],this._schema=[]}return Object(i.a)(e,[{key:"data",value:function(){return this._data}},{key:"schema",value:function(){return this._schema}},{key:"load",value:function(e){var t=this;return new Promise((function(a,r){var i=[],o=e.schema.filter((function(e){return"numerical"===e.type}));if(i=o.map((function(e){return e.field})),"values"in e){var s=e.values;s.forEach((function(e,t){for(var a in e)-1!==i.indexOf(a)&&(e[a]=parseFloat(e[a]))})),t._data=s,t._schema=e.schema,a(t)}else n.csv(e.url).then(function(t){t.forEach((function(e,t){for(var a in e)-1!==i.indexOf(a)&&(e[a]=parseFloat(e[a]))})),this._data=t,this._schema=e.schema,a(this)}.bind(t)).catch((function(e){r(e)}))}))}}]),e}(),s=a(10),c={Association:"association",Categorization:"categorization",Difference:"difference",Distribution:"distribution",Extreme:"extreme",Outlier:"outlier",Proportion:"proportion",Rank:"rank",Trend:"trend",Value:"value"},l="sum",u="max",d="min",f="avg",p="count",h="none",g=function(){function e(){Object(r.a)(this,e),this._data=[],this._schema=[],this._factdata=[],this._type="",this._measure=[],this._subspace=[],this._breakdown=[],this._parameter="",this._focus=[]}return Object(i.a)(e,[{key:"data",value:function(e){if(!e)return this._data;this._data=e,this._factdata=e}},{key:"schema",value:function(e){this._schema=e}},{key:"factdata",value:function(){return this._factdata}},{key:"fact",value:function(){return{type:this._type,measure:this._measure,subspace:this._subspace,breakdown:this._breakdown,focus:this._focus,parameter:this._parameter}}},{key:"process",value:function(e){var t=this;this._type=e.type?e.type:c.Distribution,this._measure=e.measure?e.measure:[],0===this._measure.length&&(this._measure=[{aggregate:"count"}]),this._subspace=e.subspace?e.subspace:[],this._breakdown=e.breakdown?e.breakdown:[],this._focus=e.focus?e.focus:[];var a,r={},i=Object(s.a)(this._schema);try{for(i.s();!(a=i.n()).done;){var n=a.value;r[n.field]={},r[n.field].subtype=n.subtype,r[n.field].pictype=n.pictype,r[n.field].type=n.type,r[n.field].values=n.values,r[n.field].isPostCode=n.isPostCode}}catch(u){i.e(u)}finally{i.f()}if(this._measure=this._measure.map((function(e){return"field"in e&&(e.type=r[e.field].type,r[e.field].subtype&&(e.subtype=r[e.field].subtype),r[e.field].pictype&&(e.pictype=r[e.field].pictype)),e})),this._subspace=this._subspace.map((function(e){return e.type=r[e.field].type,r[e.field].subtype&&(e.subtype=r[e.field].subtype),r[e.field].pictype&&(e.pictype=r[e.field].pictype),r[e.field].isPostCode&&(e.isPostCode=r[e.field].isPostCode),e})),this._breakdown=this._breakdown.map((function(e){return e.type=r[e.field].type,r[e.field].subtype&&(e.subtype=r[e.field].subtype),r[e.field].pictype&&(e.pictype=r[e.field].pictype),r[e.field].values&&(e.values=r[e.field].values),r[e.field].isPostCode&&(e.isPostCode=r[e.field].isPostCode),e})),this._focus=this._focus.map((function(e){return e.type=r[e.field].type,r[e.field].subtype&&(e.subtype=r[e.field].subtype),r[e.field].pictype&&(e.pictype=r[e.field].pictype),e})),this._subspace.length>0&&(this._factdata=this.filter(this.factdata(),this._subspace)),this._measure.length>0){var o=this._measure,l=this._breakdown;this._factdata=this.aggregate(this._factdata,o,l)}try{this._parameter=this.parameter()}catch(d){console.log("parameter is wrong")}return new Promise((function(e,a){e(t)}))}},{key:"parameter",value:function(){var e=this.factdata(),t=this.fact(),a=t.breakdown,r=t.focus,i=t.measure;switch(t.type){case c.Association:var o="measure0:"+("count"===i[0].aggregate?"COUNT":i[0].field),l="measure1:"+("count"===i[1].aggregate?"COUNT":i[1].field);return function(e,t,a){var r=0,i=0,n=0,o=0,s=0;e.forEach((function(e){i+=e[t]*e[t],r+=e[t],o+=e[a]*e[a],n+=e[a],s+=e[t]*e[a]}));var c=i-r*r/e.length,l=o-n*n/e.length,u=s-r*n/e.length;return 0===c||0===l?0:u/Math.sqrt(c*l)}(e,o,l);case c.Categorization:var u=e.map((function(e){return e[a[0].field]}));return Array.from(new Set(u));case c.Rank:return e.sort((function(e,t){return t.Recovered-e.Recovered})).map((function(e){return e[a[0].field]}));case c.Proportion:var d=e.find((function(e){return e[r[0].field]===r[0].value})),f=e.filter((function(e){return e[r[0].field]!==r[0].value})),p=i[0].field,h=[d[p],n.sum(f,(function(e){return e[p]}))],g=n.pie().sort(null)(h);return(100*(g[0].value/n.sum(g,(function(e){return e.value})))).toFixed(1)+"%";case c.Value:return e[0][i[0].field];case c.Trend:var y=function(e,t){for(var a={},r=0,i=0,n=0,o=0,s=e.length,c=0;c<s;++c)r+=e[c],i+=t[c],n+=e[c]*t[c],o+=e[c]*e[c];return a.m=(n-r*i/s)/(o-r*r/s),a.b=i/s-a.m*r/s,a}(Array.apply(null,{length:e.length}).map((function(e,t){return t})),e.map((function(e){return e[i[0].field]})));return y.m>0?"increasing":y.m<0?"decreasing":"flat";case c.Difference:var m,E=[],v=Object(s.a)(r);try{var b=function(){var t=m.value;e.filter((function(e){return e[t.field]===t.value}))[0]&&E.push(e.filter((function(e){return e[t.field]===t.value}))[0])};for(v.s();!(m=v.n()).done;)b()}catch(O){v.e(O)}finally{v.f()}return Math.abs(Number(E[0][i[0].field])-Number(E[1]?E[1][i[0].field]:0));case c.Extreme:var T=e.find((function(e){return e[r[0].field]===r[0].value})),A=n.max(e,(function(e){return e[i[0].field]})),_=n.min(e,(function(e){return e[i[0].field]}));return T.extremeFocus="",T[i[0].field]===_&&(T.extremeFocus="minimum"),T[i[0].field]===A&&(T.extremeFocus="maximum"),Object.values(T);default:return""}}},{key:"filter",value:function(e,t){var a=e;if(t[0].hasOwnProperty("operator"))return t.forEach((function(e){switch(e.operator){case"EQ":a=a.filter((function(t){return Math.abs(t[e.field]-parseFloat(e.value[0]))<.01}));break;case"IN":a=a.filter((function(t){return e.value.includes(t[e.field])}));break;case"RANGE":var t=parseFloat(e.value[0]),r=parseFloat(e.value[1]),i=t,n=r;t<r&&(i=r,n=t),a=a.filter((function(t){return t[e.field]>=n&&t[e.field]<=i}));break;case"NOT RANGE":var o=parseFloat(e.value[0]),s=parseFloat(e.value[1]),c=o,l=s;o<s&&(c=s,l=o),a=a.filter((function(t){return t[e.field]<l||t[e.field]>c}));break;case"GT":a=a.filter((function(t){return t[e.field]>parseFloat(e.value[0])}));break;case"LT":a=a.filter((function(t){return t[e.field]<parseFloat(e.value[0])}));break;default:console.log("operator error!not in [GT,IN,LT,NOT RANGE,RANGE,EQ]")}})),a;var r,i=Object(s.a)(t);try{var n=function(){var e=r.value;a=a.filter((function(t){return t[e.field]===e.value}))};for(i.s();!(r=i.n()).done;)n()}catch(o){i.e(o)}finally{i.f()}return a}},{key:"aggregate",value:function(e,t,a){var r=[];if(t.length<1)r=e;else if(1===t.length){var i=t[0];r=this.agg(e,i,a)}else if(2===t.length){var n=[],o=[];a.length>0?(n=this.agg(e,t[0],a),o=this.agg(e,t[1],a)):(n=JSON.parse(JSON.stringify(e)),o=JSON.parse(JSON.stringify(e)));for(var s=a.map((function(e){return e.field})),c=0;c<n.length;c++){var l=n[c];for(var u in l)s.includes(u)||(l["measure0:"+u]=l[u],delete l[u]);var d=o[c];for(var f in d)s.includes(f)||(d["measure1:"+f]=d[f],delete d[f]);r.push(Object.assign(l,d))}}else if(3===t.length){var p=[],h=[],g=[];a.length>0?(p=this.agg(e,t[0],a),h=this.agg(e,t[1],a),g=this.agg(e,t[2],a)):(p=JSON.parse(JSON.stringify(e)),h=JSON.parse(JSON.stringify(e)),g=JSON.parse(JSON.stringify(e)));for(var y=a.map((function(e){return e.field})),m=0;m<p.length;m++){var E=p[m];for(var v in E)y.includes(v)||(E["measure0:"+v]=E[v],delete E[v]);var b=h[m];for(var T in b)y.includes(T)||(b["measure1:"+T]=b[T],delete b[T]);var A=g[m];for(var _ in A)y.includes(_)||(A["measure2:"+_]=A[_],delete A[_]);r.push(Object.assign(E,b,A))}}return r}},{key:"agg",value:function(e,t,a){var r={},i=[];switch(i=i.concat(a.map((function(e){return e.field}))),"count"!==t.aggregate&&i.push(t.field),r=e.map((function(e){var t,a={},r=Object(s.a)(i);try{for(r.s();!(t=r.n()).done;){var n=t.value;a[n]=e[n]}}catch(o){r.e(o)}finally{r.f()}return a})),t.aggregate){case l:r=this.sum(r,t,a);break;case f:r=this.avg(r,t,a);break;case u:r=this.max(r,t,a);break;case d:r=this.min(r,t,a);break;case p:r=this.count(r,t,a);break;default:r=this.max(r,t,a)}return r}},{key:"sum",value:function(e,t,a){var r=[];if(a.length>1){var i,o=n.nest().key((function(e){return e[a[1].field]})).entries(e),c=Object(s.a)(o);try{var l=function(){var e=i.value,o=n.nest().key((function(e){return e[a[0].field]})).entries(e.values),s=new Array(o.length).fill(0),c=o.map((function(e,a){e.values.forEach((function(e){s[a]+=e[t.field]}));var r=Object.assign({},e.values[0]);return r[t.field]=s[a],r}));r=r.concat(c)};for(c.s();!(i=c.n()).done;)l()}catch(h){c.e(h)}finally{c.f()}}else if(1===a.length){var u=n.nest().key((function(e){return e[a[0].field]})).entries(e),d=new Array(u.length).fill(0);r=u.map((function(e,a){e.values.forEach((function(e){d[a]+=e[t.field]}));var r=Object.assign({},e.values[0]);return r[t.field]=d[a],r}))}else{var f={};f[t.field]=0;for(var p=0;p<e.length;p++)f[t.field]+=e[p][t.field];r.push(f)}return r}},{key:"avg",value:function(e,t,a){var r=[];if(a.length>1){var i,o=n.nest().key((function(e){return e[a[1].field]})).entries(e),c=Object(s.a)(o);try{var l=function(){var e=i.value,o=n.nest().key((function(e){return e[a[0].field]})).entries(e.values),s=new Array(o.length).fill(0),c=o.map((function(e,a){e.values.forEach((function(e){s[a]+=e[t.field]}));var r=Object.assign({},e.values[0]);return r[t.field]=s[a]/e.values.length,r}));r=r.concat(c)};for(c.s();!(i=c.n()).done;)l()}catch(h){c.e(h)}finally{c.f()}}else if(1===a.length){var u=n.nest().key((function(e){return e[a[0].field]})).entries(e),d=new Array(u.length).fill(0);r=u.map((function(e,a){e.values.forEach((function(e){d[a]+=e[t.field]}));var r=Object.assign({},e.values[0]);return r[t.field]=d[a]/e.values.length,r}))}else{var f={};f[t.field]=0;for(var p=0;p<e.length;p++)f[t.field]+=e[p][t.field];f[t.field]/=e.length,r.push(f)}return r}},{key:"max",value:function(e,t,a){var r=[];if(a.length>1){var i,o=n.nest().key((function(e){return e[a[1].field]})).entries(e),c=Object(s.a)(o);try{for(c.s();!(i=c.n()).done;){var l=i.value,u=n.nest().key((function(e){return e[a[0].field]})).entries(l.values).map((function(e,a){var r=n.scan(e.values,(function(e,a){if(e[t.field]&&a[t.field])return a[t.field]-e[t.field]}));return r>=0?e.values[r]:e.values[0]}));r=r.concat(u)}}catch(p){c.e(p)}finally{c.f()}}else if(1===a.length){r=n.nest().key((function(e){return e[a[0].field]})).entries(e).map((function(e,a){var r=n.scan(e.values,(function(e,a){if(e[t.field]&&a[t.field])return a[t.field]-e[t.field]}));return r>=0?e.values[r]:e.values[0]}))}else{var d={};d[t.field]=e[0][t.field];for(var f=0;f<e.length;f++)d[t.field]<e[f][t.field]&&(d[t.field]=e[f][t.field]);r.push(d)}return r}},{key:"min",value:function(e,t,a){var r=[];if(a.length>1){var i,o=n.nest().key((function(e){return e[a[1].field]})).entries(e),c=Object(s.a)(o);try{for(c.s();!(i=c.n()).done;){var l=i.value,u=n.nest().key((function(e){return e[a[0].field]})).entries(l.values).map((function(e){var a=n.scan(e.values,(function(e,a){if(e[t.field]&&a[t.field])return e[t.field]-a[t.field]}));return a>=0?e.values[a]:e.values[0]}));r=r.concat(u)}}catch(p){c.e(p)}finally{c.f()}}else if(1===a.length){r=n.nest().key((function(e){return e[a[0].field]})).entries(e).map((function(e){var a=n.scan(e.values,(function(e,a){if(e[t.field]&&a[t.field])return e[t.field]-a[t.field]}));return a>=0?e.values[a]:e.values[0]}))}else{var d={};d[t.field]=e[0][t.field];for(var f=0;f<e.length;f++)d[t.field]>e[f][t.field]&&(d[t.field]=e[f][t.field]);r.push(d)}return r}},{key:"count",value:function(e,t,a){var r=[];if(a.length>1){var i,o=n.nest().key((function(e){return e[a[1].field]})).entries(e),c=Object(s.a)(o);try{var l=function(){var e=i.value,t=n.nest().key((function(e){return e[a[0].field]})).entries(e.values),o=new Array(t.length).fill(0),s=t.map((function(e,t){e.values.forEach((function(){o[t]+=1}));var a=e.values[0];return a.COUNT=o[t],a}));r=r.concat(s)};for(c.s();!(i=c.n()).done;)l()}catch(p){c.e(p)}finally{c.f()}}else if(1===a.length){var u=n.nest().key((function(e){return e[a[0].field]})).entries(e),d=new Array(u.length).fill(0);r=u.map((function(e,t){e.values.forEach((function(){d[t]+=1}));var a=e.values[0];return a.COUNT=d[t],a}))}else{var f={COUNT:e.length};r.push(f)}return r}}]),e}(),y={BAR:"bar",LINE:"line",POINT:"point",UNIT:"unit"},m={LARGE:"large",WIDE:"wide",MIDDLE:"middle",SMALL:"small"},E=function(){function e(){Object(r.a)(this,e),this._container="",this._data=[],this._fact={},this._factdata=[],this._processedData=[],this._size=m.LARGE,this._width=0,this._height=0,this._mark=y.POINT,this._chart={},this._caption=""}return Object(i.a)(e,[{key:"container",value:function(e){this._container=e}},{key:"size",value:function(e){if(!e)return this._size;this._size=e}},{key:"width",value:function(e){if(!e)return this._width;this._width=e}},{key:"height",value:function(e){if(!e)return this._height;this._height=e}},{key:"data",value:function(e){if(!e)return this._data;this._data=e,this._processedData=e}},{key:"factdata",value:function(e){if(!e)return this._factdata;this._factdata=e}},{key:"processedData",value:function(e){if(!e)return this._processedData;this._processedData=e}},{key:"fact",value:function(e){if(!e)return this._fact;this._fact=e}},{key:"chart",value:function(e){if(!e)return this._chart;this._chart=e}},{key:"caption",value:function(e){if(!e)return this._caption;this._caption=e}},{key:"run",value:function(e){e.operate(this)}}]),e}(),v=a(20),b=function(){function e(){Object(r.a)(this,e),this._actions=[]}return Object(i.a)(e,[{key:"add",value:function(e){this._actions.push(e)}},{key:"actions",value:function(){return this._actions}},{key:"operate",value:function(e){this.actions().forEach((function(t){t.operate(e)}))}}]),e}(),T=a(14),A=a(9),_=a(8),O=function(){function e(t){Object(r.a)(this,e),this._target=null}return Object(i.a)(e,[{key:"target",value:function(e){if(!e)return this._target;this._target=e}},{key:"operate",value:function(e){}}]),e}(),C=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e))._select=[],i._groupby=[],i._filter=[],"select"in e&&(i._select=e.select),"groupby"in e&&(i._groupby=e.groupby),"filter"in e&&(i._filter=e.filter),i}return Object(i.a)(a,[{key:"operate",value:function(e){var t=this,a=e.data();try{0!==this._filter.length&&(a=a.filter((function(e){var a,r=Object(s.a)(t._filter);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(!(i.field in e)||e[i.field]!==i.value)return!1}}catch(n){r.e(n)}finally{r.f()}return!0})))}catch(n){console.error("Data Processing: Error In Filtering:\n"+Error)}var r=a;try{r=this.aggregate(a,this._select,this._groupby)}catch(n){console.error("Data Processing: Error In Group By:\n"+Error)}try{var i=this._select.map((function(e){return e.field}));r.forEach((function(e){for(var t in e)i.includes(t)||delete e[t]}))}catch(n){console.error("Data Processing: Error In Select:\n"+Error)}e.processedData(r)}},{key:"aggregate",value:function(e,t,a){var r=this;if(0===t.length&&0===a.length)return e;var i=a.map((function(e){return e.field})),n=t.filter((function(e){return"aggregate"in e&&"None"!==e.aggregate})).reduce((function(e,t){return e[t.field]=t.aggregate,e}),{}),o=e.reduce((function(e,t){var a=i.reduce((function(e,a){return e+a+":"+t[a]+";"}),"");if(a in e)Object.keys(n).forEach((function(r){e[a][r].push(t[r])}));else{var r=Object(v.a)({},t);Object.keys(n).forEach((function(e){r[e]=[r[e]]})),e.push(e[a]=r)}return e}),[]);return o.forEach((function(e){Object.keys(n).forEach((function(t){t in e&&(e[t]=r.aggFuncRouter(e[t],n[t]))}))})),Object(T.a)(o)}},{key:"aggFuncRouter",value:function(e,t){switch(t.toLowerCase()){case"min":return Object(n.min)(e);case"max":return Object(n.max)(e);case"sum":return Object(n.sum)(e);case"count":return e.length;case"avg":case"mean":default:return Object(n.sum)(e)/e.length}}}]),a}(O),I=a(29),R=function(){function e(){Object(r.a)(this,e),this._container=document.createElement("div"),this._svg=n.select(this._container).append("svg"),this._width=0,this._height=0,this._data=[],this._processedData=[]}return Object(i.a)(e,[{key:"container",value:function(e){if(!e)return n.select(this._container).selectAll("*").remove(),this._container;this._container=e}},{key:"svg",value:function(){return this._svg}},{key:"width",value:function(e){if(console.log(this),!e)return 0!==this._width&&""!==this._width?this._width:"#video-chart"===this._container?750:200;this._width=e}},{key:"height",value:function(e){if(!e)return 0!==this._height&&""!==this._height?this._height:"#video-chart"===this._container?545:130;this._height=e}},{key:"data",value:function(e){if(!e)return this._data;this._data=e}},{key:"factdata",value:function(e){if(!e)return this._factdata;this._factdata=e}},{key:"processedData",value:function(e){return e||this._processedData?e?void(this._processedData=e):this._processedData:this._data}},{key:"subspace",value:function(e){if(!e)return this._subspace;this._subspace=e}},{key:"measure",value:function(e){if(!e)return this._measure;this._measure=e}},{key:"breakdown",value:function(e){if(!e)return this._breakdown;this._breakdown=e}},{key:"focus",value:function(e){if(!e)return this._focus;this._focus=e}},{key:"visualize",value:function(){}},{key:"drawAxis",value:function(){}},{key:"encodeXY",value:function(){}},{key:"encodeColor",value:function(){}},{key:"encodeSize",value:function(){}},{key:"encodeShape",value:function(){}},{key:"addEncoding",value:function(e,t,a){}},{key:"modifyEncoding",value:function(e,t,a){}},{key:"removeEncoding",value:function(e,t,a){}}]),e}();function D(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light",t={BACKGROUND:"#FFFFFF",DIVIDER:"#D9D9D9",AXIS:"#000000",TITLE:"#000000",TEXT:"#000000",ANNOTATION:"#FFBE32",DEFAULT:"#73C8F3",TOOLTIP:"#F28787",CATEGORICAL:["#73C8F3","#FFE86D","#F6B0A7","#B2DBC1","#EAE2B7","#F3705C","#4ECBC4","#96A7CE"],SEQUENTIAL:["#7A0715","#A71017","#D32322","#F04535","#FA6B4D","#FDAD92","#FDCBBB","#FFE5D9"],DIVERGING:["#1892FA","#7CC0FB","#ADD7F9","#DEECF8","#F3DEDE","#F0ADAD","#EC7C7C","#E0191A"]},a={BACKGROUND:"#000000",DIVIDER:"#323232",AXIS:"#FFFFFF",TITLE:"#FFFFFF",TEXT:"#FFFFFF",ANNOTATION:"#FFBE32",DEFAULT:"#73C8F3",CATEGORICAL:["#73C8F3","#FFE86D","#F6B0A7","#B2DBC1","#EAE2B7","#F3705C","#4ECBC4","#96A7CE"],SEQUENTIAL:["#E0191A","#FC4B4B","#F46464","#FC8585","#FFA6A6","#FFC8C8","#FFDADA","#F3DEDE"],DIVERGING:["#1892FA","#7CC0FB","#ADD7F9","#DEECF8","#F3DEDE","#FFA6A6","#F46464","#E0191A"]};switch(e){case"light":return t;case"dark":return a;default:return t}}var x=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"visualize",value:function(){var e=10,t=10,a=50,r=50;return this.width(this.width()-r-t),this.height(this.height()-e-a),this._svg=n.select(this.container()).append("svg").attr("width",this.width()+r+t).attr("height",this.height()+e+a).append("g").attr("transform","translate("+r+","+e+")"),this.drawAxis(),this.encodeXY(),this.encodeColor(),this.svg()}},{key:"drawAxis",value:function(){var e=this.svg(),t=this.width(),a=this.height(),r=this.measure(),i=this.breakdown(),o=Math.ceil(Math.sqrt(a*t)/10),s=e.select(".axis");e.select(".axis_x").remove(),e.select(".axis_y").remove(),s.append("text").attr("x",t/2).attr("y",a+9.6-1).attr("font-size",16).attr("text-anchor","middle").attr("dominant-baseline","hanging").text(i[0].field||"Count"),s.append("path").attr("class","triangle").attr("transform","translate(".concat(t-o/25*2,", ").concat(a,")rotate(90)")).attr("d",n.symbol().type(n.symbolTriangle).size(o)).attr("fill",D.AXIS),s.append("line").attr("x1",-1).attr("x2",t).attr("y1",a).attr("y2",a).attr("stroke-width",2).attr("stroke",D.AXIS),s.append("text").attr("transform","translate(".concat(-9.6,", ").concat(a/2,") rotate(-90)")).attr("font-size",16).attr("text-anchor","middle").text(r[0].field||"Count"),s.append("path").attr("class","triangle").attr("transform","translate(0, ".concat(o/25*2,")")).attr("d",n.symbol().type(n.symbolTriangle).size(o)).attr("fill",D.AXIS),s.append("line").attr("y1",0).attr("y2",a).attr("stroke-width",2).attr("stroke",D.AXIS)}},{key:"encodeXY",value:function(){var e=this.svg(),t=this.width(),a=this.height(),r=this.factdata(),i=this.measure(),o=this.breakdown(),s=o[0].field,c="count"===i[0].aggregate?"COUNT":i[0].field,l={};r.forEach((function(e,t){l[e[s]]?l[e[s]].push(e):l[e[s]]=[e]}));var u=[];for(var d in l){var f;u.push((f={},Object(I.a)(f,s,d),Object(I.a)(f,c,n.sum(l[d],(function(e){return e[c]}))),f))}var p=n.scaleBand().range([0,t]).domain(r.map((function(e){return e[s]}))).padding(.5),h=n.scaleLinear().range([a,0]).domain([0,n.max(u,(function(e){return e[c]}))]).nice(),g=e.append("g").attr("class","axis"),y=e.append("g").attr("class","content").attr("chartWidth",t).attr("chartHeight",a),m=n.axisBottom(p),E=n.axisLeft(h).ticks(5).tickSize(-a,0,0).tickPadding(5).tickFormat((function(e){return e/1e6>=1?e=e/1e6+"M":e/1e3>=1&&(e=e/1e3+"K"),e}));g.append("g").attr("class","axis_x").attr("transform","translate(0, ".concat(a,")")).call(m),g.append("g").attr("class","axis_y").call(E),g.selectAll(".axis_y .domain").attr("opacity",0),g.selectAll(".axis_y").append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",a).attr("stroke",D().AXIS);g.append("text").attr("x",t/2).attr("y",a+e.selectAll(".axis_x").select("path").node().getBBox().height+25).attr("text-anchor","middle").attr("dominant-baseline","hanging").attr("font-size",12).text("".concat(o[0].field)),g.append("text").attr("transform","translate(".concat(-25,", ").concat(a/2,") rotate(-90)")).attr("text-anchor","middle").attr("font-size",12).text("".concat(i[0].field," (").concat(i[0].aggregate,")")||!1),g.selectAll(".axis_y .tick line").attr("class","gridline").attr("stroke",(function(e){return 0===e?0:D().DIVIDER})),y.append("g").attr("class","rects").selectAll("rect").data(u).enter().append("rect").attr("class","mark").attr("x",(function(e){return p(e[s])})).attr("y",(function(e){return h(e[c])})).attr("width",p.bandwidth()).attr("height",(function(e){return a-h(e[c])})).attr("fill",D().DEFAULT)}},{key:"encodeColor",value:function(){var e=this,t=this.breakdown(),a=t.length<2?null:t[1].field;a&&function(){var r=e.width(),i=e.height(),o=e.factdata(),s=e.measure(),c=t[0].field,l="count"===s[0].aggregate?"COUNT":s[0].field,u=n.select(".content");n.selectAll(".rects").remove();var d,f={};o.forEach((function(e,t){f[e[c]]?f[e[c]].push(e):f[e[c]]=[e]}));var p={};o.forEach((function(e){p[e[a]]?p[e[a]].push(e):p[e[a]]=[e]}));var h=Object.keys(p),g=[],y=function(e){var t={};t[c]=e,h.map((function(e){return t[e]=0})),f[e].map((function(e){return t[e[a]]=e[l]})),g.push(t)};for(var m in f)y(m);d=n.stack().keys(h)(g);var E=n.scaleBand().range([0,r]).domain(o.map((function(e){return e[c]}))).padding(.5),v=n.scaleLinear().range([i,0]).domain([0,n.max(d[d.length-1],(function(e){return e[1]}))]).nice();u.append("g").selectAll("g").data(d).join("g").attr("class","rectLayer").attr("fill",(function(e,t){return D().CATEGORICAL[t]})).selectAll("rect").data((function(e){return e})).enter().append("rect").attr("class","mark").attr("x",(function(e){return E(e.data[c])})).attr("y",(function(e){return v(e[1])})).attr("width",E.bandwidth()).attr("height",(function(e){return Math.abs(v(e[1])-v(e[0]))}))}()}}]),a}(R),k=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"visualize",value:function(){var e=10,t=10,a=50,r=50;return this.width(this.width()-r-t),this.height(this.height()-e-a),this._svg=n.select(this.container()).append("svg").attr("width",this.width()+r+t).attr("height",this.height()+e+a).append("g").attr("transform","translate("+r+","+e+")"),this.drawAxis(),this.encodeXY(),this.encodeColor(),this.svg()}},{key:"drawAxis",value:function(){var e=this.svg(),t=this.width(),a=this.height(),r=this.measure(),i=this.breakdown(),o=Math.ceil(Math.sqrt(a*t)/10),s=e.select(".axis");e.select(".axis_x").remove(),e.select(".axis_y").remove(),s.append("text").attr("x",t/2).attr("y",a+9.6-1).attr("font-size",16).attr("text-anchor","middle").attr("dominant-baseline","hanging").text(i[0].field||"Count"),s.append("path").attr("class","triangle").attr("transform","translate(".concat(t-o/25*2,", ").concat(a,")rotate(90)")).attr("d",n.symbol().type(n.symbolTriangle).size(o)).attr("fill",D.AXIS),s.append("line").attr("x1",-1).attr("x2",t).attr("y1",a).attr("y2",a).attr("stroke-width",2).attr("stroke",D.AXIS),s.append("text").attr("transform","translate(".concat(-9.6,", ").concat(a/2,") rotate(-90)")).attr("font-size",16).attr("text-anchor","middle").text(r[0].field||"Count"),s.append("path").attr("class","triangle").attr("transform","translate(0, ".concat(o/25*2,")")).attr("d",n.symbol().type(n.symbolTriangle).size(o)).attr("fill",D.AXIS),s.append("line").attr("y1",0).attr("y2",a).attr("stroke-width",2).attr("stroke",D.AXIS)}},{key:"encodeXY",value:function(){var e=this.svg(),t=this.width(),a=this.height(),r=this.factdata(),i=this.measure(),o=this.breakdown(),s=o[0].field,c="count"===i[0].aggregate?"COUNT":i[0].field,l={};r.forEach((function(e,t){l[e[s]]?l[e[s]].push(e):l[e[s]]=[e]}));var u=[];for(var d in l){var f;u.push((f={},Object(I.a)(f,s,d),Object(I.a)(f,c,n.sum(l[d],(function(e){return e[c]}))),f))}var p=n.scaleBand().range([0,t]).domain(r.map((function(e){return e[s]}))),h=n.scaleLinear().range([a,0]).domain([0,n.max(r,(function(e){return e[c]}))]).nice(),g=e.append("g").attr("class","axis"),y=e.append("g").attr("class","content").attr("chartWidth",t).attr("chartHeight",a),m=n.axisBottom(p),E=n.axisLeft(h).ticks(5).tickSize(-a,0,0).tickPadding(5).tickFormat((function(e){return e/1e6>=1?e=e/1e6+"M":e/1e3>=1&&(e=e/1e3+"K"),e}));g.append("g").attr("class","axis_x").attr("transform","translate(0, ".concat(a,")")).call(m),g.append("g").attr("class","axis_y").call(E),g.selectAll(".axis_y").selectAll(".domain").attr("opacity",0),g.selectAll(".axis_y").selectAll("line").attr("stroke",(function(e){return 0===e?D().AXIS:D().DIVIDER})).attr("class","gridline").attr("x1",0).attr("y1",0).attr("x2",t).attr("y2",0).attr("opacity",1),g.selectAll(".axis_x").append("line").attr("stroke",D().AXIS).attr("class","gridline").attr("x1",0).attr("y1",-a).attr("x2",0).attr("y2",0);console.log("measure:",i),console.log("breakdown:",o),g.append("text").attr("x",t/2).attr("y",a+e.selectAll(".axis_x").select("path").node().getBBox().height+20).attr("text-anchor","middle").attr("dominant-baseline","hanging").attr("font-size",12).text("".concat(o[0].field," (").concat(o[0].pictype,")")||!1),g.append("text").attr("transform","translate(".concat(-20,", ").concat(a/2,") rotate(-90)")).attr("text-anchor","middle").attr("font-size",12).text("".concat(i[0].field," (").concat(i[0].aggregate,")")||!1);var v=n.line().x((function(e){return p(e[s])})).y((function(e){return h(e[c])}));y.append("g").attr("class","lineGroup").attr("fill","none").attr("stroke",D().DEFAULT).attr("stroke-width",2).attr("opacity",1).selectAll("path").data(u).enter().append("path").attr("class","path").attr("d",v(u));var b=Math.min(Math.ceil(Math.sqrt(a*t)/50),4);y.append("g").attr("class","circleGroup").attr("fill",D().DEFAULT).selectAll("circle").data(u).enter().append("circle").attr("class","mark").attr("r",b).attr("cx",(function(e){return p(e[s])})).attr("cy",(function(e){return h(e[c])}))}},{key:"encodeColor",value:function(){var e=this.width(),t=this.height(),a=this.factdata(),r=this.measure(),i=this.breakdown(),o=i[0].field,s="count"===r[0].aggregate?"COUNT":r[0].field,c=i.length<2?null:i[1].field;c&&function(){var r,i={};a.forEach((function(e){i[e[c]]?i[e[c]].push(e):i[e[c]]=[e]})),r=i;var l=n.scaleBand().range([0,e]).domain(a.map((function(e){return e[o]}))),u=n.scaleLinear().range([t,0]).domain([0,n.max(a,(function(e){return e[s]}))]).nice();for(var d in r){var f=n.line().x((function(e){return l(e[o])})).y((function(e){return u(e[s])}));n.select(".content").append("g").attr("class","lineGroup").attr("fill","none").attr("stroke",D().DEFAULT).attr("stroke-width",3).attr("opacity",1).selectAll("path").data(r[d]).enter().append("path").attr("class","path").attr("d",f(r[d]))}var p=Math.min(Math.ceil(Math.sqrt(t*e)/50),4);for(var h in r)n.select(".content").append("g").attr("class","circleGroup").attr("fill",D().DEFAULT).selectAll("circle").data(r[h]).enter().append("circle").attr("class","mark").attr("r",p).attr("cx",(function(e){return l(e[o])})).attr("cy",(function(e){return u(e[s])}));n.selectAll(".circleGroup").attr("fill",(function(e,t){return D().CATEGORICAL[t]})),n.selectAll(".lineGroup").attr("stroke",(function(e,t){return D().CATEGORICAL[t]}))}()}}]),a}(R),L=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"visualize",value:function(){var e=10,t=10,a=50,r=50;this.width(this.width()-r-t),this.height(this.height()-e-a),this._svg=n.select(this.container()).append("svg").attr("width",this.width()+r+t).attr("height",this.height()+e+a).append("g").attr("transform","translate("+r+","+e+")");var i=this.measure(),o=this.breakdown();return i[0]&&i[1]&&(this.x=i[0],this.y=i[1]),i[2]&&(this.size=i[2]),o[1]&&(this.color=o[1]),this.drawAxis(),this.encodeXY(),this.encodeColor(),this.encodeSize(),this.svg()}},{key:"drawAxis",value:function(){if(this.x&&this.y){var e=this.x,t=this.y,a=this.svg(),r=this.width(),i=this.height(),o=Math.ceil(Math.sqrt(i*r)/10),s=a.select(".axis");a.select(".axis_x").remove(),a.select(".axis_y").remove(),s.append("text").attr("x",r/2).attr("y",i+9.6-1).attr("font-size",16).attr("text-anchor","middle").attr("dominant-baseline","hanging").text(e||"Count"),s.append("path").attr("class","triangle").attr("transform","translate(".concat(r-o/25*2,", ").concat(i,")rotate(90)")).attr("d",n.symbol().type(n.symbolTriangle).size(o)).attr("fill",D().AXIS),s.append("line").attr("x1",-1).attr("x2",r).attr("y1",i).attr("y2",i).attr("stroke-width",2).attr("stroke",D().AXIS),s.append("text").attr("transform","translate(".concat(-9.6,", ").concat(i/2,") rotate(-90)")).attr("font-size",16).attr("text-anchor","middle").text(t||"Count"),s.append("path").attr("class","triangle").attr("transform","translate(0, ".concat(o/25*2,")")).attr("d",n.symbol().type(n.symbolTriangle).size(o)).attr("fill",D().AXIS),s.append("line").attr("y1",0).attr("y2",i).attr("stroke-width",2).attr("stroke",D().AXIS)}}},{key:"encodeXY",value:function(){if(this.x&&this.y){var e=this.svg(),t=this.width(),a=this.height(),r=this.processedData(),i=this.x,o=this.y,s=e.append("g").attr("class","axis"),c=e.append("g").attr("class","content").attr("chartWidth",t).attr("chartHeight",a),l=n.scaleLinear().range([0,t]).domain([0,n.max(r,(function(e){return e[i]}))]).nice(),u=n.scaleLinear().range([a,0]).domain([0,n.max(r,(function(e){return e[o]}))]).nice(),d=n.axisBottom(l).ticks(5).tickPadding(5).tickFormat((function(e){return e/1e6>=1?e=e/1e6+"M":e/1e3>=1&&(e=e/1e3+"K"),e})),f=n.axisLeft(u).ticks(5).tickPadding(5).tickFormat((function(e){return e/1e6>=1?e=e/1e6+"M":e/1e3>=1&&(e=e/1e3+"K"),e}));s.append("g").attr("class","axis_x").attr("transform","translate(0, ".concat(a,")")).call(d),s.append("g").attr("class","axis_y").call(f),s.selectAll(".axis_y .tick").append("line").attr("stroke",(function(e){return 0===e?D().AXIS:D().DIVIDER})).attr("class","gridline").attr("x1",0).attr("y1",0).attr("x2",t).attr("y2",0),s.selectAll(".axis_x .tick").append("line").attr("stroke",D().DIVIDER).attr("class","gridline").attr("x1",0).attr("y1",-a).attr("x2",0).attr("y2",0),s.append("line").attr("stroke",D().DIVIDER).attr("class","gridline").attr("x1",t).attr("y1",a).attr("x2",t).attr("y2",0),s.append("line").attr("stroke",D().DIVIDER).attr("class","gridline").attr("x1",0).attr("y1",0).attr("x2",t).attr("y2",0);s.append("text").attr("x",t/2).attr("y",a+e.selectAll(".axis_x").select("path").node().getBBox().height+20).attr("text-anchor","middle").attr("dominant-baseline","hanging").attr("font-size",12).text(i),s.append("text").attr("transform","translate(".concat(-20-e.selectAll(".axis_y").select("path").node().getBBox().width,", ").concat(a/2,") rotate(-90)")).attr("text-anchor","middle").attr("font-size",12).text(o);var p=Math.min(Math.ceil(Math.sqrt(a*t)/50),7);c.append("g").attr("class","circleGroup").selectAll("circle").data(r).enter().append("circle").attr("class","mark").attr("r",p).attr("stroke","#FFF").attr("stroke-width",0).attr("fill",D().DEFAULT).attr("opacity",1).attr("cx",(function(e){return l(e[i])})).attr("cy",(function(e){return u(e[o])}))}}},{key:"encodeColor",value:function(){if(this.color){var e=this.color,t=Array.from(new Set(this.processedData().map((function(t){return t[e]}))));this.svg().selectAll("circle").attr("fill",(function(a){var r=t.indexOf(a[e]);return D().CATEGORICAL[r%8]}))}}},{key:"encodeSize",value:function(){if(this.size){var e=this.size,t=this.width(),a=this.height(),r=e,i=Math.min(Math.ceil(Math.sqrt(a*t)/40),15),o=i,s=i/10,c=n.min(this.processedData(),(function(e){return e[r]})),l=n.max(this.processedData(),(function(e){return e[r]})),u=n.scaleSqrt([c,l],[s,o]);this.svg().selectAll("circle").attr("r",(function(e){return u(e[r])}))}}},{key:"encodeShape",value:function(){}},{key:"addEncoding",value:function(e,t,a){console.log(t),this[e]||(this[e]=t.field,n.selectAll("svg > g > *").remove(),this.drawAxis(),this.x&&this.y&&this.encodeXY(),this.color&&this.encodeColor(),this.size&&this.encodeSize())}},{key:"modifyEncoding",value:function(e,t,a){this[e]&&(this[e]=t,n.selectAll("svg > g > *").remove(),this.drawAxis(),this.x&&this.y&&this.encodeXY(),this.color&&this.encodeColor(),this.size&&this.encodeSize())}},{key:"removeEncoding",value:function(e,t){this[e]=null,n.selectAll("svg > g > *").remove(),this.x&&this.y&&this.encodeXY(),this.color&&this.encodeColor(),this.size&&this.encodeSize()}}]),a}(R),w=a(33),P=function(){function e(){Object(r.a)(this,e),this._id=0,this._x=0,this._y=0,this._radius=0,this._color=D().DEFAULT,this._visible="1",this._opacity=1,this._unitgroup={}}return Object(i.a)(e,[{key:"id",value:function(e){if(!e)return this._id;this._id=e}},{key:"data",value:function(e){var t=this;if(!e)return this._dataItem;Object.entries(e).forEach((function(e){var a=Object(w.a)(e,2),r=a[0],i=a[1];return t[r]=i}))}},{key:"unitgroup",value:function(e,t){if(!t&&!e)return this._unitgroup;this._unitgroup[e]=t}},{key:"x",value:function(e){if(!e)return this._x;this._x=e}},{key:"y",value:function(e){if(!e)return this._y;this._y=e}},{key:"radius",value:function(e){if(!e)return this._radius;this._radius=e}},{key:"color",value:function(e){if(!e)return this._color;this._color=e}},{key:"visible",value:function(e){if(!e)return this._visible;this._visible=e}},{key:"opacity",value:function(e){if(!e)return this._opacity;this._opacity=e}}]),e}(),N=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"visualize",value:function(){return this.units=[],this._svg=n.select(this.container()).append("svg").attr("width",this.width()).attr("height",this.height()).append("g"),this.data(),this.initvis(),this.svg()}},{key:"data",value:function(){var e=this;return this.processedData().forEach((function(t,a){var r=new P;r.id(a),r.data(t),e.units.push(r)})),this}},{key:"initvis",value:function(){for(var e=this.svg(),t=this.width(),a=this.height(),r=this.processedData(),i=Math.min(t,a),n=i/10,o=i/10,s=Math.ceil(r.length/2500),c=Math.floor(Math.sqrt(s)),l=Math.ceil(s/c),u=Math.min((i-n-o)/(51*l-1),6),d=Math.floor(Math.sqrt(r.length)),f=Math.ceil(r.length/d),p=(t-2.2*f*u)/2-u,h=(a-2.2*d*u)/2-u,g=this.units.filter((function(e){return"1"===e.visible()})),y=0,m=0;m<d;m++)for(var E=0;E<f;E++){var v=p+2.2*u*E,b=h+2.2*u*m;if(y>=g.length)break;g[y].x(v),g[y].y(b),g[y].radius(u),y+=1}e.append("g").attr("class","content").attr("chartWidth",t).attr("chartHeight",a).append("g").attr("class","circleGroup").selectAll("circle").data(this.units).enter().append("circle").attr("class","mark").attr("r",(function(e){return e.radius()})).attr("stroke","#FFF").attr("stroke-width",0).attr("fill",(function(e){return e.color()})).attr("opacity",0).attr("cx",(function(e){return e.x()})).attr("cy",(function(e){return e.y()})).transition().delay(a<=200?0:2e3).duration(a<=200?0:2e3).attr("opacity",1)}},{key:"encodeX",value:function(){var e=this,t=this.svg(),a=this.width(),r=this.height(),i=a/20,o=a/20,s=15;if(r<200&&(s=14),this.x&&this.y&&this.size){var c=function(e,t,a){var r=document.createElement("span"),i={};return i.width=r.offsetWidth,i.height=r.offsetHeight,r.style.visibility="hidden",r.style.fontSize=e,r.style.fontFamily=t,r.style.display="inline-block",document.body.appendChild(r),"undefined"!=typeof r.textContent?r.textContent=a:r.innerText=a,i.width=parseFloat(window.getComputedStyle(r).width)-i.width,i.height=parseFloat(window.getComputedStyle(r).height)-i.height,i},l=this.units[0].unitgroup().size,u=this.units[0].unitgroup().y,d=this.x.field,f=n.nest().key((function(e){return e[d]})).key((function(e){return e[u]})).rollup((function(e){return e.length})).entries(this.processedData()),p=n.nest().key((function(e){return e[u]})).rollup((function(e){return e.length})).entries(this.processedData());f.sort((function(e,t){return n.ascending(e.key,t.key)})),p.sort((function(e,t){return n.descending(e.key,t.key)}));var h=f.length,g=p.length,y=h,m=g,E=.7*n.min([.8*r/(m+1)/2,.8*a/(y+1)/2]);f.sort((function(e,t){return n.ascending(e.key,t.key)})),f.forEach((function(e){e.values.sort((function(e,t){return n.descending(e.key,t.key)}))}));for(var v,b,T=0,A=0;A<h;A++){var _=n.max(f[A].values,(function(e){return e.value}));T=Math.max(T,_)}y>4?(v=Math.sqrt(T)/3,b=1.5):a<=200?(v=Math.sqrt(T)/5,b=1):(v=Math.sqrt(T)/2,b=1.8);var O,C=E/Math.sqrt(v)*b;O=2.1*E*y;var I=p.map((function(e){return c(s,"Arial",e.key).width})),R=n.max(I),D=2*E+2*s+c(s,"Arial",u).height+R;O=n.min([O,.8*a]);var x,k=f.map((function(e,t){if(1===y)return 2===f.length?0===t?C:3.1*E+C:(a-C)/2;if(.9*a-O-2*D>0){var r=(1*a-(.9*a-2*D)-2*D)/2+D,i=y<=6?.5*r:n.min([2*E,.5*r+E]);return r+(.9*a-r-i)/(y-1)*Math.floor(t%y)}if(.9*a-O-2*D<=0){var o=1*D,s=y<=6?.5*o:n.min([2*E,.5*o+E]);return o+(.9*a-o-s)/(y-1)*Math.floor(t%y)}}));x=m%2===0?2*E*m:2*E*(m+1);var L=p.map((function(e,t){return m>2?(x=n.min([x,.8*r]),(.6*r-x)/2+2*E+n.min([(r-6*E)/(m-1),4*E])*t):((r-3.6*E)/(m-1)<=3*E?3*E:(r-3*E*(m-1))/1.4)+n.min([(r-3.6*E)/(m-1),3*E])*t})),w=[],P=[],N=f.map((function(e){return e.key})),S=p.map((function(e){return e.key}));w=this.units.map((function(e,t){return P[t]=e[l],{id:e.id(),distribution:e[d],category:[N.indexOf(e[d]),S.indexOf(e[u])],radius:0,value:e[l]}}));var F=n.extent(this.units,(function(e){return e[l]})),V=n.scaleLinear().domain([F[0],F[1]]).range([C/100,C]);for(var j in w)w[j].radius=Math.sqrt(V(w[j].value));n.forceSimulation(w).force("charge",n.forceManyBody().strength(.01)).force("x",n.forceX().x((function(e){return k[e.category[0]]}))).force("y",n.forceY().y((function(e){return L[e.category[1]]}))).force("collision",n.forceCollide().strength(1).radius((function(e){return e.radius+.15}))).stop().tick(200);var M=function(t){var a=w.find((function(e){return e.id==t}));a?(e.units[a.id].x(a.x),e.units[a.id].y(a.y),e.units[a.id].visible("1"),e.units[t].radius(a.radius),e.units[a.id].color(a.color),e.units[a.id].unitgroup("size",l)):e.units[t].visible("0"),e.units[t].opacity("1")};for(var G in this.units)M(G);t.select(".content").selectAll("text").transition().delay(this.delay).duration(this.duration/2).attr("fill-opacity",0),f.forEach((function(a,r){t.select(".content").append("text").text(N[r]).attr("x",k[r]).attr("y",L[L.length-1]+2*E).attr("font-size",.8*s).attr("text-anchor","middle").attr("transform","translate("+k[r]+","+L+") rotate(-45)").attr("fill-opacity",0).transition().delay(e.delay+e.duration/2).duration(e.duration/2).attr("fill-opacity",1)})),p.forEach((function(a,r){t.select(".content").append("text").text(S[r]).attr("x",k[0]-2*E).attr("y",L[r]).attr("font-size",.8*s).attr("text-anchor","end").attr("transform","translate("+k[r]+","+L+") rotate(-45)").attr("fill-opacity",0).transition().delay(e.delay+e.duration/2).duration(e.duration/2).attr("fill-opacity",1)})),r>200&&(t.select(".content").append("text").text(d).attr("x",a/2).attr("y",Math.min(L[L.length-1]+2*E+2*s,r)).attr("font-size",.9*s).attr("text-anchor","middle").attr("fill-opacity",0).transition().delay(this.delay+this.duration/2).duration(this.duration/2).attr("fill-opacity",1),t.select(".content").append("text").text(u).attr("x",k[0]-2*E-3*s).attr("y",r/2).attr("font-size",.9*s).attr("text-anchor","middle").attr("transform","rotate(-90, ".concat(k[0]-2*E-3*s,", ").concat(r/2,")")).attr("fill-opacity",0).transition().delay(this.delay+this.duration/2).duration(this.duration/2).attr("fill-opacity",1))}else!function(){var c=e.x.field,l=n.nest().key((function(e){return e[c]})).rollup((function(e){return e.length})).entries(e.processedData()),u=l.length;l.sort((function(e,t){return n.ascending(e.key,t.key)}));var d=l.map((function(e){return e.key})),f=l.map((function(e){return e.value})),p=n.max(f),h=Math.ceil(30/u)<5?Math.ceil(30/u):5,g=(a-i-o)/((h+2)*(u-1)+h)/2,y=.8*r/Math.ceil(p/h)/2,m=Math.min(Math.min(g,y),6);r<200&&(m=Math.min(Math.min(g,y),3));var E=(.9*a-2*u*h*m)/m/(u+3)/2<1?.2:Math.floor((.9*a-2*u*h*m)/m/(u+3)/2),v=(.9*a-u*h*2*m-(u-1)*E*2*m)/2,b=n.range(v+m,a-v-(2*h-1)*m+1,(a-2*v-2*h*m)/(u-1)),T=(.9*r-2*Math.ceil(p/h)*m)/2+2*Math.ceil(p/h)*m-m,A=e.units.filter((function(e){return"1"===e.visible()}));r<200&&(T*=.85);for(var _=[],O=function(e){var t=A.filter((function(t){return t[c]===d[e]}));_.push(t)},C=0;C<u;C++)O(C);t.select(".content").selectAll("text").transition().delay(e.delay).duration(e.duration/2).attr("fill-opacity",0),_.forEach((function(i,n){t.select(".content").append("text").text(d[n]).attr("x",b[n]+(h-1)*m).attr("y",T+m+s).attr("font-size",s).attr("text-anchor","middle").attr("transform",a<=200&d[n].length>=4?"rotate(-45, ".concat(b[n]-m+h*m,", ").concat(T+m+s,")"):"translate("+b[n]-m+h*m+","+T+m+s+") rotate(-45)").attr("fill-opacity",0).transition().delay(e.delay+e.duration/2).duration(e.duration/2).attr("fill-opacity",1),i.forEach((function(e,t){var a=Math.floor(t/h),r=t%h;e.x(b[n]+2*m*r),e.y(T-2*m*a),e.radius(m),e.opacity(1),e.unitgroup("x",c)})),r>200&&t.select(".content").append("text").text(c).attr("x",a/2).attr("y",(function(){return r<200?T+30:Math.min(T+50,r)})).attr("font-size",s).attr("text-anchor","middle").attr("fill-opacity",0).transition().delay(e.delay).duration(e.delay+e.duration/2).attr("fill-opacity",1)}))}()}},{key:"encodeY",value:function(){var e=this,t=this.svg(),a=this.width(),r=this.height();if(this.x&&!this.size)!function(){var i,o=a/20,s=a/20,c=e.units[0].unitgroup().x,l=e.y.field,u=n.nest().key((function(e){return e[c]})).rollup((function(e){return e.length})).entries(e.processedData()),d=n.nest().key((function(e){return e[l]})).rollup((function(e){return e.length})).entries(e.processedData()),f=u.length,p=Math.ceil(30/f)<5?Math.ceil(30/f):5;i=f>=8&r>200?14:f>=8&r<200?10:15;var h=d.length;u.sort((function(e,t){return n.ascending(e.key,t.key)})),d.sort((function(e,t){return n.descending(e.key,t.key)}));for(var g=u.map((function(e){return e.key})),y=d.map((function(e){return e.key})),m=[],E={},v=e.units.filter((function(e){return"1"===e.visible()})),b=function(e){for(var t=[],a=v.filter((function(t){return t[c]===g[e]})),r=function(r){var i=a.filter((function(e){return e[l]===y[r]}));E[y[r]]||(E[y[r]]=i.length),i.length>E[y[r]]&&(E[y[r]]=i.length),t.push({x:g[e],y:y[r],data:i})},i=0;i<h;i++)r(i);m.push(t)},T=0;T<f;T++)b(T);for(var A=0,_=0,O=Object.entries(E);_<O.length;_++){var C=Object(w.a)(O[_],2),I=(C[0],C[1]);A+=Math.ceil(I/p)}var R=(a-o-s)/((p+1)*(f-1)+p)/2.2,D=n.min([(.9*r-2*i)/A/2,(.9*r-2*i)/h/(Math.ceil(p)+1)/2]),x=Math.min(Math.min(R,D),6);r<200&&(x*=.8);var k,L=u.map((function(e,t){if(1===f)return(a-p*x*2.2)/2;if(r<200&f>10){var i=(.9*a-2*f*p*x)/x/(f+3)/2<1?.2:Math.floor((.9*a-2*f*p*x)/x/(f+3)/2),n=(1*a-f*p*2*x-(f-1)*i*2*x)/2+1*o;return.5*n+(a-2*n)/(f-1)*1.2*t}if(f>=2){var s=(.9*a-2*f*p*x)/x/(f+3)/2<1?.2:Math.floor((.9*a-2*f*p*x)/x/(f+3)/2),c=(1*a-f*p*2*x-(f-1)*s*2*x)/2+1*o;return c+(a-2*c)/(f-1)*t}})),P=n.max([(r-A*x*2-h*x*2-20)/2,.1*r]),N=(k=r<200&h>10||r<200&f>10?[0]:r<200&&h<3?[1.1*P]:r<200?[.4*P]:[P])[0];if(r<200&h>10)for(var S=0;S<h;S++)N+=E[y[S]]/p*2*x+5,k.push(N);else if(r<200)for(var F=0;F<h;F++)N+=E[y[F]]/p*2*x+5,k.push(N);else for(var V=0;V<h;V++)N+=E[y[V]]/p*2*x+10,k.push(N);t.select(".content").selectAll("text").transition().delay(e.delay).duration(e.duration/2).attr("fill-opacity",0);for(var j=function(n){t.select(".content").append("text").text(g[n]).attr("x",L[n]+(p-1)*x).attr("y",k[k.length-1]+10).attr("font-size",(function(){return r<200?.7*i:i})).attr("text-anchor","middle").attr("transform","translate("+L[n]-x+p*x+","+k[k.length-1]+x+i+") rotate(-45)").attr("fill-opacity",0).transition().delay(e.delay+e.duration/2).duration(e.duration/2).attr("fill-opacity",1);for(var o=m[n],s=function(a){t.select(".content").append("text").text(y[a]).attr("x",(function(){return r<200&u.length>10?L[0]-x-10:L[0]-x-20})).attr("y",k[a]+2*x).attr("font-size",i).attr("text-anchor","end").attr("transform","translate("+k[0]+x+i-x+p*x+","+k[a]+3*x+x+i+") rotate(-45)").attr("fill-opacity",0).transition().delay(e.delay+e.duration/2).duration(e.duration/2).attr("fill-opacity",1);var s=L[n],c=k[a],d=o[a];d&&d.data.forEach((function(e,t){var a=Math.floor(t/p),r=t%p;e.x(s+2*x*r),e.y(c+2*x*a),e.radius(x),e.opacity(1),e.unitgroup("y",l)}))},d=0;d<h;d++)s(d);r>200&&(t.select(".content").append("text").text(c).attr("x",a/2).attr("y",(function(){return r<200?k[k.length-1]+20:Math.min(k[k.length-1]+3*i,r)})).attr("font-size",i).attr("text-anchor","middle").attr("fill-opacity",0).transition().delay(e.delay+e.duration/2).duration(e.duration).attr("fill-opacity",1),t.select(".content").append("text").text(l).attr("x",(function(){return r<200&&o>3?L[0]-x-20-1.5*i:r<200&&o<3?L[0]-x-20-3*i:o<3?L[0]-x-20-6*i:L[0]-x-20-3.5*i-5})).attr("y",(function(){return r<200?r/3:r/2})).attr("font-size",i).attr("text-anchor","middle").attr("transform",(function(){return r<200?"rotate(-90, ".concat(L[0]-x-20-1.5*i,", ").concat(r/3,")"):o<3?"rotate(-90, ".concat(L[0]-x-20-6*i,", ").concat(r/3,")"):"rotate(-90, ".concat(L[0]-x-20-3.5*i-5,", ").concat(r/2,")")})).attr("text-anchor","middle").attr("fill-opacity",0).transition().delay(e.delay+e.duration/2).duration(e.duration/2).attr("fill-opacity",1))},M=0;M<f;M++)j(M)}();else if(this.x){if(this.x&&this.y&&this.size){var i=function(e,t,a){var r=document.createElement("span"),i={};return i.width=r.offsetWidth,i.height=r.offsetHeight,r.style.visibility="hidden",r.style.fontSize=e,r.style.fontFamily=t,r.style.display="inline-block",document.body.appendChild(r),"undefined"!=typeof r.textContent?r.textContent=a:r.innerText=a,i.width=parseFloat(window.getComputedStyle(r).width)-i.width,i.height=parseFloat(window.getComputedStyle(r).height)-i.height,i},o=this.units[0].unitgroup().size,s=this.units[0].unitgroup().x,c=this.y.field,l=n.nest().key((function(e){return e[s]})).key((function(e){return e[c]})).rollup((function(e){return e.length})).entries(this.processedData()),u=n.nest().key((function(e){return e[c]})).rollup((function(e){return e.length})).entries(this.processedData());l.sort((function(e,t){return n.ascending(e.key,t.key)})),u.sort((function(e,t){return n.descending(e.key,t.key)}));var d=l.length,f=u.length,p=d,h=f,g=.7*n.min([.8*r/(h+1)/2,.8*a/(p+1)/2]);l.sort((function(e,t){return n.ascending(e.key,t.key)})),l.forEach((function(e){e.values.sort((function(e,t){return n.descending(e.key,t.key)}))}));for(var y,m,E=0,v=0;v<d;v++){var b=n.max(l[v].values,(function(e){return e.value}));E=Math.max(E,b)}p>4?(y=Math.sqrt(E)/3,m=1.5):a<=200?(y=Math.sqrt(E)/5,m=1):(y=Math.sqrt(E)/2,m=1.8);var T,A=g/Math.sqrt(y)*m;T=2.1*g*p;var _=u.map((function(e){return i(15,"Arial",e.key).width})),O=n.max(_),C=2*g+30+i(15,"Arial",c).height+O;T=n.min([T,.8*a]);var I,R=l.map((function(e,t){if(1===p)return 2===l.length?0===t?A:3.1*g+A:(a-A)/2;if(p<3){return(a-(T-2*g))/2+(T-2*g)/(p-1)*Math.floor(t%p)}if(.9*a-T-2*C>0){var r=(1*a-(.9*a-2*C)-2*C)/2+C,i=p<=6?.5*r:n.min([2*g,.5*r+g]);return r+(.9*a-r-i)/(p-1)*Math.floor(t%p)}if(.9*a-T-2*C<=0){var o=1*C,s=p<=6?.5*o:n.min([2*g,.5*o+g]);return o+(.9*a-o-s)/(p-1)*Math.floor(t%p)}}));I=h%2===0?2*g*h:2*g*(h+1);var D=u.map((function(e,t){return h>2?(I=n.min([I,.8*r]),(.6*r-I)/2+2*g+n.min([(r-6*g)/(h-1),4*g])*t):((r-3.6*g)/(h-1)<=3*g?3*g:(r-3*g*(h-1))/1.4)+n.min([(r-3.6*g)/(h-1),3*g])*t})),x=[],k=[],L=l.map((function(e){return e.key})),P=u.map((function(e){return e.key}));x=this.units.map((function(e,t){return k[t]=e[o],{id:e.id(),distribution:e[s],category:[L.indexOf(e[s]),P.indexOf(e[c])],radius:0,value:e[o]}}));var N=n.extent(this.units,(function(e){return e[o]})),S=n.scaleLinear().domain([N[0],N[1]]).range([A/100,A]);for(var F in x)x[F].radius=Math.sqrt(S(x[F].value));n.forceSimulation(x).force("charge",n.forceManyBody().strength(.01)).force("x",n.forceX().x((function(e){return R[e.category[0]]}))).force("y",n.forceY().y((function(e){return D[e.category[1]]}))).force("collision",n.forceCollide().strength(1).radius((function(e){return e.radius+.15}))).stop().tick(200);var V=function(t){var a=x.find((function(e){return e.id==t}));a?(e.units[a.id].x(a.x),e.units[a.id].y(a.y),e.units[a.id].visible("1"),e.units[t].radius(a.radius),e.units[a.id].color(a.color),e.units[a.id].unitgroup("size",o)):e.units[t].visible("0"),e.units[t].opacity("1")};for(var j in this.units)V(j);t.select(".content").selectAll("text").transition().delay(this.delay).duration(this.duration/2).attr("fill-opacity",0),l.forEach((function(a,r){t.select(".content").append("text").text(L[r]).attr("x",R[r]).attr("y",D[D.length-1]+2*g).attr("font-size",12).attr("text-anchor","middle").attr("transform","translate("+R[r]+","+D+") rotate(-45)").attr("fill-opacity",0).transition().delay(e.delay+e.duration/2).duration(e.duration/2).attr("fill-opacity",1)})),u.forEach((function(a,r){t.select(".content").append("text").text(P[r]).attr("x",R[0]-2*g).attr("y",D[r]).attr("font-size",12).attr("text-anchor","end").attr("transform","translate("+R[r]+","+D+") rotate(-45)").attr("fill-opacity",0).transition().delay(e.delay+e.duration/2).duration(e.duration/2).attr("fill-opacity",1)})),r>200&&(t.select(".content").append("text").text(s).attr("x",a/2).attr("y",Math.min(D[D.length-1]+2*g+30,r)).attr("font-size",13.5).attr("text-anchor","middle").attr("fill-opacity",0).transition().delay(this.delay+this.duration/2).duration(this.duration/2).attr("fill-opacity",1),t.select(".content").append("text").text(c).attr("x",R[0]-2*g-45).attr("y",r/2).attr("font-size",13.5).attr("text-anchor","middle").attr("transform","rotate(-90, ".concat(R[0]-2*g-45,", ").concat(r/2,")")).attr("fill-opacity",0).transition().delay(this.delay+this.duration/2).duration(this.duration/2).attr("fill-opacity",1))}}else!function(){var i=a/20,o=a/20,s=e.y.field,c=n.nest().key((function(e){return e[s]})).rollup((function(e){return e.length})).entries(e.processedData()),l=c.length;c.sort((function(e,t){return n.ascending(e.key,t.key)}));for(var u=c.map((function(e){return e.key})),d=c.map((function(e){return e.value})),f=n.max(d),p=Math.ceil(30/l)<5?Math.ceil(30/l):5,h=n.min([a-i-o,.8*a])/Math.ceil(f/p)/2,g=.8*r/l/(Math.ceil(p)+1)/2,y=Math.min(Math.min(h,g),6),m=(.9*r-2*l*p*y)/y/(l+3)/2<1?.2:Math.floor((.9*r-2*l*p*y)/y/(l+3)/2),E=(.9*r-l*p*2*y-(l-1)*m*2*y)/2,v=n.range(E,r-E-(2*p-1)*y+1,(r-E-(2*p-1)*y-E)/(l-1)),b=n.min([2*Math.ceil(f/p)*y,.8*a]),T=(.9*a-b)/2+60+y,A=e.units.filter((function(e){return"1"===e.visible()})),_=[],O=function(e){var t=A.filter((function(t){return t[s]===u[e]}));_.push(t)},C=0;C<l;C++)O(C);t.select(".content").selectAll("text").transition().delay(e.delay).duration(e.duration/2).attr("fill-opacity",0),_.forEach((function(i,n){t.select(".content").append("text").text(u[n]).attr("x",T-y-30).attr("y",v[n]+(p-3)*y).attr("font-size",15).attr("text-anchor","middle").attr("transform","rotate(-45, ".concat(T[n]-y+p*y,", ").concat(v+y+15,")")).attr("fill-opacity",0).transition().delay(e.delay).duration(e.delay+e.duration/2).attr("fill-opacity",1),i.forEach((function(e,t){var a=Math.floor(t/p),r=t%p;e.x(T+2*y*a),e.y(v[n]+2*y*r),e.radius(y),e.opacity(1),e.unitgroup("x",s)})),t.select(".content").append("text").text(s).attr("x",Math.min(T-y-60,a)).attr("y",r/2).attr("font-size",15).attr("transform","rotate(-90, ".concat(Math.min(T-y-60,a),", ").concat(r/2,")")).attr("text-anchor","middle").attr("fill-opacity",0).transition().delay(e.delay+e.duration/2).duration(e.duration/2).attr("fill-opacity",1)}))}()}},{key:"encodeColor",value:function(){var e=this;this.color&&function(){e.svg();for(var t=e.color.field,a=n.nest().key((function(e){return e[t]})).rollup((function(e){return e.length})).entries(e.processedData()),r=a.map((function(e){return e.key})),i=[],o=function(a){var n=e.units.filter((function(e){return e[t]===r[a]}));i.push(n)},s=0;s<a.length;s++)o(s);i.forEach((function(e,a){e.forEach((function(e){e.color(D().CATEGORICAL[a%8]),e.unitgroup("color",t)}))}))}()}},{key:"encodeSize",value:function(){var e=this,t=this.svg(),a=this.width(),r=this.height();if(this.x&&this.y&&this.size){var i=function(e,t,a){var r=document.createElement("span"),i={};return i.width=r.offsetWidth,i.height=r.offsetHeight,r.style.visibility="hidden",r.style.fontSize=e,r.style.fontFamily=t,r.style.display="inline-block",document.body.appendChild(r),"undefined"!=typeof r.textContent?r.textContent=a:r.innerText=a,i.width=parseFloat(window.getComputedStyle(r).width)-i.width,i.height=parseFloat(window.getComputedStyle(r).height)-i.height,i},o=this.units[0].unitgroup().x,s=this.units[0].unitgroup().y,c=this.size.field,l=n.nest().key((function(e){return e[o]})).key((function(e){return e[s]})).rollup((function(e){return e.length})).entries(this.processedData()),u=n.nest().key((function(e){return e[s]})).rollup((function(e){return e.length})).entries(this.processedData());l.sort((function(e,t){return n.ascending(e.key,t.key)})),u.sort((function(e,t){return n.descending(e.key,t.key)}));var d,f=l.length,p=u.length,h=f,g=p;d=g>10?.5*n.min([.8*r/(g+1)/2,.8*a/(h+1)/2]):.7*n.min([.8*r/(g+1)/2,.8*a/(h+1)/2]),l.sort((function(e,t){return n.ascending(e.key,t.key)})),l.forEach((function(e){e.values.sort((function(e,t){return n.descending(e.key,t.key)}))}));for(var y,m,E=0,v=0;v<f;v++){var b=n.max(l[v].values,(function(e){return e.value}));E=Math.max(E,b)}g>10?(y=Math.sqrt(E)/5,m=1.3):r<200&h>10?(y=Math.sqrt(E)/8,m=.3):h>4?(y=Math.sqrt(E)/3,m=1.5):r<200?(y=Math.sqrt(E)/6,m=.6):(y=Math.sqrt(E)/3,m=1.5);var T,A=d/Math.sqrt(y)*m;T=2.1*d*h;var _=u.map((function(e){return i(15,"Arial",e.key).width})),O=n.max(_),C=2*d+30+i(15,"Arial",s).height+O;T=n.min([T,.8*a]);var I,R=l.map((function(e,t){if(1===h)return 2===l.length?0===t?A:3.1*d+A:(a-A)/2;if(h<3){var i=2;return r<200&&(i=-1.8),(a-(T-i*d))/2+(T-i*d)/(h-1)*Math.floor(t%h)}if(r<200&g>10){var o=(1*a-(.9*a-2*C)-2*C)/2+C,s=h<=6?.5*o:n.min([2*d,.5*o+d]);return.5*o+(.9*a-o-s)/(h-1)*2.5*Math.floor(t%h)}if(r<200&h>10){var c=(1*a-(.9*a-2*C)-2*C)/2+C,u=h<=6?.5*c:n.min([2*d,.5*c+d]);return.15*c+(.9*a-c-u)/(h-1)*1.8*Math.floor(t%h)}if(.9*a-T-2*C>0){var f=(1*a-(.9*a-2*C)-2*C)/2+C,p=h<=6?.5*f:n.min([2*d,.5*f+d]);return f+(.9*a-f-p)/(h-1)*Math.floor(t%h)}if(.9*a-T-2*C<=0){var y=1*C,m=h<=6?.5*y:n.min([2*d,.5*y+d]);return y+(.9*a-y-m)/(h-1)*Math.floor(t%h)}}));I=g%2===0?2*d*g:2*d*(g+1);var D=u.map((function(e,t){if(g>10&r<200)return I=n.min([I,.6*r]),.35*((.5*r-I)/2+2*d)+1.1*n.min([(r-6*d)/(g-1),4*d])*t;if(h>10&r<200)return I=n.min([I,.6*r]),.4*((.5*r-I)/2+2*d)+1.1*n.min([(r-6*d)/(g-1),4*d])*t;if(g>10)return I=n.min([I,.6*r]),(.6*r-I)/2+2*d+n.min([(r-6*d)/(g-1),4*d])*t;if(g>3)return I=n.min([I,.8*r]),(.6*r-I)/2+2*d+n.min([(r-6*d)/(g-1),4*d])*t;if(g<3){I=n.min([I,.8*r]);var a=(.6*r-I)/2+2*d;return console.log("am herer"),a+n.min([(r-6*d)/(g-1),4*d])*t}return((r-3.6*d)/(g-1)<=3*d?3*d:(r-3*d*(g-1))/1.4)+n.min([(r-3.6*d)/(g-1),3*d])*t})),x=[],k=[],L=l.map((function(e){return e.key})),w=u.map((function(e){return e.key}));x=this.units.map((function(e,t){return k[t]=e[c],{id:e.id(),distribution:e[o],category:[L.indexOf(e[o]),w.indexOf(e[s])],radius:0,value:e[c]}}));var P=n.extent(this.units,(function(e){return e[c]})),N=n.scaleLinear().domain([P[0],P[1]]).range([A/100,A]);for(var S in x)x[S].radius=Math.sqrt(N(x[S].value));n.forceSimulation(x).force("charge",n.forceManyBody().strength(.01)).force("x",n.forceX().x((function(e){return R[e.category[0]]}))).force("y",n.forceY().y((function(e){return D[e.category[1]]}))).force("collision",n.forceCollide().strength(1).radius((function(e){return e.radius+.15}))).stop().tick(200);var F=function(t){var a=x.find((function(e){return e.id==t}));a?(e.units[a.id].x(a.x),e.units[a.id].y(a.y),e.units[a.id].visible("1"),e.units[t].radius(a.radius),e.units[a.id].color(a.color),e.units[a.id].unitgroup("size",c)):e.units[t].visible("0"),e.units[t].opacity("1")};for(var V in this.units)F(V);t.select(".content").selectAll("text").transition().delay(this.delay).duration(this.duration/2).attr("fill-opacity",0),l.forEach((function(a,r){t.select(".content").append("text").text(L[r]).attr("x",R[r]).attr("y",D[D.length-1]+2.2*d).attr("font-size",15).attr("text-anchor","middle").attr("transform","translate("+R[r]+","+D+") rotate(-45)").attr("fill-opacity",0).transition().delay(e.delay+e.duration/2).duration(e.duration/2).attr("fill-opacity",1)})),u.forEach((function(a,r){t.select(".content").append("text").text(w[r]).attr("x",R[0]-2*d).attr("y",D[r]).attr("font-size",15).attr("text-anchor","end").attr("transform","translate("+R[r]+","+D+") rotate(-45)").attr("fill-opacity",0).transition().delay(e.delay+e.duration/2).duration(e.duration/2).attr("fill-opacity",1)})),r>200&&(t.select(".content").append("text").text(o).attr("x",a/2).attr("y",(function(){return r<200?D[D.length-1]+2*d+7.5:Math.min(D[D.length-1]+2*d+30+5,r)})).attr("font-size",15).attr("text-anchor","middle").attr("fill-opacity",0).transition().delay(this.delay+this.duration/2).duration(this.duration/2).attr("fill-opacity",1),t.select(".content").append("text").text(s).attr("x",(function(){return r<200?R[0]-2*d-22.5:h<3?R[0]-2*d-75:R[0]-2*d-45-5})).attr("y",(function(){return r<200?r/3:r/2})).attr("font-size",15).attr("text-anchor","middle").attr("transform",(function(){return r<200?"rotate(-90, ".concat(R[0]-2*d-22.5,", ").concat(r/3,")"):h<3?"rotate(-90, ".concat(R[0]-2*d-75,", ").concat(r/2,")"):"rotate(-90, ".concat(R[0]-2*d-45-5,", ").concat(r/2,")")})).attr("fill-opacity",0).transition().delay(this.delay+this.duration/2).duration(this.duration/2).attr("fill-opacity",1))}else if(this.x&&this.size){var j=this.units[0].unitgroup().x,M=this.size.field,G=n.nest().key((function(e){return e[j]})).rollup((function(e){return e.length})).entries(this.processedData());G.sort((function(e,t){return n.ascending(e.key,t.key)}));var U=G.map((function(e){return e.key})),B=G,H=G.length,z=.7*n.min([(.8*r-20)/2/2,(.8*a-20)/(H+1)/2]);r<200&&(z*=.3);var W,X=n.max(G,(function(e){return e.value}));W=H>10?Math.sqrt(X)/4:H>4?Math.sqrt(X)/3:Math.sqrt(X)/2;var q,Y=r<=200?1:1.8,K=z/Math.sqrt(W)*Y;q=B.length%2===0?2.5*z*H:2.5*z*(H+1),q=n.min([q,.9*a]);var Z,J=G.map((function(e,t){if(1===H)return 2===G.length?0===t?K:3.1*z+K:(a-K)/2;if(H<3){var i=2;return r<200&&(i=-2),console.log(i),(a-(q-i*z))/2+(q-i*z)/(H-1)*Math.floor(t%H)}return(a-((q=q<a?a:q)-3.3*z))/2+(q-3.3*z)/(H-1)*Math.floor(t%H)}));Z=r<=200?G.map((function(e,t){return 70})):G.map((function(e,t){return((r-3.6*z-5*K)/0<=3*z?1.8*z:(r-3*z*0-5*K)/1.4)+n.min([(r-3.6*z)/0,3*z])*Math.floor(t/H)}));var Q=[],$=[];Q=this.units.map((function(e,t){return $[t]=e[M],{id:e.id(),distribution:e[j],category:U.indexOf(e[j]),radius:0,value:e[M]}}));var ee=n.extent(this.units,(function(e){return e[M]})),te=n.scaleLinear().domain([ee[0],ee[1]]).range([K/100,K]);for(var ae in Q)Q[ae].radius=Math.sqrt(te(Q[ae].value));n.forceSimulation(Q).force("charge",n.forceManyBody().strength(.01)).force("x",n.forceX().x((function(e){return J[e.category]}))).force("y",n.forceY().y((function(e){return Z[e.category]}))).force("collision",n.forceCollide().strength(1).radius((function(e){return e.radius+.15}))).stop().tick(200);var re=function(t){var a=Q.find((function(e){return e.id==t}));a?(e.units[a.id].x(a.x),e.units[a.id].y(a.y),e.units[a.id].visible("1"),e.units[t].radius(a.radius),e.units[a.id].color(a.color),e.units[a.id].unitgroup("size",M)):e.units[t].visible("0"),e.units[t].opacity("1")};for(var ie in this.units)re(ie);t.select(".content").selectAll("text").transition().delay(this.delay).duration(this.duration/2).attr("fill-opacity",0),G.forEach((function(r,i){t.select(".content").append("text").text(U[i]).attr("x",J[i]).attr("y",Z[0]+2*K+1*z).attr("y",a<=200?Z[0]+20:Z[0]+2*K+1*z).attr("font-size",14).attr("text-anchor","middle").attr("transform","translate("+J[i]+","+Z+") rotate(-45)").attr("fill-opacity",0).transition().delay(e.delay+e.duration/2).duration(e.duration/2).attr("fill-opacity",1)})),r>200&&t.select(".content").append("text").text(j).attr("x",a/2).attr("y",a<=200?Z[0]+30:Math.min(Z[0]+2*K+2*z,r)).attr("font-size",14).attr("text-anchor","middle").attr("fill-opacity",0).transition().delay(this.delay+this.duration/2).duration(this.duration/2).attr("fill-opacity",1)}else{var ne=this.units.filter((function(e){return"1"===e.visible()})),oe=this.size.field,se={xcenter:a/2,ycenter:r/2},ce=[],le=[];ce=ne.map((function(e,t){return le[t]=e[oe],{id:e.id(),radius:e.radius(),value:e[oe]}}));var ue=n.extent(ne,(function(e){return e[oe]})),de=n.scaleLinear().domain([ue[0],ue[1]]).range(ne.length>800?[r/500*r/800,r/50*r/80]:[r/500*r/500,r/50*r/50]);for(var fe in ce)ce[fe].radius=Math.sqrt(de(ce[fe].value));n.forceSimulation(ce).force("charge",n.forceManyBody().strength(1)).force("center",n.forceCenter(se.xcenter,se.ycenter)).force("collide",n.forceCollide().radius((function(e,t){return e.radius+.5})).iterations(2)).tick(le.length>800?100:200);var pe=function(e){var t=ce.find((function(t){return t.id==e}));t?(ne[t.id].x(t.x),ne[t.id].y(t.y),ne[t.id].visible("1"),ne[t.id].radius(t.radius),ne[t.id].unitgroup("size",oe)):ne[e].visible("0"),ne[e].opacity("1")};for(var he in ne)pe(he)}}},{key:"encodeShape",value:function(){}},{key:"addEncoding",value:function(e,t,a){if(!this[e]){this[e]=t,this.delay=a.delay,this.duration=a.duration;var r=!1,i=!1,n=!1;switch(e){case"x":this.encodeX(),n=!0;break;case"y":this.encodeY(),n=!0;break;case"size":this.encodeSize(),n=!0,r=!0;break;case"color":this.encodeColor(),i=!0;break;default:console.log("no channel select")}i&&this.svg().select(".content").selectAll("circle").transition("change color").delay(this.delay).duration(this.duration).attr("fill",(function(e){return e.color()})),r&&this.svg().select(".content").selectAll("circle").transition("change size").delay(this.delay).duration(this.duration).attr("r",(function(e){return e.radius()})),n&&this.svg().select(".content").selectAll("circle").transition("change layout").delay(this.delay).duration(this.duration).attr("cx",(function(e){return e.x()})).attr("cy",(function(e){return e.y()})).attr("r",(function(e){return e.radius()}))}}},{key:"modifyEncoding",value:function(e,t,a){if(this[e]){this[e]=t,this.delay=a.delay,this.duration=a.duration;var r=!1,i=!1,n=!1;switch(e){case"x":this.encodeX(),n=!0;break;case"y":this.encodeY(),n=!0;break;case"size":this.encodeSize(),n=!0,r=!0;break;case"color":this.encodeColor(),i=!0;break;default:console.log("no channel select")}i&&this.svg().select(".content").selectAll("circle").transition("change color").delay(this.delay).duration(this.duration).attr("fill",(function(e){return e.color()})),r&&this.svg().select(".content").selectAll("circle").transition("change size").delay(this.delay).duration(this.duration).attr("r",(function(e){return e.radius()})),n&&this.svg().select(".content").selectAll("circle").transition("change layout").delay(this.delay).duration(this.duration).attr("cx",(function(e){return e.x()})).attr("cy",(function(e){return e.y()})).attr("r",(function(e){return e.radius()}))}}},{key:"removeEncoding",value:function(e,t){this[e]=null,this.delay=t.delay,this.duration=t.duration;var a=!1,r=!1,i=!1;this.x&&(this.encodeX(),i=!0),this.y&&(this.encodeY(),i=!0),this.size&&(this.encodeSize(),a=!0),this.color&&(this.encodeColor(),r=!0),r&&this.svg().select(".content").selectAll("circle").transition("change color").delay(this.delay).duration(this.duration).attr("fill",(function(e){return e.color()})),a&&this.svg().select(".content").selectAll("circle").transition("change size").delay(this.delay).duration(this.duration).attr("r",(function(e){return e.radius()})),i&&this.svg().select(".content").selectAll("circle").transition("change layout").delay(this.delay).duration(this.duration).attr("cx",(function(e){return e.x()})).attr("cy",(function(e){return e.y()})).attr("r",(function(e){return e.radius()}))}},{key:"addAggregation",value:function(e,t,a){var r=this,i=this.svg(),o=this.width(),s=this.height();this.delay=a.delay,this.duration=a.duration;var c,l,u,d=this.size.field,f=this.units[0].unitgroup().x,p=this.units[0].unitgroup().y;switch(t){case"min":c=n.nest().key((function(e){return e[f]})).rollup((function(e){return n.min(e,(function(e){return e[d]}))})).entries(this.units.filter((function(e){return"1"===e.opacity()}))),l=a.aggregated_point?this.units.filter((function(e){return e[a.aggregated_point.field]===a.aggregated_point.value})):this.units.filter((function(e){return"1"===e.opacity()&&e[d]===Math.min.apply(Math,r.units.map((function(e){return e[d]})))}));break;case"max":c=n.nest().key((function(e){return e[f]})).rollup((function(e){return n.max(e,(function(e){return e[d]}))})).entries(this.units.filter((function(e){return"1"===e.opacity()}))),l=a.aggregated_point?this.units.filter((function(e){return e[a.aggregated_point.field]===a.aggregated_point.value})):this.units.filter((function(e){return"1"===e.opacity()&&e[d]===Math.max.apply(Math,r.units.map((function(e){return e[d]})))}));break;case"average":f&&p?u=n.nest().key((function(e){return e[f]})).key((function(e){return e[p]})).rollup((function(e){return n.mean(e,(function(e){return e[d]}))})).object(this.units.filter((function(e){return"1"===e.opacity()}))):c=n.nest().key((function(e){return e[f]})).rollup((function(e){return n.mean(e,(function(e){return e[d]}))})).entries(this.units.filter((function(e){return"1"===e.opacity()})));break;case"sum":f&&p?u=n.nest().key((function(e){return e[f]})).key((function(e){return e[p]})).rollup((function(e){return n.sum(e,(function(e){return e[d]}))})).object(this.units.filter((function(e){return"1"===e.opacity()}))):c=n.nest().key((function(e){return e[f]})).rollup((function(e){return n.sum(e,(function(e){return e[d]}))})).entries(this.units.filter((function(e){return"1"===e.opacity()})));break;default:console.log("no channel select")}if(this.x&&this.y&&this.size){var h=function(e,t,a){var r=document.createElement("span"),i={};return i.width=r.offsetWidth,i.height=r.offsetHeight,r.style.visibility="hidden",r.style.fontSize=e,r.style.fontFamily=t,r.style.display="inline-block",document.body.appendChild(r),"undefined"!=typeof r.textContent?r.textContent=a:r.innerText=a,i.width=parseFloat(window.getComputedStyle(r).width)-i.width,i.height=parseFloat(window.getComputedStyle(r).height)-i.height,i},g=this.units[0].unitgroup().y,y=n.nest().key((function(e){return e[f]})).key((function(e){return e[g]})).rollup((function(e){return e.length})).entries(this.units.filter((function(e){return"1"===e.opacity()}))),m=n.nest().key((function(e){return e[g]})).rollup((function(e){return e.length})).entries(this.units.filter((function(e){return"1"===e.opacity()})));y.sort((function(e,t){return n.ascending(e.key,t.key)})),m.sort((function(e,t){return n.descending(e.key,t.key)}));var E=y.length,v=m.length,b=E,T=v,A=.7*n.min([.8*s/(T+1)/2,.8*o/(b+1)/2]);y.sort((function(e,t){return n.ascending(e.key,t.key)})),y.forEach((function(e){e.values.sort((function(e,t){return n.descending(e.key,t.key)}))}));for(var _,O,C=0,I=0;I<E;I++){var R=n.max(y[I].values,(function(e){return e.value}));C=Math.max(C,R)}b>4?(_=Math.sqrt(C)/3,O=1.5):o<=200?(_=Math.sqrt(C)/5,O=1):(_=Math.sqrt(C)/2,O=1.8);var x,k=A/Math.sqrt(_)*O;x=2.1*A*b;var L=m.map((function(e){return h(15,"Arial",e.key).width})),w=n.max(L),P=2*A+30+h(15,"Arial",g).height+w;x=n.min([x,.8*o]);var N,S=y.map((function(e,t){if(1===b)return 2===y.length?0===t?k:3.1*A+k:(o-k)/2;if(b<3){return(o-(x-1*A))/2+(x-1*A)/(b-1)*Math.floor(t%b)}if(.9*o-x-2*P>0){var a=(1*o-(.9*o-2*P)-2*P)/2+P,r=b<=6?.5*a:n.min([2*A,.5*a+A]);return a+(.9*o-a-r)/(b-1)*Math.floor(t%b)}if(.9*o-x-2*P<=0){var i=1*P,s=b<=6?.5*i:n.min([2*A,.5*i+A]);return i+(.9*o-i-s)/(b-1)*Math.floor(t%b)}}));N=T%2===0?2*A*T:2*A*(T+1);var F=m.map((function(e,t){return T>3||T<3?(N=n.min([N,.8*s]),(.6*s-N)/2+2*A+n.min([(s-6*A)/(T-1),4*A])*t):((s-3.6*A)/(T-1)<=3*A?3*A:(s-3*A*(T-1))/1.4)+n.min([(s-3.6*A)/(T-1),3*A])*t})),V=[],j=[],M=y.map((function(e){return e.key})),G=m.map((function(e){return e.key}));V=this.units.map((function(e,t){return j[t]=e[d],{id:e.id(),distribution:e[f],category:[M.indexOf(e[f]),G.indexOf(e[g])],radius:0,value:u[e[f]][e[g]],color:D().CATEGORICAL[G.indexOf(e[g])%8]}}));var U=n.scaleLinear().range([F[F.length-1]+1.8*A,s<200?10:80]).domain([0,1.1*n.max(V,(function(e){return e.value}))]).nice(),B=n.axisLeft(U).ticks(5).tickPadding(5).tickFormat((function(e){return e/1e6>=1?e=e/1e6+"M":e/1e3>=1&&(e=e/1e3+"K"),e})),H=n.extent(this.units,(function(e){return e[d]})),z=n.scaleLinear().domain([H[0],H[1]]).range([k/100,k]);for(var W in V)V[W].radius=Math.sqrt(z(V[W].value));n.forceSimulation(V).force("charge",n.forceManyBody().strength(.01)).force("x",n.forceX().x((function(e){return S[e.category[0]]}))).force("y",n.forceY().y((function(e){return F[e.category[1]]}))).force("collision",n.forceCollide().strength(1).radius((function(e){return e.radius+.3}))).stop().tick(200);var X=function(e){var t=V.find((function(t){return t.id==e}));t?(l?(r.units[t.id].x(l[0].x()),r.units[t.id].y(l[0].y()),r.units[e].radius(l[0].radius())):(r.units[t.id].x(S[t.category[0]]),r.units[t.id].y(U(t.value)),r.units[e].radius(2*t.radius)),r.units[t.id].visible("1"),r.units[t.id].color(t.color),r.units[t.id].unitgroup("size",d)):r.units[e].visible("0"),r.units[e].opacity("1")};for(var q in this.units)X(q);i.select(".content").selectAll("text").transition().delay(this.delay).duration(this.duration/2).attr("fill-opacity",0),i.select(".content").append("g").attr("class","axis_y").attr("transform","translate(".concat(S[0]-1.2*A,", ",0,")")).transition().delay(this.delay+this.duration/2).call(B),y.forEach((function(e,t){i.select(".content").append("text").text(M[t]).attr("x",S[t]).attr("y",F[F.length-1]+2*A).attr("font-size",15).attr("text-anchor","middle").attr("transform","translate("+S[t]+","+F+") rotate(-45)").attr("fill-opacity",0).transition().delay(r.delay+r.duration/2).duration(r.duration/2).attr("fill-opacity",1)}));var Y=s<200?4:15;m.forEach((function(e,t){i.select(".content").append("text").text(G[t]).attr("x",S[S.length-1]+1.5*A).attr("y",n.min(r.units,(function(e){return e.y()}))-Y*(t+.6)).attr("font-size",15).attr("text-anchor","start").attr("fill-opacity",0).transition().delay(r.delay+r.duration/2).duration(r.duration/2).attr("fill-opacity",1),i.select(".content").append("rect").attr("x",S[S.length-1]+1.5*A-Y).attr("y",n.min(r.units,(function(e){return e.y()}))-Y*(t+1.5)).attr("height",Y).attr("width",Y).style("fill",D().CATEGORICAL[t%8]).attr("fill-opacity",0).transition().delay(r.delay+r.duration/2).duration(r.duration/2).attr("fill-opacity",1)})),s>200&&(i.select(".content").append("text").text(f).attr("x",o/2).attr("y",(function(){return s<200?F[F.length-1]+2*A+7.5:Math.min(F[F.length-1]+2*A+30+5,s)})).attr("font-size",15).attr("text-anchor","middle").attr("fill-opacity",0).transition().delay(this.delay+this.duration/2).duration(this.duration/2).attr("fill-opacity",1),i.select(".content").append("text").text(d+" (".concat(t,") ")).attr("x",(function(){return s<200?S[0]-2*A-22.5:b<3?S[0]-1.5*A-22.5:S[0]-2*A-45-5})).attr("y",(function(){return s<200?s/3:s/2})).attr("font-size",15).attr("text-anchor","middle").attr("transform",(function(){return s<200?"rotate(-90, ".concat(S[0]-2*A-22.5,", ").concat(s/3,")"):b<3?"rotate(-90, ".concat(S[0]-1.5*A-22.5,", ").concat(s/2,")"):"rotate(-90, ".concat(S[0]-2*A-45-5,", ").concat(s/2,")")})).attr("fill-opacity",0).transition().delay(this.delay+this.duration/2).duration(this.duration/2).attr("fill-opacity",1))}else if(this.x&&this.size){var K=15;s<200&&(K=14);var Z=n.nest().key((function(e){return e[f]})).rollup((function(e){return e.length})).entries(this.processedData());Z.sort((function(e,t){return n.ascending(e.key,t.key)}));var J,Q=Z.map((function(e){return e.key})),$=Z,ee=Z.length,te=.7*n.min([.8*s/2/2,.8*o/(ee+1)/2]),ae=n.max(Z,(function(e){return e.value}));J=ee>4?Math.sqrt(ae)/3:Math.sqrt(ae)/2;var re,ie=o<=200?1:1.8,ne=te/Math.sqrt(J)*ie;re=$.length%2===0?2.5*te*ee:2.5*te*(ee+1),re=n.min([re,.9*o]);var oe,se=Z.map((function(e,t){if(1===ee)return 2===Z.length?0===t?ne:3.1*te+ne:(o-ne)/2;if(ee<3){return(o-(re-2*te))/2+(re-2*te)/(ee-1)*Math.floor(t%ee)}return(o-((re=re<o?o:re)-3.3*te))/2+(re-3.3*te)/(ee-1)*Math.floor(t%ee)}));oe=o<=200?Z.map((function(e,t){return 70})):Z.map((function(e,t){return 1.1*((s-3.6*te-5*ne)/0<=3*te?1.8*te:(s-3*te*0-5*ne)/1.4)+n.min([(s-3.6*te)/0,3*te])*Math.floor(t/ee)})),console.log("centernodey",oe);var ce=[],le=[],ue=c.map((function(e){return e.value}));ce=this.units.map((function(e,t){return le[t]=e[d],{id:e.id(),distribution:e[f],category:Q.indexOf(e[f]),radius:0,value:ue[c.map((function(e){return e.key})).indexOf(e[f])]}}));var de=n.extent(this.units,(function(e){return e[d]})),fe=n.scaleLinear().domain([de[0],de[1]]).range([ne/100,ne]);for(var pe in ce)ce[pe].radius=Math.sqrt(fe(ce[pe].value));var he=n.scaleLinear().range([oe[0]+2*ne+.8*te,30]).domain([0,1.1*n.max(ue)]).nice(),ge=n.axisLeft(he).ticks(5).tickPadding(5).tickFormat((function(e){return e/1e6>=1?e=e/1e6+"M":e/1e3>=1&&(e=e/1e3+"K"),e}));n.forceSimulation(ce).force("charge",n.forceManyBody().strength(.01)).force("x",n.forceX().x((function(e){return se[e.category]}))).force("y",n.forceY().y((function(e){return oe[e.category]}))).force("collision",n.forceCollide().strength(1).radius((function(e){return e.radius+.15}))).stop().tick(200);var ye=function(e){var t=ce.find((function(t){return t.id==e}));t?l?(r.units[t.id].x(l[0].x()),r.units[t.id].y(l[0].y()),r.units[e].radius(l[0].radius())):(r.units[t.id].x(se[t.category]),r.units[t.id].y(he(t.value)),r.units[t.id].visible("1"),r.units[e].radius(2*t.radius),r.units[t.id].color(t.color),r.units[t.id].unitgroup("size",d)):r.units[e].visible("0"),r.units[e].opacity("1")};for(var me in this.units)ye(me);i.select(".content").selectAll("text").transition().delay(this.delay).duration(this.duration/2).attr("fill-opacity",0),i.select(".content").append("g").attr("class","axis_y").attr("transform","translate(".concat(se[0]-1.2*te,", ").concat(oe[0]-he(n.min(this.units,(function(e){return e.y()}))),")")).transition().delay(this.delay+this.duration/2).call(ge),Z.forEach((function(e,t){i.select(".content").append("text").text(Q[t]).attr("x",se[t]).attr("y",Math.min(oe[0]+2*ne+1.5*te,.8*s)).attr("font-size",K).attr("text-anchor","middle").attr("fill-opacity",0).transition().delay(r.delay+r.duration/2).duration(r.duration/2).attr("fill-opacity",1)})),s>200&&(i.select(".content").append("text").text(f).attr("x",o/2).attr("y",Math.min(oe[0]+2*ne+3*te,.9*s)).attr("font-size",K).attr("text-anchor","middle").attr("fill-opacity",0).transition().delay(this.delay+this.duration/2).duration(this.duration/2).attr("fill-opacity",1),i.select(".content").append("text").text(d+" (".concat(t,") ")).attr("x",(function(){return s<200?se[0]-2*te-1.5*K:ee<3?se[0]-1.5*te-1.5*K:se[0]-2*te-3*K-5})).attr("y",(function(){return s/3})).attr("font-size",K).attr("text-anchor","middle").attr("transform",(function(){return s<200?"rotate(-90, ".concat(se[0]-2*te-1.5*K,", ").concat(s/3,")"):ee<3?"rotate(-90, ".concat(se[0]-1.5*te-1.5*K,", ").concat(s/3,")"):"rotate(-90, ".concat(se[0]-2*te-3*K-5,", ").concat(s/3,")")})).attr("fill-opacity",0).transition().delay(this.delay+this.duration/2).duration(this.duration/2).attr("fill-opacity",1))}this.svg().select(".content").selectAll("circle").transition("change layout").delay(this.delay).duration(this.duration).attr("cx",(function(e){return e.x()})).attr("cy",(function(e){return e.y()})).attr("r",(function(e){return e.radius()})).attr("fill",(function(e){return e.color()}))}}]),a}(R),S=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e))._mark=e.mark,i}return Object(i.a)(a,[{key:"operate",value:function(e){e._mark=this._mark;var t=e.factdata(),a=e.fact();e.chart(this._mark2chart(this._mark));var r=e.chart();r.height(e._height),r.width(e._width),r.data(e._data),r.factdata(t),r.processedData(e._processedData),r.subspace(a.subspace),r.measure(a.measure),r.breakdown(a.breakdown),r.focus(a.focus),r.container(e._container),r.visualize()}},{key:"_mark2chart",value:function(e){switch(e){case y.POINT:return new L;case y.BAR:return new x;case y.LINE:return new k;case y.UNIT:return new N;default:return new L}}}]),a}(O),F="arrow",V="coloredarea",j="circle",M="contour",G="desaturate",U="distribution",B="fade",H="fill",z="glow",W="hide",X="label",q="reference",Y="regression",K="separate",Z="show",J="symbol",Q="texture",$="tip",ee="tooltip",te=function(){function e(){Object(r.a)(this,e)}return Object(i.a)(e,[{key:"annotate",value:function(e,t,a){}}]),e}(),ae=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"annotate",value:function(e,t,a){var r=e.svg(),i=r.selectAll(".mark").filter((function(e){if(0===t.length)return!0;var a,r=Object(s.a)(t);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(e[i.field]===i.value)return!0}}catch(n){r.e(n)}finally{r.f()}return!1}));if(!i.empty()){var o=[[0,0],[20,5],[15,10],[25,20],[20,25],[10,15],[5,20],[0,0]];setTimeout((function(){i.nodes().forEach((function(e){var t,i,s,c=e.nodeName;if("circle"===c)t=parseFloat(e.getAttribute("cx")),i=parseFloat(e.getAttribute("cy")),s=parseFloat(e.getAttribute("r"))/1.414;else{if("rect"!==c)return;s=parseFloat(e.getAttribute("width"))/2,t=parseFloat(e.getAttribute("x"))+s,i=parseFloat(e.getAttribute("y"))}var l=o.map((function(e){return[t+s+e[0],i+s+e[1]]}));r.append("path").attr("class","arrow").transition().duration(a.duration).attr("d",n.line()(l)).attr("fill",(function(){return"color"in a?a.color:D().ANNOTATION}))}))}),a.delay)}}}]),a}(te),re=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"annotate",value:function(e,t,a){var r=e.svg();n.selection.prototype.moveToFront=function(){return this.each((function(){this.parentNode.appendChild(this)}))};var i=r.selectAll(".mark").filter((function(e){if(0===t.length)return!0;var a,r=Object(s.a)(t);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(e[i.field]===i.value)return!0}}catch(n){r.e(n)}finally{r.f()}return!1}));setTimeout((function(){i.nodes().forEach((function(e){if("circle"===e.nodeName){var t=Number(e.getAttribute("r"))+10,a=e.getAttribute("cx"),i=e.getAttribute("cy");r.select(".content").select(".circleGroup").append("circle").attr("fill",D().ANNOTATION).attr("opacity",.3).attr("stroke-width",0).attr("x",a).attr("y",i).attr("transform","translate("+a+","+i+")").attr("r",t),r.select(".lineGroup").moveToFront()}else if("rect"===e.nodeName){var n=Number(e.getAttribute("x"))-10,o=Number(e.getAttribute("y"))-10,s=Number(e.getAttribute("width"))+20,c=Number(e.getAttribute("height"))+10;r.select(".content").select("g").append("rect").attr("fill",D().ANNOTATION).attr("opacity",.3).attr("stroke-width",0).attr("x",n).attr("y",o).attr("width",s).attr("height",c)}}))}),a.delay)}}]),a}(te),ie=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"annotate",value:function(e,t,a){var r=e.svg(),i=r.selectAll(".mark").filter((function(e){if(0===t.length)return!0;var a,r=Object(s.a)(t);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(e[i.field]===i.value)return!0}}catch(n){r.e(n)}finally{r.f()}return!1}));setTimeout((function(){i.nodes().forEach((function(e){if("circle"===e.nodeName){var t=Number(e.getAttribute("r"))+5,i=e.getAttribute("cx"),n=e.getAttribute("cy");r.append("circle").attr("fill","none").attr("stroke",(function(e){return"color"in a?a.color:D().ANNOTATION})).attr("stroke-width",2).attr("x",i).attr("y",n).attr("transform","translate("+i+","+n+")").attr("r",t)}else if("rect"===e.nodeName){var o=e.getAttribute("y"),s=e.getAttribute("width"),c=Number(e.getAttribute("x"))+s/2,l=s/2+5;r.append("circle").attr("fill","none").attr("stroke",(function(e){return"color"in a?a.color:D().ANNOTATION})).attr("stroke-width",2).attr("x",c).attr("y",o).attr("transform","translate("+c+","+o+")").attr("r",l)}}))}),a.delay)}}]),a}(te),ne=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"annotate",value:function(e,t,a){var r=e.svg();n.selection.prototype.moveToFront=function(){return this.each((function(){this.parentNode.appendChild(this)}))},r.selectAll(".mark").filter((function(e){if(0===t.length)return!0;var a,r=Object(s.a)(t);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(e[i.field]===i.value)return!0}}catch(n){r.e(n)}finally{r.f()}return!1})).transition().delay(a.delay).duration(a.duration).attr("stroke-width",(function(){return 0===a.delay?.5:2})).attr("stroke-alignment","outer").attr("opacity",1).attr("stroke",(function(){return"color"in a?a.color:D().ANNOTATION}))}}]),a}(te),oe=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"annotate",value:function(e,t,a){var r=e.svg();n.selection.prototype.moveToFront=function(){return this.each((function(){this.parentNode.appendChild(this)}))},r.selectAll(".mark").filter((function(e){if(0===t.length)return!0;var a,r=Object(s.a)(t);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(e[i.field]===i.value)return!0}}catch(n){r.e(n)}finally{r.f()}return!1})).transition().delay(a.delay).duration(a.duration).attr("fill",(function(e){return"color"in a?a.color:D().ANNOTATION})).attr("opacity",1)}}]),a}(te),se=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"annotate",value:function(e,t,a){e.svg().selectAll(".mark").filter((function(e){if(0===t.length)return!0;var a,r=Object(s.a)(t);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(e[i.field]===i.value)return!0}}catch(n){r.e(n)}finally{r.f()}return!1})).transition().delay(a.delay).duration(a.duration).attr("fill","lightgray").attr("opacity",1)}}]),a}(te),ce=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"annotate",value:function(e,t,a){var r=e.svg(),i=r.selectAll(".mark").filter((function(e){if(0===t.length)return!0;var a,r=Object(s.a)(t);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(e[i.field]===i.value)return!0}}catch(n){r.e(n)}finally{r.f()}return!1})).attr("opacity",.3);if(!i.empty()){var o=[];i.nodes().forEach((function(e){var t,a,r=e.nodeName;"circle"===r?(t=parseFloat(e.getAttribute("cx")),a=parseFloat(e.getAttribute("cy"))):"rect"===r&&(t=parseFloat(e.getAttribute("x"))+parseFloat(e.getAttribute("width"))/2,a=parseFloat(e.getAttribute("y"))),isNaN(t)||isNaN(a)||o.push([t,a])}));var c=n.line().x((function(e){return e[0]})).y((function(e){return e[1]})).curve(n.curveCatmullRom);r.append("path").attr("class","regression").attr("d",c(o)).attr("stroke",(function(){return"color"in a?a.color:D().ANNOTATION})).attr("stroke-width",3).attr("fill","none")}}}]),a}(te),le=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"annotate",value:function(e,t,a){e.svg().selectAll(".mark").filter((function(e){if(0===t.length)return!0;var a,r=Object(s.a)(t);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(e[i.field]===i.value)return!0}}catch(n){r.e(n)}finally{r.f()}return!1})).transition().delay(a.delay).duration(a.duration).attr("opacity",.3)}}]),a}(te),ue=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"annotate",value:function(e,t,a){var r=e.svg(),i=r.append("defs").append("filter").attr("id","drop-shadow").attr("height","150%");i.append("feGaussianBlur").attr("in","StrokePaint").attr("stdDeviation",2).attr("result","blur"),i.append("feOffset").attr("in","blur").attr("dx",0).attr("dy",0).attr("result","offsetBlur");var n=i.append("feMerge");n.append("feMergeNode").attr("in","offsetBlur"),n.append("feMergeNode").attr("in","SourceGraphic"),n.append("feMergeNode").attr("in","FillPaint"),r.selectAll(".mark").filter((function(e){if(0===t.length)return!0;var a,r=Object(s.a)(t);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(e[i.field]===i.value)return!0}}catch(n){r.e(n)}finally{r.f()}return!1})).transition().delay(a.delay).duration(a.duration).style("stroke",(function(){return"color"in a?a.color:D().ANNOTATION})).style("stroke-width",2).style("filter","url(#drop-shadow)").attr("opacity",1)}}]),a}(te),de=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"annotate",value:function(e,t,a){var r=e.svg();n.selection.prototype.moveToFront=function(){return this.each((function(){this.parentNode.appendChild(this)}))},r.selectAll(".mark").filter((function(e){if(0===t.length)return!0;var a,r=Object(s.a)(t);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(e[i.field]===i.value)return!0}}catch(n){r.e(n)}finally{r.f()}return!1})).transition().delay(a.delay).duration(a.duration).attr("opacity",0)}}]),a}(te),fe=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"annotate",value:function(e,t,a){var r=e.svg(),i=e.y,n=r.selectAll(".mark").filter((function(e){if(0===t.length)return!0;var a,r=Object(s.a)(t);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(e[i.field]===i.value)return!0}}catch(n){r.e(n)}finally{r.f()}return!1}));if(0!==n.length){var o,c=Object(s.a)(n.nodes());try{var l=function(){var t=o.value,n=void 0;if("text"in a)n=a.text;else if("field"in a)n=t.__data__[a.field];else if(e instanceof L)n=t.__data__[i];else{var s=parseFloat(t.__data__[i]);n=s/1e6>=1?s/1e6+"M":s/1e3>=1?s/1e3+"K":s+""}var c=void 0,l=void 0,u=void 0,d=void 0,f=t.nodeName;setTimeout((function(){if("circle"===f)c=parseFloat(t.getAttribute("cx")),l=parseFloat(t.getAttribute("cy")),u=parseFloat(t.getAttribute("r")),d=-u-10;else{if("rect"!==f)return;var e=t.getBBox();c=e.x+e.width/2,l=e.y,d=-10}r.append("text").attr("class","text").attr("x",c).attr("y",l+d).text(n).attr("font-size",(function(){return"font-size"in a?a["font-size"]:12})).attr("fill",(function(){return"color"in a?a.color:D().TEXT})).attr("text-anchor","middle").attr("alignment-baseline","Alphabetic").attr("fill-opacity",0).transition().duration(a.duration).attr("fill-opacity",1)}),a.delay)};for(c.s();!(o=c.n()).done;)l()}catch(u){c.e(u)}finally{c.f()}}}}]),a}(te),pe=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"annotate",value:function(e,t,a){var r=e.svg(),i=r.selectAll(".mark").filter((function(e){if(0===t.length)return!0;var a,r=Object(s.a)(t);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(e[i.field]===i.value)return!0}}catch(n){r.e(n)}finally{r.f()}return!1}));if(!i.empty()){var n=[];i.nodes().forEach((function(e){var t,a,r=e.nodeName;"circle"===r?(t=parseFloat(e.getAttribute("cx")),a=parseFloat(e.getAttribute("cy"))):"rect"===r&&(t=parseFloat(e.getAttribute("x"))+parseFloat(e.getAttribute("width"))/2,a=parseFloat(e.getAttribute("y"))),t&&a&&n.push([t,a])}));var o,c,l,u,d=r.selectAll(".axis_x").select(".domain").node().getBBox(),f=d.x,p=f+d.width;if(1===n.length)u=l=n[0][1],o=f,c=p;else u=l=this.getAverageValue(n),o=f,c=p;r.append("line").attr("class","value").attr("x1",o).attr("x2",c).attr("y1",l).attr("y2",u).attr("stroke",(function(){return"color"in a?a.color:D().ANNOTATION})).attr("stroke-width",2).attr("stroke-dasharray","8, 4")}}},{key:"getAverageValue",value:function(e){for(var t=0,a=e.length,r=0;r<a;++r)t+=e[r][1];return t/a}}]),a}(te),he=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"annotate",value:function(e,t,a){var r=e.svg(),i=r.selectAll(".mark").filter((function(e){if(0===t.length)return!0;var a,r=Object(s.a)(t);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(e[i.field]===i.value)return!0}}catch(n){r.e(n)}finally{r.f()}return!1}));if(!i.empty()){var n=[];i.nodes().forEach((function(e){var t,a,r=e.nodeName;"circle"===r?(t=parseFloat(e.getAttribute("cx")),a=parseFloat(e.getAttribute("cy"))):"rect"===r&&(t=parseFloat(e.getAttribute("x"))+parseFloat(e.getAttribute("width"))/2,a=parseFloat(e.getAttribute("y"))),t&&a&&n.push([t,a])}));var o,c,l,u,d=r.selectAll(".axis_x").select(".domain").node().getBBox(),f=d.x,p=f+d.width,h=r.selectAll(".axis_y").select(".domain").node().getBBox(),g=h.y,y=g+h.height;if(1===n.length)u=l=n[0][1],o=f,c=p;else{var m=this.getLeastSquares(n),E=(y-g-m.b)/m.m,v=(0-m.b)/m.m;if(E>v){var b=[v,E];E=b[0],v=b[1]}o=(o=f)<E?E:o,c=(c=p)>v?v:c,0===m.m&&(o=0),l=m.m*o+m.b,u=m.m*c+m.b,m.m===-1/0&&(o=c,l=g,u=y)}r.append("line").attr("class","regression").attr("x1",o).attr("x2",c).attr("y1",l).attr("y2",u).attr("stroke",(function(){return"color"in a?a.color:D().ANNOTATION})).attr("stroke-width",2).attr("stroke-dasharray","8, 4")}}},{key:"getLeastSquares",value:function(e){for(var t={},a=0,r=0,i=0,n=0,o=e.length,s=0;s<o;++s)a+=e[s][0],r+=e[s][1],i+=e[s][0]*e[s][1],n+=e[s][0]*e[s][0];return t.m=(i-a*r/o)/(n-a*a/o),t.b=r/o-t.m*a/o,t}}]),a}(te),ge=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"annotate",value:function(e,t,a){e.svg().selectAll(".mark").filter((function(e){if(0===t.length)return!0;var a,r=Object(s.a)(t);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(e[i.field]===i.value)return!0}}catch(n){r.e(n)}finally{r.f()}return!1}))}}]),a}(te),ye=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"annotate",value:function(e,t,a){var r=e.svg();n.selection.prototype.moveToFront=function(){return this.each((function(){this.parentNode.appendChild(this)}))},r.selectAll(".mark").filter((function(e){if(0===t.length)return!0;var a,r=Object(s.a)(t);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(e[i.field]===i.value)return!0}}catch(n){r.e(n)}finally{r.f()}return!1})).attr("opacity",1)}}]),a}(te),me=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"annotate",value:function(e,t,a){var r=e.svg(),i=r.selectAll(".mark").filter((function(e){if(0===t.length)return!0;var a,r=Object(s.a)(t);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(e[i.field]===i.value)return!0}}catch(n){r.e(n)}finally{r.f()}return!1}));if(0!==i.length){var n,o=Object(s.a)(i.nodes());try{for(o.s();!(n=o.n()).done;){var c=n.value,l=void 0,u=void 0,d=void 0,f=c.nodeName;if("circle"===f)l=parseFloat(c.getAttribute("cx")),u=parseFloat(c.getAttribute("cy")),d=-parseFloat(c.getAttribute("r"))-20;else{if("rect"!==f)return;var p=c.getBBox();l=p.x+p.width/2,u=p.y,d=10}r.append("image").attr("class","icon-img").attr("x",l-10).attr("y",u+d).attr("width",20).attr("height",20).attr("xlink:href",(function(){return"icon-url"in a?a["icon-url"]:void 0}))}}catch(h){o.e(h)}finally{o.f()}}}}]),a}(te),Ee=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"annotate",value:function(e,t,a){var r=e.svg();n.selection.prototype.moveToFront=function(){return this.each((function(){this.parentNode.appendChild(this)}))};var i=300;r.append("svg:defs").append("svg:pattern").attr("id","texture_background").attr("width",i).attr("height",i).attr("patternUnits","userSpaceOnUse").append("svg:image").attr("xlink:href",a["background-image"]).attr("x",0).attr("y",0),r.selectAll(".mark").filter((function(e){if(0===t.length)return!0;var a,r=Object(s.a)(t);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(e[i.field]===i.value)return!0}}catch(n){r.e(n)}finally{r.f()}return!1})).transition().delay(a.delay).duration(a.duration).style("fill","url(#texture_background)")}}]),a}(te),ve=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"annotate",value:function(e,t,a){}}]),a}(te),be=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"textMultiline",value:function(e,t,a,r,i,n,o){var s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"middle";o&&(a=4);var c=t.split(" ").filter((function(e){return""!==e})),l=e.append("text").attr("font-family","Arial-Regular").attr("font-size",a).text(c[0]),u=e.append("text").attr("transform","translate("+i+","+n+")").attr("font-family","Arial-Regular").attr("font-size",a).attr("text-anchor",s);r=Math.max(l.node().getComputedTextLength(),r),o&&(r*=.5);for(var d=.9*l.node().getBBox().height,f="",p=0,h=5,g=0;g<c.length;g++){var y=f+" "+c[g];p===h-1?l.text(y+"\u2026"):l.text(y);var m=l.node().getComputedTextLength();if(m>r){if(p===h-1){f+="\u2026";break}u.append("tspan").attr("x",0).attr("dy",d).text(f),f=c[g],p++}else f=y}return u.append("tspan").attr("x",0).attr("dy",d).text(f),l.remove(),u}},{key:"annotate",value:function(e,t,a){var r=this,i=e.svg(),o=e.y,c=i.selectAll(".mark").filter((function(e){if(0===t.length)return!0;var a,r=Object(s.a)(t);try{for(r.s();!(a=r.n()).done;){var i=a.value;if(e[i.field]===i.value)return!0}}catch(n){r.e(n)}finally{r.f()}return!1}));if(0!==c.length){var l,u=Object(s.a)(c.nodes());try{var d=function(){var t=l.value,s=void 0;if("text"in a)s=a.text;else if("field"in a)s=t.__data__[a.field];else if(e instanceof L)s=t.__data__[o];else{var c=parseFloat(t.__data__[o]);s=c/1e6>=1?c/1e6+"M":c/1e3>=1?c/1e3+"K":c+""}var u=void 0,d=void 0,f=void 0,p=void 0,h=t.nodeName,g=void 0;g="font-size"in a?a["font-size"]:10,setTimeout((function(){if("circle"===h)u=parseFloat(t.getAttribute("cx")),d=parseFloat(t.getAttribute("cy")),f=parseFloat(t.getAttribute("r")),p=-f-5;else{if("rect"!==h)return;var e=t.getBBox();u=e.x+e.width/2,d=e.y,p=-5}var o,c=i.append("g").attr("class","tooltip"),l=c.append("rect").attr("class","tooltipRect"),y=c.append("text").attr("font-size",g).attr("fill",(function(){return"color"in a?a.color:"#FFFFFF"})).attr("text-anchor","start");"text"in a?(y.remove(),o=0===a.duration,(y=r.textMultiline(c,s,g,110,u,d,o)).attr("transform","translate("+u+",0)").attr("fill","white")):y.append("tspan").text(s).attr("dy",.9*y.selectAll("tspan").node().getBBox().height);var m=y.node().getBBox().width,E=y.node().getBBox().height,v=Math.min(m/.7,m+12),b=E/.8;l.attr("rx",.1*E).attr("ry",.1*E).attr("width",v).attr("height",b).attr("fill",D().TOOLTIP).attr("opacity",1);var T=c.append("path").attr("class","triangle").attr("transform","translate("+u+","+(d+p)+")rotate(180)").attr("d",n.symbol().type(n.symbolTriangle).size(50)).attr("fill",D().TOOLTIP);l.attr("x",u-v/2).attr("y",d+p-b),y.attr("width",m).attr("height",E).attr("x",u-v/2+(v-m)/2).attr("y",d+p-b),T.attr("opacity",1),c.attr("opacity",0).transition().duration(.4*a.duration).attr("opacity",1)}),a.delay)};for(u.s();!(l=u.n()).done;)d()}catch(f){u.e(f)}finally{u.f()}}}}]),a}(te),Te=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e))._method=e.method,i._target="target"in e?e.target:[],"style"in e?(i._style=e.style,i._style.delay||(i._style.delay=0),i._style.duration||(i._style.duration=0)):i._style={delay:0,duration:0},i}return Object(i.a)(a,[{key:"operate",value:function(e){var t=this._type2annotator(this._method),a=e.chart(),r=this._target,i=this._style;t.annotate(a,r,i)}},{key:"_type2annotator",value:function(e){switch(e){case F:return new ae;case V:return new re;case j:return new ie;case M:return new ne;case G:return new se;case U:return new ce;case B:return new le;case H:return new oe;case z:return new ue;case W:return new de;case X:return new fe;case q:return new pe;case Y:return new he;case K:return new ge;case Z:return new ye;case J:return new me;case Q:return new Ee;case $:return new ve;case ee:return new be;default:return new oe}}}]),a}(O),Ae=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).channel=e.channel,i.field=e.field,i.style="style"in e?e.style:{delay:0,duration:0},i}return Object(i.a)(a,[{key:"operate",value:function(e){e.chart().addEncoding(this.channel,this.field,this.style)}}]),a}(O),_e=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).field=e.field,i.operator=e.operator,i.style=e.style,i}return Object(i.a)(a,[{key:"operate",value:function(e){e.chart().addAggregation(this.field,this.operator,this.style)}}]),a}(O),Oe={FADE:"fade"},Ce=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"maketitle",value:function(e,t){var a=e.svg(),r=t.text.split(" ").filter((function(e){return""!==e})),i=a.append("text").attr("font-family","Arial-Regular").attr("font-size",24).attr("fill",(function(){return"color"in t?t.color:D().TEXT})).text(r[0]),n=a.append("text").attr("x","50%").attr("y",-10).attr("dominant-baseline","central").attr("transform","translate(375,0)").attr("font-family","Arial-Regular").attr("font-weight","bold").attr("font-size",20).attr("fill",(function(){return"color"in t?t.color:D().TEXT})).attr("text-anchor","middle"),o=Math.max(i.node().getComputedTextLength(),720),s=.9*i.node().getBBox().height,c="",l=0;if(-1===t.duration){for(var u=0;u<r.length;u++){var d=c+" "+r[u];if(3===l?i.text(d+"\u2026"):i.text(d),i.node().getComputedTextLength()>o){if(3===l){c+="\u2026";break}n.append("tspan").attr("x",0).attr("dy",s).text(c).attr("fill-opacity",0).transition().duration(2e3).attr("fill-opacity",1),c=r[u],l++}else c=d}n.append("tspan").attr("x",0).attr("dy",s).attr("fill-opacity",0).text(c).transition().delay(t.delay).duration(2e3).attr("fill-opacity",1),i.remove()}else{for(var f=0;f<r.length;f++){var p=c+" "+r[f];if(3===l?i.text(p+"\u2026"):i.text(p),i.node().getComputedTextLength()>o){if(3===l){c+="\u2026";break}n.append("tspan").attr("x",0).attr("dy",s).attr("fill-opacity",0).text(c).transition().delay(t.delay).duration(.25*t.duration).attr("fill-opacity",1).transition().delay(.5*t.duration).duration(.25*t.duration).attr("fill-opacity",0).remove(),c=r[f],l++}else c=p}n.append("tspan").attr("x",0).attr("dy",s).attr("fill-opacity",0).text(c).transition().delay(t.delay).duration(.25*t.duration).attr("fill-opacity",1).transition().delay(.5*t.duration).duration(.25*t.duration).attr("fill-opacity",0).remove(),i.remove()}}}]),a}(function(){function e(){Object(r.a)(this,e)}return Object(i.a)(e,[{key:"maketitle",value:function(e,t){}}]),e}()),Ie=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e))._animation=e.style.animation,"style"in e?(i._style=e.style,i._style.delay||(i._style.delay=0),i._style.duration||(i._style.duration=-1)):i._style={delay:0,duration:0},i}return Object(i.a)(a,[{key:"operate",value:function(e){var t=this._type2title(this._animation),a=e.chart(),r=this._style;t.maketitle(a,r)}},{key:"_type2title",value:function(e){switch(e){case Oe.FADE:default:return new Ce}}}]),a}(O),Re=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(){return Object(r.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"makecaption",value:function(e,t){var a=e.svg();setTimeout((function(){var e=t.text.split(" ").filter((function(e){return""!==e})),r=a.append("text").attr("font-family","Arial-Regular").attr("font-size",18).text(e[0]),i=a.append("text").attr("x","50%").attr("y","85%").attr("dominant-baseline","central").attr("transform","translate(375,10)").attr("font-family","Arial-Regular").attr("font-size",14).attr("text-anchor","middle"),n=Math.max(r.node().getComputedTextLength(),800);console.log("~~~~~`",n);var o=.9*r.node().getBBox().height,s="",c=0;if(-1===t.duration){for(var l=0;l<e.length;l++){var u=s+" "+e[l];if(3===c?r.text(u+"\u2026"):r.text(u),r.node().getComputedTextLength()>n){if(3===c){s+="\u2026";break}i.append("tspan").attr("x",0).attr("dy",o).text(s).transition().duration(2e3).attr("fill-opacity",1),s=e[l],c++}else s=u}i.append("tspan").attr("x",0).attr("dy",o).text(s).transition().duration(2e3).attr("fill-opacity",1),r.remove()}else{for(var d=0;d<e.length;d++){var f=s+" "+e[d];if(3===c?r.text(f+"\u2026"):r.text(f),r.node().getComputedTextLength()>n){if(3===c){s+="\u2026";break}i.append("tspan").attr("x",0).attr("dy",o).text(s).transition().duration(.25*t.duration).attr("fill-opacity",1).transition().delay(.5*t.duration).duration(.25*t.duration).attr("fill-opacity",0).remove(),s=e[d],c++}else s=f}i.append("tspan").attr("x",0).attr("dy",o).text(s).transition().duration(.25*t.duration).attr("fill-opacity",1).transition().delay(.5*t.duration).duration(.25*t.duration).attr("fill-opacity",0).remove(),r.remove()}}),t.delay)}}]),a}(function(){function e(){Object(r.a)(this,e)}return Object(i.a)(e,[{key:"makecaption",value:function(e,t){}}]),e}()),De={FADE:"fade"},xe=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e))._animation=e.style.animation,"style"in e?(i._style=e.style,i._style.delay||(i._style.delay=0),i._style.duration||(i._style.duration=-1)):i._style={delay:0,duration:0},i}return Object(i.a)(a,[{key:"operate",value:function(e){var t=this._type2caption(this._animation),a=e.chart(),r=this._style;t.makecaption(a,r)}},{key:"_type2caption",value:function(e){switch(e){case De.FADE:default:return new Re}}}]),a}(O),ke=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).channel=e.channel,i.field=e.field,i.style="style"in e?e.style:{delay:0,duration:0},i}return Object(i.a)(a,[{key:"operate",value:function(e){e.chart().modifyEncoding(this.channel,this.field,this.style)}}]),a}(O),Le=function(e){Object(A.a)(a,e);var t=Object(_.a)(a);function a(e){var i;return Object(r.a)(this,a),(i=t.call(this,e)).channel=e.channel,i.style="style"in e?e.style:{delay:0,duration:0},i}return Object(i.a)(a,[{key:"operate",value:function(e){e.chart().removeEncoding(this.channel,this.style)}}]),a}(O),we=function(){function e(){Object(r.a)(this,e),this._parsedData=[]}return Object(i.a)(e,[{key:"parse",value:function(e){var t=e.data?e.data:{},a=e.fact?e.fact:{},r="focus"in a?a.focus:[],i=e.actions?e.actions:[],n=new b;if(i.length>0){var o,c=Object(s.a)(i);try{for(c.s();!(o=c.n()).done;){var l=o.value,u=[];if("add"in l)switch(l.add){case"chart":u.push(new S(l));break;case"annotation":if("target"in l||(l.target=r),"method"in l&&Array.isArray(l.method)){var d,f=Object(s.a)(l.method);try{for(f.s();!(d=f.n()).done;){var p=d.value,h=Object(v.a)({},l);h.method=p;var g=new Te(h);u.push(g)}}catch(A){f.e(A)}finally{f.f()}}else{var y=new Te(l);u.push(y)}break;case"encoding":u.push(new Ae(l));break;case"aggregation":u.push(new _e(l));break;case"title":u.push(new Ie(l));break;case"caption":u.push(new xe(l))}else"modify"in l?u.push(new ke(l)):"remove"in l?u.push(new Le(l)):("select"in l||"groupby"in l||"filter"in l)&&u.push(new C(l));for(var m=0,E=u;m<E.length;m++){var T=E[m];n.add(T)}}}catch(A){c.e(A)}finally{c.f()}}return{dataspec:t,factspec:a,pipeline:n}}}]),e}(),Pe=[{id:0,template:"The Pearson correlation between the {{measure1}} and the {{measure2}} is {{parameter}} when {{subspace}}."},{id:1,template:"When {{subspace}}, the Pearson correlation coefficient between the {{measure1}} and the {{measure2}} is {{parameter}}."},{id:2,template:"When {{subspace}}, the {{measure1}} is correlated with the {{measure2}} and the Person correlation is {{parameter}}."}],Ne=[{id:0,template:"When {{subspace}}, there are {{parameter}} {{groupby}}s: {{no.1}}, {{no.2}}, {{no.3}}, and {{focus}} needs to pay attention."},{id:1,template:"When {{subspace}}, the data are grouped into {{parameter}} {{groupby}}s, including {{no.1}}, {{no.2}}, {{no.3}}, among which {{focus}} needs to pay attention."},{id:2,template:"The data contain {{parameter}} {{groupby}}s when {{subspace}}, which are {{no.1}}, {{no.2}}, {{no.3}}. {{focus}} needs to pay attention."}],Se=[{id:0,template:"The difference between {{focus1}} and {{focus2}} regarding to their {{agg}} {{measure}} is {{parameter}} when {{subspace}}."},{id:1,template:"{{focus1}} and {{focus2}}'s difference on the {{agg}} {{measure}} is {{parameter}} when {{subspace}}."},{id:2,template:"A comparison between {{focus1}} and {{focus2}} on their {{agg}} {{measure}} shows the difference is {{parameter}} when {{subspace}}."}],Fe=[{id:0,template:"The distribution of the {{agg}} {{measure}} over different {{groupby}}s shows an overview of the data when {{subspace}} and {{focus}} needs to pay attention."},{id:1,template:"The distribution of the {{agg}} {{measure}} over different {{groupby}}s shows an overview of the data when {{subspace}} and {{focus}} needs to pay attention."},{id:2,template:"The distribution of the {{agg}} {{measure}} over different {{groupby}}s shows an overview of the data when {{subspace}} and {{focus}} needs to pay attention."}],Ve=[{id:0,template:"Given {{subspace}}, the {{focus}} value of the {{agg}} {{measure}} is {{parameter[1]}} when the {{groupby}} is {{parameter[0]}}."},{id:1,template:"The {{focus}} {{agg}} {{measure}} value over {{groupby}}s is {{parameter[1]}} when the {{groupby}} is {{parameter[0]}} given {{subspace}}."},{id:2,template:"Among all {{groupby}}s, {{parameter[0]}} has the {{focus}} {{agg}} {{measure}} value, which is {{parameter[1]}}, when {{subspace}}."}],je=[{id:0,template:"The {{agg}} {{measure}} of {{focus}} is an outlier when compared with that of other {{groupby}}s when {{subspace}}."},{id:1,template:"{{focus}}'s {{agg}} {{measure}} is anomalously different from other {{groupby}}s' {{measure}} when {{subspace}}."},{id:2,template:"Among various {{groupby}}s, the {{agg}} {{measure}} of {{focus}} is an anomaly when {{subspace}}."}],Me=[{id:0,template:"The {{focus}} accounts for {{parameter}} of the {{agg}} {{measure}} when {{subspace}}."},{id:1,template:"The {{focus}} makes up {{parameter}} of the {{agg}} {{measure}} when {{subspace}}."},{id:2,template:"The {{focus}}'s {{agg}} {{measure}} takes {{parameter}} of the {{agg}} {{measure}} when {{subspace}}."}],Ge=[{id:0,template:"In the {{agg}} {{measure}} ranking of different {{groupby}}s,  the top three {{groupby}}s are {{no.1}}, {{no.2}}, {{no.3}}, when {{subspace}}."},{id:1,template:"The ranking list of the {{groupby}}s ordered by their {{agg}} {{measure}} when {{subspace}}, in which the top three {{groupby}}s are {{no.1}}, {{no.2}}, {{no.3}}."},{id:2,template:"When sorting the {{groupby}}s in order based on their {{agg}} {{measure}}, the top three {{groupby}}s are {{no.1}}, {{no.2}}, {{no.3}} when {{subspace}}."},{id:3,template:"The ranking list of the {{groupby}}s ordered by their {{agg}} {{measure}} when {{subspace}}."}],Ue=[{id:0,template:"The trend of the {{agg}} {{measure}} over {{groupby}}s is {{parameter}} when {{subspace}} and the value of {{focus}} needs to pay attention."},{id:1,template:"The {{agg}} {{measure}} over {{groupby}}s shows a/an {{parameter}} trend when {{subspace}} and the value of {{focus}} needs to pay attention."},{id:2,template:"The {{agg}} {{measure}} over {{groupby}}s is {{parameter}} when {{subspace}} and the value of {{focus}} needs to pay attention."},{id:3,template:"The trend of the {{agg}} {{measure}} over {{groupby}}s."}],Be=[{id:0,template:"The {{agg}} {{measure}} is {{parameter}} when {{subspace}}."},{id:1,template:"When {{subspace}}, the value of the {{agg}} {{measure}} is {{parameter}}."},{id:2,template:"The {{agg}} {{measure}} value is {{parameter}} when {{subspace}}."}],He=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,a=[];switch(e.type){case c.Association:a=Pe;break;case c.Categorization:a=Ne;break;case c.Difference:a=Se;break;case c.Distribution:a=Fe;break;case c.Extreme:a=Ve;break;case c.Outlier:a=je;break;case c.Proportion:a=Me;break;case c.Rank:a=Ge;break;case c.Trend:a=Ue;break;case c.Value:a=Be}-1===t&&(t=Math.floor(10*Math.random())%3),e.breakdown.length>=2&&(e.type===c.Trend||e.type===c.Rank)&&(t=3);var r="";try{r=a[t].template}catch(i){console.error(i),console.log("wrong id:"+t)}return r},ze=a(259),We=new Map(Object.entries(ze)),Xe=function(e,t,a){if("number"===typeof t&&(a=t),We.has(e.toLowerCase())){t=We.get(e.toLowerCase());var r=e.charAt(0);r===r.toUpperCase()&&(t=r.toUpperCase()+t.slice(1)),e===e.toUpperCase()&&(t=t.toUpperCase())}else"string"!==typeof t&&(t=(e.replace(/(?:s|x|z|ch|sh)$/i,"$&e").replace(/([^aeiou])y$/i,"$1ie")+"s").replace(/i?e?s$/i,(function(t){return e.slice(-1)===e.slice(-1).toLowerCase()?t.toLowerCase():t.toUpperCase()})));return 1===Math.abs(a)?e:t},qe=function(e){switch(e){case l:return"total";case u:return"maximum";case d:return"minimum";case f:return"average";case p:return"count";case h:return"";default:return"total"}},Ye=function(e){return"COUNT"!==e&&e?e.toLowerCase():""},Ke=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"single",a=e[0].field;if("single"===t)return a.toLowerCase();if("plural"===t){if(-1===a.indexOf(" of "))return Xe(a,2).toLowerCase();var r=a.split(" "),i=r.indexOf("of")-1;if(i>-1){var n=Xe(r[i],2);return a.replace(r[i],n)}}},Ze=function(e){var t=0,a="",r="";(e=(e||0).toString()).indexOf(".")>0?(t=e.indexOf("."),a=e.substr(t),r=e.substring(0,t)):r=e;for(var i=[],n=0,o=(r=r.split("")).length-1;o>=0;o--)n++,i.unshift(r[o]),n%3||0===o||i.unshift(",");return i.join("")+a||""},Je=function(e,t){var a="";return e.subspace.length?(e.subspace.map((function(e,t){return a+="".concat(0===t?"":" and ","the ").concat(e.field," is ").concat(e.value)})),t=t.replace("{{subspace}}",a)):t=(t=(t=(t=(t=(t=(t=t.replace(", when {{subspace}}","")).replace(" when {{subspace}}","")).replace(" in case of {{subspace}}","")).replace(" given {{subspace}}","")).replace("When {{subspace}}, ","")).replace("Given {{subspace}}, ","")).replace("In case of {{subspace}}, ",""),t},Qe=function(){function e(){Object(r.a)(this,e),this._container=document.createElement("div"),this._paragraph=document.createElement("p"),this._loader=new o,this._fact=new g,this._vis=new E,this._spec={},this._shouldShowCaption=!1,this.parser=new we}return Object(i.a)(e,[{key:"container",value:function(e){if(!e)return this._container;this._container=e}},{key:"paragraph",value:function(e){if(!e)return this._paragraph;this._paragraph=e}},{key:"load",value:function(e){this._spec=e}},{key:"shouldShowCaption",value:function(e){if(!e)return this._shouldShowCaption;this._shouldShowCaption=e}},{key:"generate",value:function(){var e=this,t=this._spec,a=this.parser.parse(t),r=a.dataspec,i=a.factspec,n=a.pipeline;this._loader.load(r).then((function(t){return e._fact.data(t.data()),e._fact.schema(t.schema()),e._fact.process(i)})).then((function(t){e._vis.container(e.container()),e._vis.data(t.data()),e._vis.fact(t.fact()),e._vis.factdata(t.factdata());try{var a=function(e){var t=He(e),a=h;switch(e.measure.length>0&&(a=e.measure[0].aggregate),e.type){case c.Association:t=(t=(t=(t=t.replace("{{measure1}}",Ye(e.measure[0].field))).replace("{{measure2}}",Ye(e.measure[1].field))).replace("{{agg1}}",qe(e.measure[0].aggregate))).replace("{{agg2}}",qe(e.measure[1].aggregate)),t=Je(e,t),""!==e.parameter&&(t=t.replace("{{parameter}}",Ze(e.parameter.toFixed(3))));break;case c.Categorization:if(t=(t=t.replace("{{groupby}}s",Ke(e.breakdown,"plural"))).replace("{{groupby}}s",Ke(e.breakdown,"plural")),t=Je(e,t),e.parameter.length){t=t.replace("{{parameter}}",Ze(e.parameter.length));var r="";e.parameter.forEach((function(e,t){r+="".concat(0===t?"":","," ").concat(e)})),t=t.replace(" {{no.1}}, {{no.2}}, {{no.3}}",r)}if(e.focus.length)if(t.indexOf(". {{focus}}")>-1){var i=e.focus[0].value.slice(0,1).toUpperCase()+e.focus[0].value.slice(1);t=t.replace("{{focus}}",i)}else t=t.replace("{{focus}}",e.focus[0].value);else t=(t=(t=t.replace(", and {{focus}} needs to pay attention","")).replace(", among which {{focus}} needs to pay attention","")).replace(". {{focus}} needs to pay attention","");break;case c.Difference:t=(t=t.replace("{{measure}}",Ye(e.measure[0].field))).replace("{{agg}}",qe(a)),e.focus.length>=2&&(t=(t=t.replace("{{focus1}}",e.focus[0].value)).replace("{{focus2}}",e.focus[1].value)),t=Je(e,t),""!==e.parameter&&(t=t.replace("{{parameter}}",Ze(e.parameter)));break;case c.Distribution:t=(t=(t=(t=(t=t.replace("{{measure}}",Ye(e.measure[0].field))).replace("{{measure}}",Ye(e.measure[0].field))).replace("{{agg}}",qe(a))).replace("{{groupby}}s",Ke(e.breakdown,"plural"))).replace("{{groupby}}",Ke(e.breakdown)),t=Je(e,t),t=e.focus.length?t.replace("{{focus}}",e.focus[0].value):t.replace(" and {{focus}} needs to pay attention","");break;case c.Extreme:t=(t=(t=(t=(t=t.replace("{{measure}}",Ye(e.measure[0].field))).replace("{{agg}}",qe(a))).replace("{{groupby}}s",Ke(e.breakdown,"plural"))).replace("{{groupby}}",Ke(e.breakdown))).replace("{{groupby}}",Ke(e.breakdown)),t=Je(e,t),e.parameter.length&&(t=(t=(t=t.replace("{{parameter[0]}}",e.focus[0].value)).replace("{{parameter[1]}}",Ze(e.parameter[1]))).replace("{{focus}}",e.parameter[2]));break;case c.Outlier:t=(t=(t=(t=t.replace("{{measure}}",Ye(e.measure[0].field))).replace("{{measure}}",Ye(e.measure[0].field))).replace("{{groupby}}s",Ke(e.breakdown,"plural"))).replace("{{agg}}",qe(a)),t=Je(e,t),e.focus.length&&(t=t.replace("{{focus}}",e.focus[0].value));break;case c.Proportion:t=(t=(t=(t=t.replace("{{measure}}",Ye(e.measure[0].field))).replace("{{agg}}",qe(a))).replace("{{measure}}",Ye(e.measure[0].field))).replace("{{agg}}",qe(a)),t=Je(e,t),e.focus.length&&(t=t.replace("{{focus}}",e.focus[0].value)),e.parameter&&(t=t.replace("{{parameter}}",e.parameter));break;case c.Rank:t=(t=(t=(t=t.replace("{{measure}}",Ye(e.measure[0].field))).replace("{{agg}}",qe(a))).replace("{{groupby}}s",Ke([e.breakdown[e.breakdown.length-1]],"plural"))).replace("{{groupby}}s",Ke(e.breakdown,"plural")),t=Je(e,t),e.parameter.length>=3?(t=(t=(t=t.replace("{{parameter}}",Ze(e.parameter.length))).replace("{{no.1}}",e.parameter[0])).replace("{{no.2}}",e.parameter[1]),3===e.parameter.length||e.parameter.length>3?t=t.replace("{{no.3}}",e.parameter[2]):2===e.parameter.length&&(t=t.replace(", {{no.3}}",""))):t="";break;case c.Trend:var n=e.breakdown.find((function(e){return"temporal"===e.type}));t=(t=(t=t.replace("{{measure}}",Ye(e.measure[0].field))).replace("{{agg}}",qe(a))).replace("{{groupby}}s",Ke([n],"plural")),t=Je(e,t),e.parameter&&(t=t.replace("{{parameter}}",e.parameter),t="increasing"===e.parameter?t.replace("a/an","an"):t.replace("a/an","a")),t=e.focus.length?t.replace("{{focus}}",e.focus[0].value):t.replace(" and the value of {{focus}} needs to pay attention","");break;case c.Value:t=(t=t.replace("{{measure}}",Ye(e.measure[0].field))).replace("{{agg}}",qe(a)),t=Je(e,t),e.focus.length&&(t=t.replace("{{focus}}",e.focus[0].value)),""!==e.parameter&&(t=t.replace("{{parameter}}",Ze(e.parameter)))}return t=t.slice(0,1).toUpperCase()+t.slice(1)}(t.fact());e._vis.caption(a)}catch(r){console.log(r)}e._vis.run(n)})).catch((function(e){console.log(e)}))}}]),e}()}},[[168,80,81]]]);
//# sourceMappingURL=main.bbf207be.chunk.js.map