(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[57,63],{127:function(t,e,n){"use strict";n.r(e),n.d(e,"getChoice",(function(){return b})),n.d(e,"getFactChartType",(function(){return T}));var a=n(4),r=n(5),c=n(9),i=n(8),o=n(20),u=n(2),s=n.n(u),d=n(90),f=(n(89),n(51)),p=n.n(f),l=n(3),h=n(32),g=n(12),m=n.n(g),y=n(27),v=n(556),E=(n(704),n(439)),_=n(440),b=(n(0),n(599),function(t){return Math.round(Math.random()*(t-1))}),T=function(t,e){var n=Object(h.a)(e,t);return 0===n.length?null:n[b(n.length)].chart},O={canDrag:function(t){return t.isReady},isDragging:function(t,e){return e.getItem().id===t.id},beginDrag:function(t,e,n){return document.body.querySelectorAll(".dragCard")[n.props.index].classList.add("dragging"),{id:t.id}},endDrag:function(t,e,n){if(t.isPlayVideo);else{if(document.body.querySelectorAll(".dragCard")[n.props.index].classList.remove("dragging"),!e.didDrop())return;var a=e.getDropResult(),r=n.props,c=r.addCard,i=r.index;if("undefined"!==typeof a.insert){var u,s=m.a.cloneDeep(t.schemaFilterLocal),d=t.schema;u=s?{schema:s}:{schema:d};var f=t.fact;if(f.chart&&""!==f.chart||(f.chart=T(u.schema,f)),f.chart===l.a.ISOTYPE_BAR_CHART&&(f.chart=l.a.VERTICAL_BAR_CHART),!(f=Object(y.a)(f)).chart||!Object(y.b)(f))return console.log("no valid",f),null;var p,h=Object(o.a)(Object(o.a)({},f),{},{breakdown:f.groupby.map((function(t){return{field:t}}))}),g={width:135,height:86};p=g?{width:g.width,height:g.height,type:"unitvis",style:"business",duration:0,showSuggestion:!0}:{size:null,type:"unitvis",style:"business",duration:0,showSuggestion:!0};var v=m.a.cloneDeep(t.dataresLocal),b={data:u=Object(o.a)(Object(o.a)({},u),{},{values:v}),fact:h,chart:p},O=t.fact,A=b;Object(_.a)(E.a.dragNewFact,1,t.fact),t.insertFact(i,a.insert),c(O,A,6e3,!1,a.insert),t.deleteUnusedFact(i);t.addBarToTimeLineBar({leftbar:140,rightbar:18,isDrag:!1},a.insert)}}}};var A=function(t){Object(c.a)(n,t);var e=Object(i.a)(n);function n(){var t;Object(a.a)(this,n);for(var r=arguments.length,c=new Array(r),i=0;i<r;i++)c[i]=arguments[i];return(t=e.call.apply(e,[this].concat(c))).deleteFact=function(){t.props.deleteUnusedFact(t.props.index)},t}return Object(r.a)(n,[{key:"shouldComponentUpdate",value:function(t){var e=this.props.fact,n=t.fact;return!m.a.isEqual(e,n)}},{key:"render",value:function(){var t,e=this,n=this.props,a=(n.data,n.schema),r=n.fact,c=n.isReady,i=(n.filters,n.width),o=n.height,u=m.a.cloneDeep(this.props.dataresLocal),f=m.a.cloneDeep(this.props.schemaFilterLocal);t=f?{schema:f}:{schema:a};var l=p()(),h=Object(d.b)(t,l,r,u,null,{width:i,height:o},!0);return(0,this.props.connectDragSource)(s.a.createElement("li",null,s.a.createElement("div",{className:c?"factCard dragCard":"factCard"},s.a.createElement("div",{className:"delete",onClick:function(){return e.deleteFact()}}),s.a.createElement("div",{className:"vis"},h))))}}]),n}(s.a.Component);e.default=Object(v.DragSource)("card",O,(function(t,e){return{connectDragSource:t.dragSource(),isDragging:e.isDragging()}}))(A)},145:function(t,e,n){"use strict";n.r(e),n.d(e,"default",(function(){return j}));n(537);var a=n(539),r=n(113),c=n.n(r),i=n(425),o=n(10),u=n(4),s=n(5),d=n(9),f=n(8),p=n(2),l=n.n(p),h=n(83),g=n(540),m=n(86),y=n(401),v=n(761),E=n(127),b=n(52),T=n(439),O=n(440),A=n(421),D=n(528),S=n(51),I=n.n(S),C=n(12),R=n(708),j=function(t){Object(d.a)(n,t);var e=Object(f.a)(n);function n(t){var a;Object(u.a)(this,n),(a=e.call(this,t)).getGenerateURL=function(t){switch(t){case g.a.DATACOMICS:return y.a.url.generateGraphRandomly;case g.a.FACTSHEET:default:return y.a.url.generateRandomly}},a.addFact=function(){var t=g.a[0];a.setState({operateState:h.a.ADDING});var e=t.name;a.adding(a.getGenerateURL(e)).then((function(t){var n=t.data.story.facts;switch(e){case m.a.DATACOMICS:case m.a.FACTSHEET:case m.a.DASHBOARD:case m.a.DATAVIDEOS:default:var r,c=[],i=Object(o.a)(n);try{for(i.s();!(r=i.n()).done;){var u=r.value,s=new D.a(u.type,u.measure,u.subspace,u.groupby,u.focus,u.parameter,"",u.score,u.information,u.significance);s.uuid=I()(),c.push(s)}}catch(d){i.e(d)}finally{i.f()}a.props.addFact(c)}}))},a.adding=function(t){return new Promise(function(){var e=Object(i.a)(c.a.mark((function e(n,r){var i,o,u,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.props.fileName,(o=_.cloneDeep(a.props.filtersLocal))&&(u={file_name:i,max_story_length:10,filters:JSON.stringify(o),method:"mcts"}),e.next=5,A.d(t,u);case 5:s=e.sent,console.log("response-adding",s),s.data.fail&&(a.setState({operateState:h.a.ADD_FAILED,errorMessage:s.data.fail}),r(),Object(O.a)(T.a.generateMoreFacts,0,{filename:i,response:s})),s.data.error&&(a.setState({operateState:h.a.ADD_FAILED,errorMessage:s.data.error}),r(),Object(O.a)(T.a.generateMoreFacts,0,{filename:i,response:s})),a.setState({operateState:h.a.GENERATED}),n(s),Object(O.a)(T.a.generateMoreFacts,1,{filename:i,response:s});case 12:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}())};var r=a.props.intl.options.currentLocale;return Object(C.filter)(r),a.state={},a}return Object(s.a)(n,[{key:"UNSAFE_componentWillMount",value:function(){this.props.unusedFacts.length||this.addFact()}},{key:"render",value:function(){var t=this,e=this.props,n=e.intl,r=e.initDone,c=e.unusedFacts,i=this.state.operateState,o=n.options.currentLocale,u=r&&n.get("adding");c.map((function(t,e){t.generatedScript=Object(b.a)(t,o),t.generatedSubtitle=Object(b.b)(t,o)}));var s=function(){return l.a.createElement("div",{className:"add"},l.a.createElement("div",{className:"addImage",onClick:t.addFact}))};return l.a.createElement(v.a,{backend:R.a,options:{enableMouseEvents:!0}},l.a.createElement("div",{className:"Topic-Facts"},l.a.createElement("div",{className:"DataFacts"},l.a.createElement(a.a,{tip:u,spinning:i===h.a.ADDING,wrapperClassName:"editSpining"},l.a.createElement("div",{className:"factsList"},l.a.createElement("ul",null,c.map((function(e,n){return l.a.createElement("div",{className:"factCardOuterFrame"},l.a.createElement(E.default,Object.assign({width:135,height:86,key:e.uuid+e.index,dataresLocal:t.props.dataresLocal,schemaFilterLocal:t.props.schemaFilterLocal},t.props,{fact:e,index:n,id:e.uuid,isReady:!0})))})))))),l.a.createElement("div",null,l.a.createElement(s,null))))}}]),n}(l.a.Component)},358:function(t,e,n){var a=n(574),r="object"==typeof self&&self&&self.Object===Object&&self,c=a||r||Function("return this")();t.exports=c},362:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return c}));var a=n(2),r=a.isValidElement;function c(t,e){return function(t,e,n){return r(t)?a.cloneElement(t,"function"===typeof n?n(t.props||{}):n):e}(t,t,e)}},366:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var a=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e}},380:function(t,e,n){var a=n(561),r=n(799),c=n(800),i=a?a.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":i&&i in Object(t)?r(t):c(t)}},381:function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},401:function(t,e,n){"use strict";var a="http://calliope-dev.idvxlab.com",r="https://".concat("calliope-service.idvxlab.com",":8002/api/v1"),c="https://".concat("urania-api.idvxlab.com:8006"),i="https://".concat("calliope-service.idvxlab.com",":8002/log/v1"),o="https://".concat("urania-api.idvxlab.com:8006"),u="https://".concat("urania-api.idvxlab.com:8006"),s="https://account.datacalliope.com",d={url:{share:"".concat(o,"/share"),applicationUrl:a,publicPrefix:"http://calliope-dev.idvxlab.com",loginadmintest:"".concat(r,"/loginadmintest"),loginRedirectUrl:"".concat(s,"/#/login?response_type=code&client_id=").concat("6dcd0f8b-6990-4d69-9018-29b3351aa6ff","&grant_type=authorization_code&redirect_uri=").concat(a),logoutRedirectUrl:"".concat(a,"/#/logout"),authenUrl:s,accessToken:"".concat(r,"/accesstoken"),userImage:"".concat("https://service.datacalliope.com:8001","/img"),checkToken:"".concat(r,"/checktoken"),logout:"".concat(r,"/logout"),logoutAuthSystem:"".concat("https://service.datacalliope.com:8001","/logout"),users:"".concat(r,"/users"),activitiesApi:"".concat(i,"/users"),uploadDataPrefix:o,uploadData:"".concat(o,"/upload"),uploadGraphData:"".concat(o,"/uploadGraph"),fetch:"".concat(o,"/data/share"),factScoring:"".concat(c,"/fact"),generateRandomly:"".concat(c,"/generate"),generateGraphRandomly:"".concat(c,"/generateGraphRandomly"),filteredGenerate:"".concat(c,"/filteredgenerate"),question2gif:"".concat(u,"/edit_decompose")}};e.a=d},403:function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},421:function(t,e,n){"use strict";n.d(e,"g",(function(){return p})),n.d(e,"d",(function(){return h})),n.d(e,"e",(function(){return g})),n.d(e,"b",(function(){return m})),n.d(e,"f",(function(){return y})),n.d(e,"c",(function(){return E})),n.d(e,"a",(function(){return b}));var a=n(113),r=n.n(a),c=n(425),i=n(437),o=n.n(i),u=n(551),s=function(t,e){var n="";return n+=t,"object"===typeof e&&0!==Object.keys(e).length&&(n+="?".concat(Object(u.stringify)(e))),n},d=function(t){var e=t.url,n=t.method,a=t.param,r=t.data;return new Promise((function(t,c){o()({method:n,url:s(e,a),data:r}).then((function(e){e.status>=400?c():200===e.status||201===e.status||204===e.status?t(e.data):c()})).catch((function(t){c()}))}))},f=n(401);function p(t){return l.apply(this,arguments)}function l(){return(l=Object(c.a)(r.a.mark((function t(e){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){o()({method:"post",url:"".concat(f.a.url.uploadData),config:{headers:{"Content-Type":"multipart/form-data"}},data:e}).then((function(e){e.status>=400?n():200===e.status||201===e.status||204===e.status?t(e.data):n()})).catch((function(t){n()}))})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function h(t,e){return o()({method:"post",url:t,config:{headers:{"Content-Type":"application/json; charset=utf-8"}},data:e})}function g(t,e){return o()({method:"post",url:t,config:{headers:{"Content-Type":"application/json; charset=utf-8"}},data:e})}function m(t,e,n,a){return o()({method:"POST",url:f.a.url.factScoring,headers:{"Content-Type":"application/json; charset=utf-8"},data:{file_name:t,fact:e,filters:n,method:a}})}function y(t){return v.apply(this,arguments)}function v(){return(v=Object(c.a)(r.a.mark((function t(e){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){o()({method:"post",url:"".concat(f.a.url.share),config:{headers:{"Content-Type":"application/json; charset=utf-8"}},data:{share_json:e}}).then((function(e){e.status>=400?n():200===e.status||201===e.status||204===e.status?t(e.data):n()})).catch((function(t){n()}))})));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function E(t){return _.apply(this,arguments)}function _(){return(_=Object(c.a)(r.a.mark((function t(e){return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",o()({method:"get",url:"".concat(f.a.url.fetch,"/").concat(e,".json"),config:{headers:{"Content-Type":"application/json; charset=utf-8"}}}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function b(t,e){return T.apply(this,arguments)}function T(){return(T=Object(c.a)(r.a.mark((function t(e,n){var a;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,d({url:"".concat(f.a.url.activitiesApi,"/lite/activities"),method:"post",param:{},data:n});case 2:return a=t.sent,t.abrupt("return",a);case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},439:function(t,e,n){"use strict";e.a={uploadFile:1,generateFactSheet:2,downloadFile:3,editTopic:4,generateMoreFacts:5,editLayout:6,dragNewFact:7,deleteFact:8,editFactCaption:9,editDiagram:10,editSheetCaption:11}},440:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var a=n(421);function r(t,e,n){var r={action:t,objectid:e,meta:JSON.stringify(n)};a.a("users",r).then((function(t){console.log(t)})).catch((function(t){console.log(n)}))}},528:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var a=n(5),r=n(4),c=n(52),i=n(3),o=Object(a.a)((function t(e){var n=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],d=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],f=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"",p=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,l=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0;Object(r.a)(this,t),this.script=function(){return n.generatedScript},this.type=e,this.measure=a,this.subspace=o,this.groupby=u,this.focus=s,this.parameter=d,this.score=p,this.information=l,this.significance=h,this.chart=f,this.generatedScript=Object(c.a)(this),this.generatedSubtitle=Object(c.b)(this),this.duration=3e3,this.aggregated=!1,this.aggregatedFact=null,this.compoundType="",this.compoundChart=i.a.JUXTAPOSITION}))},540:function(t,e,n){"use strict";var a=n(86),r=n(563),c=[{name:a.a.FACTSHEET,iconUrl:"".concat(r.a,"/convertType/factsheet.png"),generateIconUrl:"".concat(r.a,"/convertType/factsheet_black.png")},{name:a.a.H5,iconUrl:"".concat(r.a,"/convertType/H5.png"),generateIconUrl:"".concat(r.a,"/convertType/H5_black.png")},{name:a.a.DATAVIDEOS,iconUrl:"".concat(r.a,"/convertType/video.png"),generateIconUrl:"".concat(r.a,"/convertType/video_black.png")}];e.a=c},561:function(t,e,n){var a=n(358).Symbol;t.exports=a},563:function(t,e,n){"use strict";e.a="http://calliope-dev.oss-cn-shanghai.aliyuncs.com/image/images"},574:function(t,e,n){(function(e){var n="object"==typeof e&&e&&e.Object===Object&&e;t.exports=n}).call(this,n(37))},599:function(t,e,n){"use strict";n.d(e,"r",(function(){return r})),n.d(e,"z",(function(){return c})),n.d(e,"w",(function(){return i})),n.d(e,"v",(function(){return o})),n.d(e,"N",(function(){return u})),n.d(e,"f",(function(){return s})),n.d(e,"k",(function(){return d})),n.d(e,"h",(function(){return f})),n.d(e,"y",(function(){return p})),n.d(e,"i",(function(){return l})),n.d(e,"p",(function(){return h})),n.d(e,"c",(function(){return g})),n.d(e,"d",(function(){return m})),n.d(e,"e",(function(){return y})),n.d(e,"H",(function(){return v})),n.d(e,"q",(function(){return E})),n.d(e,"a",(function(){return _})),n.d(e,"b",(function(){return b})),n.d(e,"o",(function(){return T})),n.d(e,"n",(function(){return O})),n.d(e,"F",(function(){return A})),n.d(e,"K",(function(){return D})),n.d(e,"D",(function(){return S})),n.d(e,"I",(function(){return I})),n.d(e,"E",(function(){return C})),n.d(e,"B",(function(){return R})),n.d(e,"G",(function(){return j})),n.d(e,"L",(function(){return N})),n.d(e,"A",(function(){return F})),n.d(e,"J",(function(){return x})),n.d(e,"M",(function(){return w})),n.d(e,"C",(function(){return L})),n.d(e,"x",(function(){return G})),n.d(e,"s",(function(){return k})),n.d(e,"m",(function(){return H})),n.d(e,"u",(function(){return M})),n.d(e,"g",(function(){return U})),n.d(e,"j",(function(){return P})),n.d(e,"l",(function(){return B})),n.d(e,"t",(function(){return V}));var a=n(7),r=function(t,e,n,r,c){return{type:a.a.INIT_VIDOE_CARD,facts:t,schemaFilter:e,filename:n,datares:r,schema:c}},c=function(){return{type:a.a.REPLAY_VIDEO_SLICE}},i=function(t){return{type:a.a.PLAY_VIDEO_SLICE,index:t}},o=function(){return{type:a.a.PLAY_VIDEO_CONTINUE}},u=function(){return{type:a.a.STOP_PLAY_VIDEO_CONTINUE}},s=function(){return{type:a.a.ADD_NOW_VIDEO_TIME}},d=function(t){return{type:a.a.CHANGE_NOW_VIDEO_TIME,time:t}},f=function(t){return{type:a.a.CHANGE_ALL_VIDEO_TIME,time:t}},p=function(t){return{type:a.a.REMOVE_CARD,index:t}},l=function(t,e){return{type:a.a.CHANGE_CARD,origin:t,target:e}},h=function(t,e){return{type:a.a.EXCHANGE_CARD,index:t,card:e}},g=function(t,e,n,r,c){return{type:a.a.ADD_CARD,fact:t,specs:e,time:n,isGeneratedByAlg:r,insert:c}},m=function(t,e){return{type:a.a.ADD_CARDS,cards:t,insert:e}},y=function(){return{type:a.a.ADD_EMPTY_CARD}},v=function(t){return{type:a.a.SET_LEFTSIDER_CONTENT,content:t}},E=function(t){return{type:a.a.INIT_TIME_LINE_BAR_WDITH,length:t}},_=function(t,e){return{type:a.a.ADD_BAR_TO_TIME_LINE_BAR,bar:t,index:e}},b=function(t,e){return{type:a.a.ADD_BARS_TO_TIME_LINE_BAR,bars:t,index:e}},T=function(t){return{type:a.a.DELETE_BAR_FROM_TIME_LINE_BAR,index:t}},O=function(t,e){return{type:a.a.CHANGE_TIME_LINE_BAR,origin:t,target:e}},A=function(t,e){return{type:a.a.SET_LEFT_BAR_WIDTH,index:t,width:e}},D=function(t,e){return{type:a.a.SET_RIGHT_BAR_WIDTH,index:t,width:e}},S=function(t){return{type:a.a.SET_DRAG_DIRECTION,direction:t}},I=function(t){return{type:a.a.SET_MOUSE_DOWN_STATE,mouseDown:t}},C=function(t,e){return{type:a.a.SET_DRAG_STATE,index:t,drag:e}},R=function(t){return{type:a.a.SET_CURRENT_X,clientx:t}},j=function(t){return{type:a.a.SET_LEFT_OFFSET_WIDTH,offset:t}},N=function(t){return{type:a.a.SET_RIGHT_OFFSET_WIDTH,offset:t}},F=function(t){return{type:a.a.SET_CURRENT_BAR_INDEX,index:t}},x=function(t){return{type:a.a.SET_POSITION,position:t}},w=function(t){return{type:a.a.SET_SCENE_SCALE,scale:t}},L=function(t){return{type:a.a.SET_DRAG_CURSOR,cursor:t}},G=function(t,e){return{type:a.a.QUESTION_2_GIF,question:t,narrative_spec:e}},k=function(t){return{type:a.a.ISGENERATINGGIF,isGenerating:t}},H=function(t){return{type:a.a.CHANGE_TEMP_SPEC,temp_spec:t}},M=function(t){return{type:a.a.OPERATOR_CHANGE,operatorType:t}},U=function(t){return{type:a.a.ANIMATION_CHANGE,animationType:t}},P=function(t){return{type:a.a.CHANGE_KEYS,keys:t}},B=function(t,e){return{type:a.a.CHANGE_OPERATOR,origin:t,target:e}},V=function(t){return{type:a.a.OPERATOR_ADDING,operatorAdds:t}}},704:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var a={trend:"#8dd3c7",extreme:"#f0e68c",value:"#bebada",categorization:"#fb8072",difference:"#80b1d3",proportion:"#fdb462",distribution:"#b3de69",rank:"#fccde5",association:"#d9d9d9",outlier:" #bc80bd",null:"white"}},799:function(t,e,n){var a=n(561),r=Object.prototype,c=r.hasOwnProperty,i=r.toString,o=a?a.toStringTag:void 0;t.exports=function(t){var e=c.call(t,o),n=t[o];try{t[o]=void 0;var a=!0}catch(u){}var r=i.call(t);return a&&(e?t[o]=n:delete t[o]),r}},800:function(t,e){var n=Object.prototype.toString;t.exports=function(t){return n.call(t)}}}]);
//# sourceMappingURL=57.e4423bab.chunk.js.map