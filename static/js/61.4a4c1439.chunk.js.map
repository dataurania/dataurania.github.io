{"version":3,"sources":["pages/EditPage/EditDataVideos/VideoSliceCardList/SliceCard.js","pages/EditPage/EditDataVideos/VideoSliceCardList/UnitVisDraw.js","pages/EditPage/EditDataVideos/VideoSliceCardList/SliceCardFooter.js","pages/EditPage/EditDataVideos/VideoSliceCardList/SliceCardCaption.js","axios/config.js","axios/base.js","axios/api.js","../node_modules/@ant-design/icons-svg/es/asn/CloseOutlined.js","../node_modules/@ant-design/icons/es/icons/CloseOutlined.js","../node_modules/process/browser.js","model/fact.js","tool/narrative2cards.js"],"names":["getChoice","length","Math","round","random","getFactChartType","shema","fact","supportedChartTypes","getSupportedChartTypes","chart","SliceCard","deleteVideoSlice","index","props","isPlayVideo","removeCard","deleteBarFromTimeLineBar","deleteFact","generateTransitionFacts","Promise","resolve","reject","a","console","log","formerFact","cardItems","latterFact","filename","fileName","startFact","type","measure","subspace","groupby","focus","endFact","setState","operateState","OperationType","GENERATING","isUpdateEditing","data","file_name","max_story_length","method","start","end","api","config","url","generateRandomly","response","fail","ADD_FAILED","errorMessage","error","facts","story","tempFacts","factDict","Fact","generatedScript","genFactSentence","state","lang","push","i","myCards","myBars","schemaFilter","_","cloneDeep","schemaFilterLocal","schema","specData","ChartType","ISOTYPE_BAR_CHART","VERTICAL_BAR_CHART","isValid","datares","dataresLocal","values","specChart","width_height","width","height","style","duration","showSuggestion","size","specFact","breakdown","map","d","specs","insertIndex","insertFactByFact","myCard","spec","time","isGeneratedByAlg","bar","leftbar","rightbar","isDrag","addCards","addBarsToTimeLineBar","GENERATED","this","videoIndex","vis","uuid","uuidv4","narrativespec2Vis","className","ref","provided","innerRef","draggableProps","dragHandleProps","background","onClick","playVideoSlice","setLeftsiderContent","React","Component","UnitVisDraw","editClickSlice","ActionType","SET_EDIT_SLICE","nextProps","nextState","pre","narrative_spec","next","is","Immutable","fromJS","SliceCardFooter","num","backgroundColor","SliceCardCaption","myActions","actions","caption","text","applicationUrl","urlPrefix","generationUrlPrefix","activitiesPrefix","uploadDataPrefix","question2gifPrefix","accountIp","share","publicPrefix","loginadmintest","loginRedirectUrl","logoutRedirectUrl","authenUrl","accessToken","userImage","checkToken","logout","logoutAuthSystem","users","activitiesApi","uploadData","uploadGraphData","fetch","factScoring","generateGraphRandomly","filteredGenerate","question2gif","composeUrl","qs","result","Object","keys","stringify","requestWithoutCredentials","param","reslove","axios","then","status","catch","formData","generate","filters","shareStory","jsonstring","fetchStory","id","uid","body","req","CloseOutlined","AntdIcon","_objectSpread","icon","CloseOutlinedSvg","displayName","cachedSetTimeout","cachedClearTimeout","process","module","exports","defaultSetTimout","Error","defaultClearTimeout","runTimeout","fun","setTimeout","e","call","clearTimeout","currentQueue","queue","draining","queueIndex","cleanUpNextTick","concat","drainQueue","timeout","len","run","marker","runClearTimeout","Item","array","noop","nextTick","args","Array","arguments","prototype","apply","title","browser","env","argv","version","versions","on","addListener","once","off","removeListener","removeAllListeners","emit","prependListener","prependOnceListener","listeners","name","binding","cwd","chdir","dir","umask","parameter","score","information","significance","script","generatedSubtitle","genSubtitle","aggregated","aggregatedFact","compoundType","compoundChart","JUXTAPOSITION","narrative_spec2cards","idx_titleaction","step_actions","item","add","eachaction","slice","delay","splice","step_spec"],"mappings":"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","file":"static/js/61.4a4c1439.chunk.js","sourcesContent":["import React from 'react';\r\nimport { CloseOutlined } from '@ant-design/icons';\r\nimport { narrativespec2Vis } from '@/tool/narrative2cards';\r\nimport { fact2unitVis } from '@/tool/fact2unitVis';\r\n\r\nimport uuidv4 from 'uuid/v4';\r\nimport ActionType from '@/action/type';\r\nimport UnitVisDraw from './UnitVisDraw';\r\nimport ChartType from '../../../../constant/ChartType';\r\nimport SliceCardFooter from './SliceCardFooter';\r\nimport SliceCardCaption from './SliceCardCaption'\r\nimport * as api from '@/axios/api';\r\nimport OperationType from '@/constant/OperationType';\r\nimport config from '@/axios/config';\r\nimport Fact from '@/model/fact';\r\nimport { genFactSentence } from '@/sentencer/index';\r\nimport { isValid, customizeFact } from '@/view/FactEditor/helper';\r\nimport getSupportedChartTypes from '@/tool/getSupportedChartTypes';\r\nimport _ from 'lodash';\r\n\r\n\r\nexport const getChoice = (length) => {\r\n    let choice = Math.round(Math.random() * (length - 1));\r\n    return choice;\r\n}\r\n\r\nexport const getFactChartType = (shema, fact, choice = 0) => {\r\n    let supportedChartTypes = getSupportedChartTypes(fact, shema);\r\n    if (supportedChartTypes.length === 0) return null;\r\n    return supportedChartTypes[getChoice(supportedChartTypes.length)].chart;\r\n}\r\n\r\nexport default class SliceCard extends React.Component {\r\n\r\n\r\n    deleteVideoSlice = (index) => {\r\n        if(this.props.isPlayVideo)\r\n        {\r\n            null\r\n        }\r\n        else\r\n        {\r\n        this.props.removeCard(index)\r\n        this.props.deleteBarFromTimeLineBar(index)\r\n        this.props.deleteFact(index)\r\n        }\r\n    }\r\n\r\n    generateTransitionFacts = (index) => {\r\n        new Promise(async (resolve, reject) => {\r\n            console.log(\"generateTransitionFacts\"+index)\r\n            let formerFact = this.props.cardItems[index]\r\n            let latterFact = this.props.cardItems[index+1]\r\n\r\n            let filename = this.props.fileName\r\n            // 问题5，这里有start 和 end 的fact\r\n            let startFact = {\r\n                type:formerFact.fact.type,\r\n                measure:formerFact.fact.measure,\r\n                subspace:formerFact.fact.subspace,\r\n                groupby:formerFact.fact.groupby,\r\n                focus:formerFact.fact.focus,\r\n            }\r\n            let endFact = {\r\n                type:latterFact.fact.type,\r\n                measure:latterFact.fact.measure,\r\n                subspace:latterFact.fact.subspace,\r\n                groupby:latterFact.fact.groupby,\r\n                focus:latterFact.fact.focus,\r\n            }\r\n            \r\n            this.setState({\r\n                operateState: OperationType.GENERATING\r\n            });\r\n            this.props.isUpdateEditing(true);\r\n\r\n            let data = {\r\n                file_name:filename,\r\n                max_story_length:4,\r\n                method:\"guided\",\r\n                start:startFact,\r\n                end:endFact,\r\n            }\r\n            // 这里请求了api\r\n            const response = await api.generate(config.url.generateRandomly,data)\r\n\r\n            if (response.data.fail) {\r\n                console.log('fail')\r\n                this.setState({\r\n                    operateState: OperationType.ADD_FAILED,\r\n                    errorMessage: response.data.fail\r\n                })\r\n                reject()\r\n                //record_activity(activitiesCode.editTopic, 0, { filename: fileName, filters: filters });\r\n            }\r\n            if (response.data.error) {\r\n                console.log('error')\r\n                this.setState({\r\n                    operateState: OperationType.ADD_FAILED,\r\n                    errorMessage: response.data.error\r\n                })\r\n                reject()\r\n                //record_activity(activitiesCode.editTopic, 0, { filename: fileName, filters: filters });\r\n            }\r\n            const facts = response.data.story.facts;\r\n            let tempFacts = [];\r\n            for (let factDict of facts){    \r\n                let fact = new Fact(\r\n                    factDict['type'],\r\n                    factDict['measure'],\r\n                    factDict['subspace'],\r\n                    factDict['groupby'],\r\n                    factDict['focus'],\r\n                    factDict['parameter'],\r\n                    \"\", // chart\r\n                    factDict['score'],\r\n                    factDict['information'],\r\n                    factDict['significance']\r\n                )\r\n                fact.generatedScript = genFactSentence(fact, this.state.lang)\r\n                tempFacts.push(fact);\r\n            }\r\n            console.log(tempFacts.length)\r\n\r\n            var i = 0\r\n            var myCards = []\r\n            var myBars =[]\r\n\r\n            for(let fact of tempFacts){\r\n                if(tempFacts.length==1||tempFacts.length==2)\r\n                {\r\n                    break\r\n                }\r\n                if(i==0||i==tempFacts.length-1)\r\n                {\r\n                    i++\r\n                    continue\r\n                }\r\n                \r\n                let schemaFilter = _.cloneDeep(this.props.schemaFilterLocal);\r\n                let schema=this.props.schema\r\n                let specData\r\n                schemaFilter ? specData = { \"schema\": schemaFilter, } : specData = { \"schema\": schema };\r\n\r\n                if (!fact.chart || fact.chart === \"\") {\r\n                    fact.chart = getFactChartType(specData.schema, fact); //针对生成页面的chart\r\n                }\r\n            \r\n                let chart = fact.chart;\r\n            \r\n                if (chart === ChartType.ISOTYPE_BAR_CHART) {\r\n                    fact.chart = ChartType.VERTICAL_BAR_CHART;\r\n                }\r\n                // 不会返回一个Fact对象 而是返回一个{}\r\n                // fact = customizeFact(fact);\r\n                if (!fact.chart || !isValid(fact)) {\r\n                    console.log(\"no valid\", fact)\r\n                    return null;\r\n                }\r\n\r\n                let datares = _.cloneDeep(this.props.dataresLocal);\r\n\r\n                specData = {\r\n                    ...specData,\r\n                    values: datares,\r\n                }\r\n\r\n                let width_height = { \"width\": 135, \"height\": 86 };\r\n                let size = null;\r\n                let specChart;\r\n                if (width_height) {\r\n                    specChart = {\r\n                        width: width_height.width,\r\n                        height: width_height.height,\r\n                        type: \"unitvis\",\r\n                        style: \"business\",\r\n                        duration: 0,\r\n                        showSuggestion: true, //显示图表Unsupported\r\n                    }\r\n                } else {\r\n                    specChart = {\r\n                        size: size,\r\n                        type: \"unitvis\",\r\n                        style: \"business\",\r\n                        duration: 0,\r\n                        showSuggestion: true, //显示图表Unsupported\r\n                    }\r\n                }\r\n                let specFact = {\r\n                    ...fact,\r\n                    breakdown: fact.groupby.map(d => {\r\n                        return {\r\n                            \"field\": d\r\n                        }\r\n                    }),\r\n                    index:i\r\n                }\r\n\r\n                let specNew = {\r\n                    data: specData,\r\n                    fact: specFact,\r\n                    chart: specChart,\r\n                }\r\n                let specs = specNew\r\n                let time = 6000;\r\n                let insertIndex = index + i\r\n                //添加到facts中\r\n                this.props.insertFactByFact(fact,insertIndex)\r\n                // 添加卡片到下方keyframes中\r\n                //this.props.addCard(fact,specs,time,true, insertIndex);\r\n                let myCard = {\r\n                    fact:fact,\r\n                    spec:specs,\r\n                    time:time,\r\n                    isGeneratedByAlg:true}\r\n                myCards.push(myCard)\r\n                // 添加对应的time控制的bar\r\n                let bar = { leftbar: 140, rightbar: 18,isDrag:false }\r\n                myBars.push(bar)\r\n                //this.props.addBarToTimeLineBar(bar,insertIndex)\r\n                i++;\r\n            }\r\n            \r\n            //需要一次性加入 否则会有卡片units重叠现象\r\n            this.props.addCards(myCards,index+1)\r\n            this.props.addBarsToTimeLineBar(myBars,index+1)\r\n            \r\n            this.setState({\r\n                operateState: OperationType.GENERATED\r\n            })\r\n            this.props.isUpdateEditing(false)\r\n            resolve(response)\r\n\r\n\r\n        })\r\n    }\r\n\r\n\r\n\r\n    render() {\r\n    \r\n        const { videoIndex, index } = this.props\r\n        let datares = _.cloneDeep(this.props.dataresLocal);\r\n        let schemaFilter = _.cloneDeep(this.props.schemaFilterLocal);\r\n        let schema = this.props.schema\r\n        let specData\r\n        schemaFilter ? specData = { \"schema\": schemaFilter, } : specData = { \"schema\": schema };\r\n        let uuid = uuidv4();\r\n        let vis;\r\n\r\n        if (this.props.spec !== 'empty') {\r\n            vis = narrativespec2Vis(this.props.spec, uuid);\r\n        } else {\r\n            vis = null;\r\n        }\r\n        console.log('herererre')\r\n        return (\r\n            <div\r\n                className='video-slice-card'\r\n                ref={this.props.provided.innerRef}\r\n                {...this.props.provided.draggableProps}\r\n                {...this.props.provided.dragHandleProps}>\r\n                <div\r\n                    className='complete-card'\r\n                    // style={videoIndex === index ? this.props.cardItems[index].isGeneratedByAlg?{border:\"3px solid #E4F2FB\",boxShadow: \"0 0 0 3px #ffb861, 0 0 0 2px #FFE1A4\"}:{border:\"3px solid #FFE1A4\",boxShadow: \"0 0 0 3px #ffb861, 0 0 0 2px #FFE1A4\"}: this.props.cardItems[index].isGeneratedByAlg?{border:\"3px solid #E4F2FB\"}:{border:\"3px solid #FFE1A4\"}}>\r\n                    // style={{border:\"3px solid #E4F2FB\"}}>         \r\n                    style={{background: '#f4f4f4'}}>           \r\n                    <div className='above-card'>\r\n                        <div className='fact-description'></div>\r\n                        <div className='delete-card-btn' onClick={() => this.deleteVideoSlice(index)}>\r\n                            <CloseOutlined />\r\n                        </div>\r\n                    </div> \r\n                    \r\n\r\n                    <UnitVisDraw\r\n                        index={index}\r\n                        videoIndex={videoIndex}\r\n                        vis={vis}\r\n                        playVideoSlice={this.props.playVideoSlice}\r\n                        setLeftsiderContent={this.props.setLeftsiderContent}\r\n                        {...this.props}\r\n                    />\r\n\r\n                    <SliceCardCaption\r\n                        spec = {this.props.spec}\r\n                        videoIndex={videoIndex} \r\n                        index={index}\r\n                        {...this.props}/>\r\n\r\n                    {/* <SliceCardFooter\r\n                        videoIndex={videoIndex} \r\n                        index={index}\r\n                        {...this.props}/> */}\r\n                </div>\r\n                {/* {\r\n                this.props.cardItems.length-1 == index ?\r\n                <div className=\"transition-button\" style={{opacity:'0'}}>\r\n                <div className=\"transition-icon\"></div>\r\n                </div>\r\n                :\r\n                ((this.props.cardItems[index].isGeneratedByAlg||this.props.cardItems[index+1].isGeneratedByAlg)?\r\n                <div className=\"transition-button\">\r\n                    <div className=\"cannot-transition-icon\"></div>\r\n                </div>\r\n                :\r\n                <div className=\"transition-button\" onClick={() => this.generateTransitionFacts(index)}>\r\n                    <div className=\"transition-icon\"></div>\r\n                </div>\r\n                )} */}\r\n\r\n                {/* <div className=\"transition-button\" style={{opacity:'0'}}>\r\n                <div className=\"transition-icon\"></div>\r\n                </div> */}\r\n            </div>\r\n        )\r\n    }\r\n}","import React from 'react';\r\nimport ActionType from '@/action/type';\r\nimport { is } from 'immutable'\r\nimport Immutable from 'immutable'\r\n\r\nexport default class UnitVisDraw extends React.Component {\r\n\r\n    editClickSlice = (index) => {\r\n        /* if(this.props.isPlayVideo)\r\n        {\r\n            null\r\n        }\r\n        else\r\n        {\r\n            null\r\n        } */\r\n        // 这里todo\r\n        //改变videoIndex+视频中显示的内容\r\n        // if(this.props.cardItems[index].spec == 'empty')\r\n        // {\r\n        //     var videoChart = document.querySelector('[id=\"video-chart\"]');\r\n        //     videoChart.style.display = 'none';\r\n        //     var caption = document.querySelector('[id=\"caption\"]');\r\n        //     caption.style.display = 'none';\r\n        // }\r\n        // else\r\n        // {\r\n        //     var videoChart = document.querySelector('[id=\"video-chart\"]');\r\n        //     videoChart.style.display = 'block';\r\n        //     var caption = document.querySelector('[id=\"caption\"]');\r\n        //     caption.style.display = 'block';\r\n        // }\r\n        // this.props.playVideoSlice(index)\r\n        // //改变指针的位置\r\n        // let needleNow = 0;\r\n        // for (let x = 0; x<index ;x++){\r\n        //     needleNow += 47.3 * this.props.cardItems[x].time / 6000 /this.props.sceneScale+ 7.3\r\n        // }\r\n        // this.props.setPosition(needleNow);\r\n        // //点击卡片让卡片成为正在编辑的卡片\r\n        // this.props.changeCurrentEditing(true,this.props.facts[index])\r\n        // this.props.changeNowVideoTime((needleNow-7.3*index)/47.3*6000*this.props.sceneScale)\r\n        \r\n        //改变左侧栏中显示的内容\r\n        this.props.setLeftsiderContent(ActionType.SET_EDIT_SLICE)\r\n        \r\n    }\r\n\r\n    shouldComponentUpdate(nextProps, nextState) {\r\n        console.log(\"~~~~~~~~~~\",this.props)\r\n        const pre = this.props.narrative_spec\r\n        const next = nextProps.narrative_spec\r\n        //进行深层对比，实现更精确的渲染\r\n        if (!is(Immutable.fromJS(pre), Immutable.fromJS(next))\r\n            ){\r\n            // console.log(this.props.index,'渲染！');\r\n            //如果当前的videoIndex对应的vis重新渲染改变了，那么currentSpec应该再重新取一下\r\n            /* if(index===videoIndex){\r\n                playVideoSlice(index)\r\n            }\r\n            console.log(\"fresh : \"+index) */\r\n            return true;\r\n        }\r\n        else \r\n        {\r\n            return false;\r\n        }\r\n    } \r\n\r\n    render() {\r\n        const { vis, index } = this.props\r\n        return (\r\n            <div className='below-card' onClick={() => this.editClickSlice(index)}>\r\n                {vis}\r\n            </div>\r\n        )\r\n    }\r\n}\r\n\r\n\r\n","import React from 'react';\r\nimport { is } from 'immutable'\r\nimport Immutable from 'immutable'\r\n\r\nexport default class SliceCardFooter extends React.Component {\r\n    \r\n    render() {\r\n        const {index,videoIndex}=this.props\r\n        let num=index + 1 < 10 ? (\"0\" + (index + 1)) : (\"\" + (index + 1))\r\n        return (\r\n            <div className='footer-card'>\r\n                <div className='footer-num' style={{backgroundColor:\"#E4F2FB\"}}>\r\n                    {num}\r\n                </div>\r\n            </div>\r\n        )\r\n    }\r\n\r\n}","import React from 'react';\nimport { is } from 'immutable'\nimport Immutable from 'immutable'\n\nexport default class SliceCardCaption extends React.Component {\n    \n    render() {\n        const {index,videoIndex,spec}=this.props\n        let myActions = this.props.spec.actions\n        let caption =myActions[myActions.length-1].style.text\n        return (\n            <div className='footer-caption'>\n                <div className='footer-text' style={{}}>\n                    {caption}\n                </div>\n            </div>\n        )\n    }\n\n}","//let calliopeService = 'service.datacalliope.com';\nlet calliopeService = 'calliope-service.idvxlab.com';\n//let calliopeLiteService = 'calliope-service.idvxlab.com:8004';\n// let calliopeLiteService = 'service.datacalliope.com:8002';\n\n// let calliopeLiteService = 'calliope-service.idvxlab.com:8002';\nlet calliopeLiteService = 'urania-api.idvxlab.com:8006';\n// let applicationUrl='https://datacalliope.com';\nlet applicationUrl = 'http://calliope-dev.idvxlab.com';\n\nlet urlPrefix = process.env.NODE_ENV === 'production' ? `https://${calliopeService}:8002/api/v1` : 'http://localhost:7001/api/v1';\n// let uploadDataPrefix = process.env.NODE_ENV === 'production' ? `https://${calliopeLiteService}` : 'http://localhost:6028';//todo  7001\nlet generationUrlPrefix = process.env.NODE_ENV === 'production' ? `https://${calliopeLiteService}` : 'http://localhost:6010';//todo  7001\n\n// let question2gifPrefix = process.env.NODE_ENV === 'production' ? `https://${calliopeLiteService}` : 'http://localhost:6030';//todo  7001\n\n\nlet activitiesPrefix = process.env.NODE_ENV === 'production' ? `https://${calliopeService}:8002/log/v1` : 'http://localhost:7002/log/v1';//\nlet publicPrefix = process.env.NODE_ENV === 'production' ? applicationUrl : 'http://localhost:3000';\n//let client_id = '033338f2-02a8-44d4-8d54-5173b4a864f9';\n\nlet uploadDataPrefix = `https://${calliopeLiteService}`;\nlet question2gifPrefix =`https://${calliopeLiteService}` ;\n// let urlPrefix = `https://${calliopeService}:8002/api/v1` ;\n// let uploadDataPrefix  = `https://${calliopeLiteService}`;//todo  7001\n// let generationUrlPrefix = `https://${calliopeLiteService}`;//todo  7001\n// let activitiesPrefix = `https://${calliopeService}:8002/log/v1`;//\n// let publicPrefix = applicationUrl ;\nlet client_id = '6dcd0f8b-6990-4d69-9018-29b3351aa6ff';\nlet accountIp = `https://account.datacalliope.com`\nlet logoutRedirectUrlIp = `https://service.datacalliope.com:8001`\n\nconst config = {\n    url: {\n        share: `${uploadDataPrefix}/share`,\n        applicationUrl: applicationUrl,\n        //share\n        publicPrefix: publicPrefix,\n        //login\n        loginadmintest: `${urlPrefix}/loginadmintest`,\n        loginRedirectUrl: `${accountIp}/#/login?response_type=code&client_id=${client_id}&grant_type=authorization_code&redirect_uri=${applicationUrl}`,\n        logoutRedirectUrl: `${applicationUrl}/#/logout`,\n        authenUrl: accountIp,\n        accessToken: `${urlPrefix}/accesstoken`,\n        userImage: `${logoutRedirectUrlIp}/img`,\n        checkToken: `${urlPrefix}/checktoken`,\n        //logout\n        logout: `${urlPrefix}/logout`,\n        logoutAuthSystem: `${logoutRedirectUrlIp}/logout`,\n        //activities\n        users: `${urlPrefix}/users`,\n        activitiesApi: `${activitiesPrefix}/users`,\n        //upload\n        uploadDataPrefix: uploadDataPrefix,\n        uploadData: `${uploadDataPrefix}/upload`,\n        uploadGraphData: `${uploadDataPrefix}/uploadGraph`,\n        \n        fetch: `${uploadDataPrefix}/data/share`,\n        //story generation\n        factScoring: `${generationUrlPrefix}/fact`,\n        generateRandomly: `${generationUrlPrefix}/generate`,\n        generateGraphRandomly: `${generationUrlPrefix}/generateGraphRandomly`,\n\n        //data filter\n        filteredGenerate:`${generationUrlPrefix}/filteredgenerate`,\n\n        // data gif\n        question2gif:`${question2gifPrefix}/edit_decompose`\n    }\n}\nexport default config","import axios from 'axios';\nimport { stringify } from 'query-string';\n// import config from '@/axios/config';\n\nconst composeUrl = function (url, qs) {\n    let result = '';\n    // if (url[0] !== '/') {\n    //   result += '/';\n    // }\n    result += url;\n    if (typeof qs === 'object' && Object.keys(qs).length !== 0) {\n        result += `?${stringify(qs)}`;\n    }\n    return result;\n};\n\nexport const request = ({ url, method, param, data }) => {\n    return new Promise((reslove, reject) => {\n        axios({\n            method: method,\n            url: composeUrl(url, param),\n            data: data,\n            withCredentials: true,\n            // headers: { 'token': Cookies.get('userInfo') ? JSON.parse(Cookies.get('userInfo')).token : null },\n        }).then((response) => {\n            if (response.status >= 400) {\n                reject();\n            } else if (response.status === 200 || response.status === 201 || response.status === 204) {\n                reslove(response.data);\n            } else {\n                reject();\n            }\n        }).catch(error => {\n            if (error.response) {\n                if (error.response.status === 401) {\n                    //reject('401');\n                    reject()\n                    //退出登陆\n                    // axios({\n                    //     method: \"post\",\n                    //     url: `${config.url.logout}`,\n                    //     data: {},\n                    //     withCredentials: true\n                    // }).then((response) => {\n                    //     if (response.status === 200) {\n                    //         window.location.href = config.url.loginRedirectUrl //login first\n                    //     }\n                    // }).catch(\n                    // )\n                }\n            }\n            reject();\n        })\n    })\n};\n\nexport const requestWithoutCredentials = ({ url, method, param, data }) => {\n    return new Promise((reslove, reject) => {\n        axios({\n            method: method,\n            url: composeUrl(url, param),\n            data: data\n        }).then((response) => {\n            if (response.status >= 400) {\n                reject();\n            } else if (response.status === 200 || response.status === 201 || response.status === 204) {\n                reslove(response.data);\n            } else {\n                reject();\n            }\n        }).catch(error => {\n            reject();\n            //  message.error('error message');\n        })\n    })\n};\n\n","import * as req from './base';\nimport config from '@/axios/config';\nimport axios from 'axios';\n\n/**\n * 用户认证 相关接口\n * @param \n */\nexport async function checkToken() {\n    const data = await req.request({\n        url: `${config.url.checkToken}`,\n        method: 'post',\n        param: {},\n        data: {}\n    });\n    return data;\n}\n\nexport async function loginadmintest() {\n    const data = await req.request({\n        url: `${config.url.loginadmintest}`,\n        method: 'post',\n        param: {},\n        data: {}\n    });\n    return data;\n}\n\nexport async function accessToken(body) {\n    const data = await req.request({\n        url: `${config.url.accessToken}`,\n        method: 'post',\n        param: {},\n        data: body\n    });\n    return data;\n}\nexport async function logout() {\n    const data = await req.request({\n        url: `${config.url.logout}`,\n        method: 'post',\n        param: {},\n        data: {}\n    });\n    return data;\n}\n\n\nexport async function uploadData(formData) {\n    return new Promise((reslove, reject) => {\n        axios({\n            method: \"post\",\n            url: `${config.url.uploadData}`,\n            config: {\n                \"headers\": {\n                    'Content-Type': 'multipart/form-data' //application/json; charset=utf-8\n                },\n            },\n            data: formData\n        }).then((response) => {\n            if (response.status >= 400) {\n                reject();\n            } else if (response.status === 200 || response.status === 201 || response.status === 204) {\n                reslove(response.data);\n            } else {\n                reject();\n            }\n        }).catch(error => {\n            reject();\n            //  message.error('error message');\n        })\n    })\n}\n\n\nexport function filteredgenerate(url, data) {\n    return axios({\n        method: \"post\",\n        url: url,\n        config: {\n            \"headers\": {\n                'Content-Type': 'application/json; charset=utf-8'\n            },\n        },\n        data: data\n    })\n}\n\nexport function generate(url, data) {\n    return axios({\n        method: \"post\",\n        url: url,\n        config: {\n            \"headers\": {\n                'Content-Type': 'application/json; charset=utf-8'\n            },\n        },\n        data: data\n    })\n}\n\nexport function question2gif(url, data) {\n    return axios({\n        method: \"post\",\n        url: url,\n        config: {\n            \"headers\": {\n                'Content-Type': 'application/json; charset=utf-8'\n            },\n        },\n        data: data\n    })\n}\n\n\nexport function factScoring(filename, fact,filters, method) {\n    return axios({\n        \"method\": \"POST\",\n        \"url\": config.url.factScoring,\n        \"headers\": {\n            \"Content-Type\": \"application/json; charset=utf-8\"\n        },\n        \"data\": {\n            \"file_name\": filename,\n            \"fact\": fact,\n            \"filters\":filters,\n            \"method\": method,\n        }\n    })\n}\n\nexport async function shareStory(jsonstring) {\n    return new Promise((reslove, reject) => {\n        axios({\n            method: \"post\",\n            url: `${config.url.share}`,\n            config: {\n                \"headers\": {\n                    'Content-Type': 'application/json; charset=utf-8'\n                },\n            },\n            data: {\n                \"share_json\": jsonstring\n            }\n        }).then((response) => {\n            if (response.status >= 400) {\n                reject();\n            } else if (response.status === 200 || response.status === 201 || response.status === 204) {\n                reslove(response.data);\n            } else {\n                reject();\n            }\n        }).catch(error => {\n            reject();\n            //  message.error('error message');\n        })\n    })\n}\n\nexport async function fetchStory(id) {\n    return axios({\n        method: \"get\",\n        \"url\": `${config.url.fetch}/${id}.json`,\n        config: {\n            \"headers\": {\n                'Content-Type': 'application/json; charset=utf-8'\n            },\n        }\n    })\n}\n/*****\n *技术栈：\n ssr(后端渲染)，koa(koa-views)：模板渲染，渲染出要生成pdf的页面)\n node.js 生成pdf插件 puppeteer：将渲染的页面生成PDF\n koa-send：将生成的PDF返回给前端页面下载 \n * \n data是后端用于渲染页面的数据\n */\nexport function generatePDF(data) {\n    return axios({\n        method: 'post',\n        url: `/generatePDF`,\n        param: {},\n        data: data\n    })\n}\n\n/**\n * 数据|故事|评论 操作行为记录 API\n * @param \n */\n\nexport async function activitiesApi(uid, body) {\n    const data = await req.requestWithoutCredentials({\n        url: `${config.url.activitiesApi}/lite/activities`,\n        method: 'post',\n        param: {},\n        data: body\n    });\n    return data;\n}\n","// This icon file is generated automatically.\nvar CloseOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M563.8 512l262.5-312.9c4.4-5.2.7-13.1-6.1-13.1h-79.8c-4.7 0-9.2 2.1-12.3 5.7L511.6 449.8 295.1 191.7c-3-3.6-7.5-5.7-12.3-5.7H203c-6.8 0-10.5 7.9-6.1 13.1L459.4 512 196.9 824.9A7.95 7.95 0 00203 838h79.8c4.7 0 9.2-2.1 12.3-5.7l216.5-258.1 216.5 258.1c3 3.6 7.5 5.7 12.3 5.7h79.8c6.8 0 10.5-7.9 6.1-13.1L563.8 512z\" } }] }, \"name\": \"close\", \"theme\": \"outlined\" };\nexport default CloseOutlined;\n","import _objectSpread from \"@babel/runtime/helpers/esm/objectSpread2\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\nimport * as React from 'react';\nimport CloseOutlinedSvg from \"@ant-design/icons-svg/es/asn/CloseOutlined\";\nimport AntdIcon from '../components/AntdIcon';\n\nvar CloseOutlined = function CloseOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _objectSpread(_objectSpread({}, props), {}, {\n    ref: ref,\n    icon: CloseOutlinedSvg\n  }));\n};\n\nCloseOutlined.displayName = 'CloseOutlined';\nexport default /*#__PURE__*/React.forwardRef(CloseOutlined);","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","import {genFactSentence,genSubtitle} from '../sentencer/index';\nimport ChartType from '../constant/ChartType';\nexport default class Fact {\n    constructor(type, measure = [], subspace = [], groupby = [], focus = [], parameter = [], chart = \"\",  score = 0, information = 0, significance = 0) {\n        this.type = type;\n        this.measure = measure;\n        this.subspace = subspace;\n        this.groupby = groupby;\n        this.focus = focus;\n        this.parameter = parameter;\n        this.score = score;\n        this.information = information;\n        this.significance = significance;\n        this.chart = chart;\n        this.generatedScript = genFactSentence(this);\n        this.generatedSubtitle = genSubtitle(this)\n        //animation duration\n        this.duration = 3000;\n        // Compound Fact\n        this.aggregated = false;\n        this.aggregatedFact = null;\n        this.compoundType = '';\n        this.compoundChart = ChartType.JUXTAPOSITION;\n    }\n    script = () => this.generatedScript;\n}","import Chart from '@/Chart';\nimport React from 'react';\n\n\n\nexport const narrative_spec2cards = function(narrative_spec){\n    let spec = {\n        \"chart\" : narrative_spec.chart,\n        \"data\": narrative_spec.data,\n        \"actions\": []\n    }\n    \n    let actions = []\n    let idx_titleaction = []\n    let step_actions = []\n    if(narrative_spec.actions){\n        actions = _.cloneDeep(narrative_spec.actions)\n        actions.map((item, index) => {\n            if(item.add === \"title\" && item.style.duration !== -1)\n            idx_titleaction.push(index)\n        })\n        // duration delay = 0\n        idx_titleaction.map((d) => {\n            let eachaction = actions.slice(0,d+1)\n            eachaction.map((item) => {\n                if(item.style){\n                    item.style.delay = 0\n                    item.style.duration = 0\n                }\n\n            })\n            // remove extra title\n            eachaction.map((item, index) => {\n                if (item.add === \"title\" && index !== eachaction.length-1){\n                    eachaction.splice(index,1)\n                }\n            })\n            let step_spec = _.cloneDeep(spec)\n            step_spec.actions = eachaction\n            step_actions.push(step_spec)\n        })\n\n    }\n    return step_actions\n}\n\nexport const narrativespec2Vis = function(spec, uuid) {\n\n    return <Chart spec = {spec} uuid = { uuid }/>\n}"],"sourceRoot":""}